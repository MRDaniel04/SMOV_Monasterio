Index: app/src/main/java/com/nextapp/monasterio/ui/screens/JuegoParejasScreen.kt
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>package com.nextapp.monasterio.ui.screens\r\n\r\nimport android.app.Activity\r\nimport android.content.pm.ActivityInfo\r\nimport android.content.res.Configuration\r\nimport androidx.compose.foundation.Image\r\nimport androidx.compose.foundation.layout.*\r\nimport androidx.compose.foundation.rememberScrollState\r\nimport androidx.compose.foundation.shape.RoundedCornerShape\r\nimport androidx.compose.foundation.verticalScroll\r\nimport androidx.compose.material3.Button\r\nimport androidx.compose.material3.ButtonDefaults\r\nimport androidx.compose.material3.Text\r\nimport androidx.compose.runtime.Composable\r\nimport androidx.compose.runtime.DisposableEffect\r\nimport androidx.compose.ui.Alignment\r\nimport androidx.compose.ui.Modifier\r\nimport androidx.compose.ui.draw.shadow\r\nimport androidx.compose.ui.graphics.Color\r\nimport androidx.compose.ui.layout.ContentScale\r\nimport androidx.compose.ui.platform.LocalConfiguration\r\nimport androidx.compose.ui.platform.LocalContext\r\nimport androidx.compose.ui.res.painterResource\r\nimport androidx.compose.ui.res.stringResource\r\nimport androidx.compose.ui.text.font.FontWeight\r\nimport androidx.compose.ui.text.style.TextAlign\r\nimport androidx.compose.ui.unit.dp\r\nimport androidx.compose.ui.unit.sp\r\nimport androidx.navigation.NavController\r\nimport com.nextapp.monasterio.AppRoutes\r\nimport com.nextapp.monasterio.R\r\nimport com.nextapp.monasterio.ui.theme.MonasteryBlue\r\n\r\n@Composable\r\nfun JuegoParejasScreen(\r\n    navController: NavController,\r\n    modifier: Modifier = Modifier,\r\n    topPadding: PaddingValues = PaddingValues(0.dp) // Recibimos el padding\r\n) {\r\n    val context = LocalContext.current\r\n    val activity = (context as? Activity)\r\n\r\n    // Detectar orientación\r\n    val configuration = LocalConfiguration.current\r\n    val isLandscape = configuration.orientation == Configuration.ORIENTATION_LANDSCAPE\r\n\r\n    // Permitir rotación\r\n    DisposableEffect(Unit) {\r\n        activity?.requestedOrientation = ActivityInfo.SCREEN_ORIENTATION_UNSPECIFIED\r\n        onDispose { }\r\n    }\r\n\r\n    // --- ESTRUCTURA PRINCIPAL ---\r\n    Box(modifier = modifier.fillMaxSize()) {\r\n\r\n        // 1. FONDO (Ocupa TODO, sin padding)\r\n        Image(\r\n            painter = painterResource(R.drawable.fondo),\r\n            contentDescription = \"Fondo\",\r\n            contentScale = ContentScale.Crop,\r\n            modifier = Modifier.fillMaxSize()\r\n        )\r\n\r\n        // 2. CONTENIDO (Respeta la barra superior)\r\n        Box(\r\n            modifier = Modifier\r\n                .fillMaxSize()\r\n                .padding(topPadding)\r\n        ) {\r\n            // Contenedor interno con margen\r\n            Box(\r\n                modifier = Modifier\r\n                    .fillMaxSize()\r\n                    .padding(24.dp),\r\n                contentAlignment = Alignment.Center\r\n            ) {\r\n                if (isLandscape) {\r\n                    // --- DISEÑO HORIZONTAL (Cuadrícula 2x2) ---\r\n                    Column(\r\n                        modifier = Modifier.fillMaxSize(),\r\n                        verticalArrangement = Arrangement.spacedBy(16.dp),\r\n                        horizontalAlignment = Alignment.CenterHorizontally\r\n                    ) {\r\n                        // Fila 1 (Nivel 1 y 2)\r\n                        Row(\r\n                            modifier = Modifier.weight(1f),\r\n                            horizontalArrangement = Arrangement.spacedBy(16.dp)\r\n                        ) {\r\n                            GameButton(\r\n                                text = stringResource(id = R.string.three_pairs),\r\n                                modifier = Modifier.weight(1f).fillMaxHeight(0.8f),\r\n                                onClick = { navController.navigate(AppRoutes.PAREJASNIVEL1) }\r\n                            )\r\n                            GameButton(\r\n                                text = stringResource(id = R.string.four_pairs),\r\n                                modifier = Modifier.weight(1f).fillMaxHeight(0.8f),\r\n                                onClick = { navController.navigate(AppRoutes.PAREJASNIVEL2) }\r\n                            )\r\n                        }\r\n\r\n                        // Fila 2 (Nivel 3 y 4)\r\n                        Row(\r\n                            modifier = Modifier.weight(1f),\r\n                            horizontalArrangement = Arrangement.spacedBy(16.dp)\r\n                        ) {\r\n                            GameButton(\r\n                                text = stringResource(id = R.string.five_pairs),\r\n                                modifier = Modifier.weight(1f).fillMaxHeight(0.8f),\r\n                                onClick = { navController.navigate(AppRoutes.PAREJASNIVEL3) }\r\n                            )\r\n                            GameButton(\r\n                                text = stringResource(id = R.string.six_pairs),\r\n                                modifier = Modifier.weight(1f).fillMaxHeight(0.8f),\r\n                                onClick = { navController.navigate(AppRoutes.PAREJASNIVEL4) }\r\n                            )\r\n                        }\r\n                    }\r\n                } else {\r\n                    // --- DISEÑO VERTICAL (Lista) ---\r\n                    Column(\r\n                        modifier = Modifier\r\n                            .fillMaxWidth()\r\n                            .verticalScroll(rememberScrollState()),\r\n                        verticalArrangement = Arrangement.spacedBy(24.dp), // Espacio entre botones\r\n                        horizontalAlignment = Alignment.CenterHorizontally\r\n                    ) {\r\n                        GameButton(\r\n                            text = stringResource(id = R.string.three_pairs),\r\n                            modifier = Modifier.fillMaxWidth().height(100.dp),\r\n                            onClick = { navController.navigate(AppRoutes.PAREJASNIVEL1) }\r\n                        )\r\n\r\n                        GameButton(\r\n                            text = stringResource(id = R.string.four_pairs),\r\n                            modifier = Modifier.fillMaxWidth().height(100.dp),\r\n                            onClick = { navController.navigate(AppRoutes.PAREJASNIVEL2) }\r\n                        )\r\n\r\n                        GameButton(\r\n                            text = stringResource(id = R.string.five_pairs),\r\n                            modifier = Modifier.fillMaxWidth().height(100.dp),\r\n                            onClick = { navController.navigate(AppRoutes.PAREJASNIVEL3) }\r\n                        )\r\n\r\n                        GameButton(\r\n                            text = stringResource(id = R.string.six_pairs),\r\n                            modifier = Modifier.fillMaxWidth().height(100.dp),\r\n                            onClick = { navController.navigate(AppRoutes.PAREJASNIVEL4) }\r\n                        )\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\n// --- COMPONENTE REUTILIZABLE PARA BOTONES ---\r\n@Composable\r\nfun GameButton(\r\n    text: String,\r\n    modifier: Modifier = Modifier,\r\n    onClick: () -> Unit\r\n) {\r\n    Button(\r\n        onClick = onClick,\r\n        colors = ButtonDefaults.buttonColors(containerColor = MonasteryBlue),\r\n        shape = RoundedCornerShape(20.dp),\r\n        modifier = modifier.shadow(8.dp, RoundedCornerShape(20.dp)),\r\n        contentPadding = PaddingValues(16.dp)\r\n    ) {\r\n        Box(\r\n            modifier = Modifier.fillMaxSize(),\r\n            contentAlignment = Alignment.Center\r\n        ) {\r\n            Text(\r\n                text = text,\r\n                fontSize = 22.sp,\r\n                fontWeight = FontWeight.Bold,\r\n                textAlign = TextAlign.Center,\r\n                color = Color.White\r\n            )\r\n        }\r\n    }\r\n}
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/app/src/main/java/com/nextapp/monasterio/ui/screens/JuegoParejasScreen.kt b/app/src/main/java/com/nextapp/monasterio/ui/screens/JuegoParejasScreen.kt
--- a/app/src/main/java/com/nextapp/monasterio/ui/screens/JuegoParejasScreen.kt	(revision 26d1bc7c4208f8005e97b4491e6d203945b2c691)
+++ b/app/src/main/java/com/nextapp/monasterio/ui/screens/JuegoParejasScreen.kt	(date 1765214377442)
@@ -30,7 +30,7 @@
 import com.nextapp.monasterio.AppRoutes
 import com.nextapp.monasterio.R
 import com.nextapp.monasterio.ui.theme.MonasteryBlue
-
+import com.nextapp.monasterio.ui.components.MonasteryButton
 @Composable
 fun JuegoParejasScreen(
     navController: NavController,
@@ -161,7 +161,7 @@
     modifier: Modifier = Modifier,
     onClick: () -> Unit
 ) {
-    Button(
+    MonasteryButton(
         onClick = onClick,
         colors = ButtonDefaults.buttonColors(containerColor = MonasteryBlue),
         shape = RoundedCornerShape(20.dp),
Index: app/src/main/java/com/nextapp/monasterio/ui/screens/ReservaScreen.kt
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>package com.nextapp.monasterio.ui.screens\r\n\r\nimport android.app.Activity\r\nimport android.content.pm.ActivityInfo\r\nimport android.content.res.Configuration\r\nimport android.util.Log\r\nimport androidx.compose.foundation.Image\r\nimport androidx.compose.foundation.clickable\r\nimport androidx.compose.foundation.layout.*\r\nimport androidx.compose.foundation.rememberScrollState\r\nimport androidx.compose.foundation.shape.RoundedCornerShape\r\nimport androidx.compose.foundation.text.KeyboardOptions\r\nimport androidx.compose.foundation.verticalScroll\r\nimport androidx.compose.material3.*\r\nimport androidx.compose.runtime.*\r\nimport androidx.compose.runtime.saveable.rememberSaveable\r\nimport androidx.compose.ui.Alignment\r\nimport androidx.compose.ui.Modifier\r\nimport androidx.compose.ui.graphics.Color\r\nimport androidx.compose.ui.layout.ContentScale\r\nimport androidx.compose.ui.platform.LocalConfiguration\r\nimport androidx.compose.ui.platform.LocalContext\r\nimport androidx.compose.ui.res.colorResource\r\nimport androidx.compose.ui.res.painterResource\r\nimport androidx.compose.ui.res.stringResource\r\nimport androidx.compose.ui.text.font.FontWeight\r\nimport androidx.compose.ui.text.input.KeyboardType\r\nimport androidx.compose.ui.unit.dp\r\nimport androidx.compose.ui.unit.sp\r\nimport androidx.navigation.NavController\r\nimport com.nextapp.monasterio.AppRoutes\r\nimport com.nextapp.monasterio.R\r\nimport java.text.SimpleDateFormat\r\nimport java.util.Calendar\r\nimport java.util.Locale\r\nimport android.util.Patterns\r\nimport androidx.compose.ui.draw.shadow\r\nimport com.nextapp.monasterio.viewModels.InfoViewModel\r\nimport java.util.Date\r\n\r\n@OptIn(ExperimentalMaterial3Api::class)\r\n@Composable\r\nfun ReservaScreen(\r\n    navController: NavController,\r\n    viewModel: InfoViewModel,\r\n    topPadding: PaddingValues = PaddingValues(0.dp)\r\n) {\r\n    val context = LocalContext.current\r\n    val activity = (context as? Activity)\r\n\r\n    // Detectar orientación\r\n    val configuration = LocalConfiguration.current\r\n    val isLandscape = configuration.orientation == Configuration.ORIENTATION_LANDSCAPE\r\n\r\n    DisposableEffect(Unit) {\r\n        activity?.requestedOrientation = ActivityInfo.SCREEN_ORIENTATION_UNSPECIFIED\r\n        onDispose { }\r\n    }\r\n\r\n    val infoData by viewModel.infoState.collectAsState()\r\n\r\n    // --- ESTADOS DEL FORMULARIO ---\r\n    var nombre by rememberSaveable { mutableStateOf(\"\") }\r\n    var email by rememberSaveable { mutableStateOf(\"\") }\r\n    var fecha by rememberSaveable { mutableStateOf(\"\") }\r\n    var hora by rememberSaveable { mutableStateOf(\"\") }\r\n\r\n    var nombreError by remember { mutableStateOf<String?>(null) }\r\n    var fechaError by remember { mutableStateOf<String?>(null) }\r\n    var horaError by remember { mutableStateOf<String?>(null) }\r\n\r\n    var mostrarSelectorFecha by remember { mutableStateOf(false) }\r\n    var mostrarSelectorHora by remember { mutableStateOf(false) }\r\n\r\n    val formatoFecha = remember { SimpleDateFormat(\"dd-MM-yyyy\", Locale.getDefault()) }\r\n    val horarioDisponible = infoData.hours.get(\"es\") ?: \"\"\r\n\r\n\r\n    val partes = horarioDisponible.split(\":\")\r\n\r\n    var rangoHoras = horarioDisponible.substringAfter(\":\")\r\n    var rangoDias = horarioDisponible.substringBefore(\":\")\r\n\r\n    val rangoHorasEstandarizado = rangoHoras.replace(\"–\", \"-\")\r\n\r\n    val partesHoras = rangoHorasEstandarizado.split(\"-\")\r\n    var primeraHora = \"\"\r\n    var ultimaHora = \"\"\r\n    if (partesHoras.size == 2){\r\n        primeraHora = partesHoras[0].trim()\r\n        ultimaHora = partesHoras[1].trim()\r\n    }\r\n\r\n    val partesDias = rangoDias.split(\"a\")\r\n    var primerDia = \"\"\r\n    var ultimoDia = \"\"\r\n\r\n    if(partesDias.size == 2){\r\n        primerDia = partesDias[0].trim()\r\n        ultimoDia = partesDias[1].trim()\r\n    } else if (partesDias.size == 1 && rangoDias.isNotBlank()){\r\n        primerDia = rangoDias\r\n        ultimoDia = \"\"\r\n    }\r\n\r\n\r\n    val mapaDias = mapOf(\r\n        \"Lunes\" to 2, \"Martes\" to 3, \"Miércoles\" to 4, \"Jueves\" to 5, \"Viernes\" to 6, \"Sábado\" to 7, \"Domingo\" to 1\r\n    )\r\n\r\n\r\n    val listaDiasDisponibles : List<Int> = remember(primerDia,ultimoDia){\r\n        val diaInicio = mapaDias[primerDia]\r\n        val diaFinal = mapaDias[ultimoDia]\r\n\r\n        Log.d(\"DiasSemanaDebug\", \"diaInicio=$diaInicio, diaFinal=$diaFinal, primerDia=$primerDia, ultimoDia=$ultimoDia\")\r\n\r\n        if(diaInicio != null && diaFinal !=null){\r\n            (1..7).filter { dia->\r\n                if(diaInicio<= diaFinal){\r\n                    dia in diaInicio..diaFinal\r\n                }else{\r\n                    dia >= diaInicio || dia <= diaFinal\r\n                }\r\n            }\r\n        } else if(diaInicio !=null ){\r\n            listOf(diaInicio)\r\n        } else emptyList()\r\n    }\r\n\r\n\r\n    val listasHorasDisponibles : List<String> = remember(primeraHora,ultimaHora){\r\n        val horas = mutableListOf<String>()\r\n        val formatoHora = SimpleDateFormat(\"HH:mm\", Locale.getDefault())\r\n        try{\r\n            val horaInicio : Date = formatoHora.parse(primeraHora) ?: return@remember emptyList()\r\n            val horaFin : Date = formatoHora.parse(ultimaHora) ?: return@remember emptyList()\r\n            val calendarioActual = Calendar.getInstance().apply { time = horaInicio }\r\n            val calendarioFin = Calendar.getInstance().apply { time = horaFin }\r\n            while (!calendarioActual.after(calendarioFin)){\r\n                horas.add(formatoHora.format(calendarioActual.time))\r\n                calendarioActual.add(Calendar.HOUR_OF_DAY,1)\r\n            }\r\n        } catch (e:Exception){\r\n            println(\"Error parseando horas : ${e.message}\")\r\n        }\r\n        horas\r\n    }\r\n\r\n\r\n\r\n    // Lógica de validación de fechas\r\n    val misFechasSeleccionables = object : SelectableDates {\r\n        override fun isSelectableDate(utcTimeMillis: Long): Boolean {\r\n            val hoy = Calendar.getInstance().apply {\r\n                set(Calendar.HOUR_OF_DAY, 0)\r\n                set(Calendar.MINUTE, 0)\r\n                set(Calendar.SECOND, 0)\r\n                set(Calendar.MILLISECOND, 0)\r\n            }\r\n            val calendario = Calendar.getInstance().apply { timeInMillis = utcTimeMillis }\r\n\r\n            val esDespues = utcTimeMillis >= hoy.timeInMillis\r\n            val diaSemana = calendario.get(Calendar.DAY_OF_WEEK)\r\n            val esDiaDisponible = listaDiasDisponibles.contains(diaSemana)\r\n\r\n            return esDespues && esDiaDisponible\r\n        }\r\n        override fun isSelectableYear(year: Int) = year >= Calendar.getInstance().get(Calendar.YEAR)\r\n    }\r\n\r\n    val estadoSelectorFecha = rememberDatePickerState(selectableDates = misFechasSeleccionables)\r\n\r\n    // Función de validación y navegación\r\n    fun validarYConfirmar() {\r\n        val nombreLimpio = nombre.trim()\r\n        val nombreRegex = Regex(\"^[\\\\p{L} ]+\\$\")\r\n        val contieneDigitosValidos = nombreRegex.matches(nombreLimpio)\r\n\r\n        if (nombreLimpio.isEmpty()) nombreError = context.getString(R.string.compulsory_name)\r\n        else if (!contieneDigitosValidos) nombreError = context.getString(R.string.valid_name)\r\n\r\n        if (fecha == \"\") fechaError = context.getString(R.string.date_no_selected)\r\n        if (hora == \"\") horaError = context.getString(R.string.hour_no_selected)\r\n\r\n        if (nombreError == null && fecha != \"\" && hora != \"\") {\r\n            navController.navigate(AppRoutes.CONFIRMACION_RESERVA + \"/$nombre/$fecha/$hora\")\r\n        }\r\n    }\r\n\r\n    // --- ESTRUCTURA PRINCIPAL ---\r\n    Box(modifier = Modifier.fillMaxSize()) {\r\n\r\n        // 1. FONDO\r\n        Image(\r\n            painter = painterResource(R.drawable.fondo_desplegable3),\r\n            contentDescription = \"Fondo\",\r\n            contentScale = ContentScale.Crop,\r\n            modifier = Modifier.fillMaxSize()\r\n        )\r\n\r\n        // 2. CONTENIDO\r\n        Box(\r\n            modifier = Modifier\r\n                .fillMaxSize()\r\n                .padding(topPadding) // Respeta la barra superior\r\n        ) {\r\n            if (isLandscape) {\r\n                // --- DISEÑO HORIZONTAL (2 Columnas) ---\r\n                Row(\r\n                    modifier = Modifier\r\n                        .fillMaxSize()\r\n                        .padding(horizontal = 24.dp)\r\n                        .verticalScroll(rememberScrollState()), // Scroll global si es necesario\r\n                    horizontalArrangement = Arrangement.spacedBy(32.dp),\r\n                    verticalAlignment = Alignment.CenterVertically\r\n                ) {\r\n                    // COLUMNA IZQUIERDA: Datos Personales\r\n                    Column(modifier = Modifier.weight(1f)) {\r\n                        ReservaTextField(\r\n                            value = nombre,\r\n                            labelRes = R.string.name_appointment,\r\n                            placeholderRes = R.string.placeholdername_appointment,\r\n                            error = nombreError,\r\n                            onValueChange = { nombre = it; nombreError = null }\r\n                        )\r\n                        Spacer(Modifier.height(16.dp))\r\n                    }\r\n\r\n                    // COLUMNA DERECHA: Fecha, Hora y Botón\r\n                    Column(modifier = Modifier.weight(1f)) {\r\n                        ReservaReadOnlyField(\r\n                            value = fecha,\r\n                            labelRes = R.string.date_appointment,\r\n                            placeholderRes = R.string.placeholderdate_appointment,\r\n                            iconRes = R.drawable.calendario,\r\n                            error = fechaError,\r\n                            onClick = { mostrarSelectorFecha = true }\r\n                        )\r\n\r\n                        Spacer(Modifier.height(16.dp))\r\n\r\n                        // Selector de Hora\r\n                        Box {\r\n                            ReservaReadOnlyField(\r\n                                value = hora,\r\n                                labelRes = R.string.hour_appointment,\r\n                                placeholderRes = R.string.placeholderhour_appointment,\r\n                                iconRes = R.drawable.ic_time_24,\r\n                                error = horaError,\r\n                                onClick = { mostrarSelectorHora = true }\r\n                            )\r\n                            DropdownMenu(\r\n                                expanded = mostrarSelectorHora,\r\n                                onDismissRequest = { mostrarSelectorHora = false },\r\n                                modifier = Modifier.fillMaxWidth(0.4f)\r\n                            ) {\r\n                                listasHorasDisponibles.forEach { timeSlot ->\r\n                                    DropdownMenuItem(\r\n                                        text = { Text(timeSlot) },\r\n                                        onClick = {\r\n                                            horaError = null\r\n                                            hora = timeSlot\r\n                                            mostrarSelectorHora = false\r\n                                        }\r\n                                    )\r\n                                }\r\n                            }\r\n                        }\r\n\r\n                        Spacer(Modifier.height(32.dp))\r\n\r\n                        Button(\r\n                            onClick = { validarYConfirmar() },\r\n                            modifier = Modifier.fillMaxWidth().height(50.dp).shadow(8.dp, RoundedCornerShape(8.dp)),\r\n                            colors = ButtonDefaults.buttonColors(containerColor = colorResource(R.color.MonasteryBlue))\r\n                        ) {\r\n                            Text(stringResource(R.string.confirm_button), color = Color.White, fontWeight = FontWeight.Bold, fontSize = 18.sp)\r\n                        }\r\n                    }\r\n                }\r\n            } else {\r\n                // --- DISEÑO VERTICAL (Original) ---\r\n                Column(\r\n                    modifier = Modifier\r\n                        .fillMaxSize()\r\n                        .verticalScroll(rememberScrollState())\r\n                        .padding(horizontal = 24.dp),\r\n                    horizontalAlignment = Alignment.Start,\r\n                    verticalArrangement = Arrangement.Center\r\n                ) {\r\n                    Spacer(Modifier.height(24.dp)) // Margen superior extra\r\n\r\n                    ReservaTextField(\r\n                        value = nombre, labelRes = R.string.name_appointment, placeholderRes = R.string.placeholdername_appointment,\r\n                        error = nombreError, onValueChange = { nombre = it; nombreError = null }\r\n                    )\r\n                    Spacer(Modifier.height(24.dp))\r\n\r\n                    ReservaReadOnlyField(\r\n                        value = fecha, labelRes = R.string.date_appointment, placeholderRes = R.string.placeholderdate_appointment,\r\n                        iconRes = R.drawable.calendario, error = fechaError, onClick = { mostrarSelectorFecha = true }\r\n                    )\r\n                    Spacer(Modifier.height(24.dp))\r\n\r\n                    Box {\r\n                        ReservaReadOnlyField(\r\n                            value = hora, labelRes = R.string.hour_appointment, placeholderRes = R.string.placeholderhour_appointment,\r\n                            iconRes = R.drawable.ic_time_24, error = horaError, onClick = { mostrarSelectorHora = true }\r\n                        )\r\n                        DropdownMenu(\r\n                            expanded = mostrarSelectorHora,\r\n                            onDismissRequest = { mostrarSelectorHora = false },\r\n                            modifier = Modifier.fillMaxWidth(0.8f)\r\n                        ) {\r\n                            listasHorasDisponibles.forEach { timeSlot ->\r\n                                DropdownMenuItem(\r\n                                    text = { Text(timeSlot) },\r\n                                    onClick = { horaError = null; hora = timeSlot; mostrarSelectorHora = false }\r\n                                )\r\n                            }\r\n                        }\r\n                    }\r\n\r\n                    Spacer(Modifier.height(48.dp))\r\n\r\n                    Button(\r\n                        onClick = { validarYConfirmar() },\r\n                        modifier = Modifier.fillMaxWidth().height(50.dp).shadow(8.dp, RoundedCornerShape(8.dp)),\r\n                        colors = ButtonDefaults.buttonColors(containerColor = colorResource(R.color.MonasteryBlue))\r\n                    ) {\r\n                        Text(stringResource(R.string.confirm_button), color = Color.White, fontWeight = FontWeight.Bold, fontSize = 24.sp)\r\n                    }\r\n                    Spacer(Modifier.height(48.dp))\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    // Diálogo de Fecha\r\n    if (mostrarSelectorFecha) {\r\n        DatePickerDialog(\r\n            onDismissRequest = { mostrarSelectorFecha = false },\r\n            confirmButton = {\r\n                TextButton(onClick = {\r\n                    fechaError = null\r\n                    mostrarSelectorFecha = false\r\n                    estadoSelectorFecha.selectedDateMillis?.let { fecha = formatoFecha.format(it) }\r\n                }) { Text(stringResource(R.string.datepicker_ok)) }\r\n            },\r\n            dismissButton = {\r\n                TextButton(onClick = { mostrarSelectorFecha = false }) { Text(stringResource(R.string.datepicker_cancel)) }\r\n            }\r\n        ) {\r\n            DatePicker(state = estadoSelectorFecha)\r\n        }\r\n    }\r\n}\r\n\r\n// --- COMPONENTES REUTILIZABLES ---\r\n\r\n@Composable\r\nfun ReservaTextField(\r\n    value: String,\r\n    labelRes: Int,\r\n    placeholderRes: Int,\r\n    error: String?,\r\n    keyboardType: KeyboardType = KeyboardType.Text,\r\n    onValueChange: (String) -> Unit\r\n) {\r\n    Column {\r\n        Text(stringResource(labelRes), style = MaterialTheme.typography.bodyLarge, fontWeight = FontWeight.Bold, color = Color.Black) // Texto blanco para ver sobre el fondo\r\n        Spacer(Modifier.height(8.dp))\r\n        TextField(\r\n            value = value,\r\n            onValueChange = onValueChange,\r\n            placeholder = { Text(stringResource(placeholderRes)) },\r\n            modifier = Modifier.fillMaxWidth(),\r\n            shape = RoundedCornerShape(8.dp),\r\n            colors = TextFieldDefaults.colors(\r\n                focusedContainerColor = Color.White.copy(alpha = 0.9f),\r\n                unfocusedContainerColor = Color.White.copy(alpha = 0.8f),\r\n                errorContainerColor = Color.White.copy(alpha = 0.9f),\r\n                focusedIndicatorColor = Color.Transparent,\r\n                unfocusedIndicatorColor = Color.Transparent\r\n            ),\r\n            keyboardOptions = KeyboardOptions(keyboardType = keyboardType),\r\n            singleLine = true,\r\n            isError = error != null,\r\n            supportingText = { if (error != null) Text(text = error, color = MaterialTheme.colorScheme.error) }\r\n        )\r\n    }\r\n}\r\n\r\n@Composable\r\nfun ReservaReadOnlyField(\r\n    value: String,\r\n    labelRes: Int,\r\n    placeholderRes: Int,\r\n    iconRes: Int,\r\n    error: String?,\r\n    onClick: () -> Unit\r\n) {\r\n    Column {\r\n        Text(stringResource(labelRes), style = MaterialTheme.typography.bodyLarge, fontWeight = FontWeight.Bold, color = Color.Black)\r\n        Spacer(Modifier.height(8.dp))\r\n        Box(modifier = Modifier.clickable { onClick() }) {\r\n            TextField(\r\n                value = value,\r\n                onValueChange = {},\r\n                readOnly = true,\r\n                enabled = false, // Deshabilitado para que el click lo capture el Box, pero visualmente activo\r\n                placeholder = { Text(stringResource(placeholderRes)) },\r\n                trailingIcon = {\r\n                    Icon(painterResource(iconRes), contentDescription = null, tint = Color.Black)\r\n                },\r\n                modifier = Modifier.fillMaxWidth(),\r\n                shape = RoundedCornerShape(8.dp),\r\n                colors = TextFieldDefaults.colors(\r\n                    disabledContainerColor = Color.White.copy(alpha = 0.8f),\r\n                    disabledTextColor = Color.Black,\r\n                    disabledPlaceholderColor = Color.Gray,\r\n                    disabledIndicatorColor = Color.Transparent\r\n                ),\r\n                isError = error != null,\r\n                supportingText = { if (error != null) Text(text = error, color = MaterialTheme.colorScheme.error) }\r\n            )\r\n        }\r\n    }\r\n}
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/app/src/main/java/com/nextapp/monasterio/ui/screens/ReservaScreen.kt b/app/src/main/java/com/nextapp/monasterio/ui/screens/ReservaScreen.kt
--- a/app/src/main/java/com/nextapp/monasterio/ui/screens/ReservaScreen.kt	(revision 26d1bc7c4208f8005e97b4491e6d203945b2c691)
+++ b/app/src/main/java/com/nextapp/monasterio/ui/screens/ReservaScreen.kt	(date 1765214558555)
@@ -37,7 +37,7 @@
 import androidx.compose.ui.draw.shadow
 import com.nextapp.monasterio.viewModels.InfoViewModel
 import java.util.Date
-
+import com.nextapp.monasterio.ui.components.MonasteryButton
 @OptIn(ExperimentalMaterial3Api::class)
 @Composable
 fun ReservaScreen(
@@ -270,7 +270,7 @@
 
                         Spacer(Modifier.height(32.dp))
 
-                        Button(
+                        MonasteryButton(
                             onClick = { validarYConfirmar() },
                             modifier = Modifier.fillMaxWidth().height(50.dp).shadow(8.dp, RoundedCornerShape(8.dp)),
                             colors = ButtonDefaults.buttonColors(containerColor = colorResource(R.color.MonasteryBlue))
Index: app/src/main/java/com/nextapp/monasterio/ui/screens/JuegoPuzzleScreen.kt
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>package com.nextapp.monasterio.ui.screens\r\n\r\nimport android.app.Activity\r\nimport android.content.pm.ActivityInfo\r\nimport android.content.res.Configuration\r\nimport androidx.compose.foundation.Image\r\nimport androidx.compose.foundation.layout.*\r\nimport androidx.compose.foundation.rememberScrollState\r\nimport androidx.compose.foundation.shape.RoundedCornerShape\r\nimport androidx.compose.foundation.verticalScroll\r\nimport androidx.compose.material3.Button\r\nimport androidx.compose.material3.ButtonDefaults\r\nimport androidx.compose.material3.Text\r\nimport androidx.compose.runtime.Composable\r\nimport androidx.compose.runtime.DisposableEffect\r\nimport androidx.compose.ui.Alignment\r\nimport androidx.compose.ui.Modifier\r\nimport androidx.compose.ui.draw.shadow\r\nimport androidx.compose.ui.graphics.Color\r\nimport androidx.compose.ui.layout.ContentScale\r\nimport androidx.compose.ui.platform.LocalConfiguration\r\nimport androidx.compose.ui.platform.LocalContext\r\nimport androidx.compose.ui.res.painterResource\r\nimport androidx.compose.ui.res.stringResource\r\nimport androidx.compose.ui.text.font.FontWeight\r\nimport androidx.compose.ui.text.style.TextAlign\r\nimport androidx.compose.ui.unit.dp\r\nimport androidx.compose.ui.unit.sp\r\nimport androidx.navigation.NavController\r\nimport com.nextapp.monasterio.AppRoutes\r\nimport com.nextapp.monasterio.R\r\nimport com.nextapp.monasterio.ui.theme.MonasteryBlue\r\n\r\n@Composable\r\nfun JuegoPuzzleScreen(\r\n    navController: NavController,\r\n    modifier: Modifier = Modifier,\r\n    topPadding: PaddingValues = PaddingValues(0.dp) // Recibimos el padding\r\n) {\r\n    val context = LocalContext.current\r\n    val activity = (context as? Activity)\r\n\r\n    // Detectar orientación\r\n    val configuration = LocalConfiguration.current\r\n    val isLandscape = configuration.orientation == Configuration.ORIENTATION_LANDSCAPE\r\n\r\n    // Permitir rotación\r\n    DisposableEffect(Unit) {\r\n        activity?.requestedOrientation = ActivityInfo.SCREEN_ORIENTATION_UNSPECIFIED\r\n        onDispose { }\r\n    }\r\n\r\n    // --- ESTRUCTURA PRINCIPAL ---\r\n    Box(modifier = modifier.fillMaxSize()) {\r\n\r\n        // 1. FONDO (Ocupa TODO, sin padding)\r\n        Image(\r\n            painter = painterResource(R.drawable.fondo),\r\n            contentDescription = \"Fondo\",\r\n            contentScale = ContentScale.Crop,\r\n            modifier = Modifier.fillMaxSize()\r\n        )\r\n\r\n        // 2. CONTENIDO (Respeta la barra superior)\r\n        Box(\r\n            modifier = Modifier\r\n                .fillMaxSize()\r\n                .padding(topPadding)\r\n        ) {\r\n            // Contenedor interno con margen\r\n            Box(\r\n                modifier = Modifier\r\n                    .fillMaxSize()\r\n                    .padding(24.dp),\r\n                contentAlignment = Alignment.Center\r\n            ) {\r\n                if (isLandscape) {\r\n                    // --- DISEÑO HORIZONTAL (Cuadrícula 2x2) ---\r\n                    Column(\r\n                        modifier = Modifier.fillMaxSize(),\r\n                        verticalArrangement = Arrangement.spacedBy(16.dp),\r\n                        horizontalAlignment = Alignment.CenterHorizontally\r\n                    ) {\r\n                        // Fila 1 (Nivel 1 y 2)\r\n                        Row(\r\n                            modifier = Modifier.weight(1f),\r\n                            horizontalArrangement = Arrangement.spacedBy(16.dp)\r\n                        ) {\r\n                            PuzzleGameButton(\r\n                                text = stringResource(id = R.string.four_pieces),\r\n                                modifier = Modifier.weight(1f).fillMaxHeight(0.8f),\r\n                                onClick = { navController.navigate(AppRoutes.PUZZLENIVEL1) }\r\n                            )\r\n                            PuzzleGameButton(\r\n                                text = stringResource(id = R.string.nine_pieces),\r\n                                modifier = Modifier.weight(1f).fillMaxHeight(0.8f),\r\n                                onClick = { navController.navigate(AppRoutes.PUZZLENIVEL2) }\r\n                            )\r\n                        }\r\n\r\n                        // Fila 2 (Nivel 3 y 4)\r\n                        Row(\r\n                            modifier = Modifier.weight(1f),\r\n                            horizontalArrangement = Arrangement.spacedBy(16.dp)\r\n                        ) {\r\n                            PuzzleGameButton(\r\n                                text = stringResource(id = R.string.sixteen_pieces),\r\n                                modifier = Modifier.weight(1f).fillMaxHeight(0.8f),\r\n                                onClick = { navController.navigate(AppRoutes.PUZZLENIVEL3) }\r\n                            )\r\n                            PuzzleGameButton(\r\n                                text = stringResource(id = R.string.twentyfive_pieces),\r\n                                modifier = Modifier.weight(1f).fillMaxHeight(0.8f),\r\n                                onClick = { navController.navigate(AppRoutes.PUZZLENIVEL4) }\r\n                            )\r\n                        }\r\n                    }\r\n                } else {\r\n                    // --- DISEÑO VERTICAL (Lista) ---\r\n                    Column(\r\n                        modifier = Modifier\r\n                            .fillMaxWidth()\r\n                            .verticalScroll(rememberScrollState()),\r\n                        verticalArrangement = Arrangement.spacedBy(24.dp),\r\n                        horizontalAlignment = Alignment.CenterHorizontally\r\n                    ) {\r\n                        PuzzleGameButton(\r\n                            text = stringResource(id = R.string.four_pieces),\r\n                            modifier = Modifier.fillMaxWidth().height(100.dp),\r\n                            onClick = { navController.navigate(AppRoutes.PUZZLENIVEL1) }\r\n                        )\r\n\r\n                        PuzzleGameButton(\r\n                            text = stringResource(id = R.string.nine_pieces),\r\n                            modifier = Modifier.fillMaxWidth().height(100.dp),\r\n                            onClick = { navController.navigate(AppRoutes.PUZZLENIVEL2) }\r\n                        )\r\n\r\n                        PuzzleGameButton(\r\n                            text = stringResource(id = R.string.sixteen_pieces),\r\n                            modifier = Modifier.fillMaxWidth().height(100.dp),\r\n                            onClick = { navController.navigate(AppRoutes.PUZZLENIVEL3) }\r\n                        )\r\n\r\n                        PuzzleGameButton(\r\n                            text = stringResource(id = R.string.twentyfive_pieces),\r\n                            modifier = Modifier.fillMaxWidth().height(100.dp),\r\n                            onClick = { navController.navigate(AppRoutes.PUZZLENIVEL4) }\r\n                        )\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\n// --- COMPONENTE REUTILIZABLE PARA BOTONES ---\r\n@Composable\r\nfun PuzzleGameButton(\r\n    text: String,\r\n    modifier: Modifier = Modifier,\r\n    onClick: () -> Unit\r\n) {\r\n    Button(\r\n        onClick = onClick,\r\n        colors = ButtonDefaults.buttonColors(containerColor = MonasteryBlue),\r\n        shape = RoundedCornerShape(20.dp),\r\n        modifier = modifier.shadow(8.dp, RoundedCornerShape(20.dp)),\r\n        contentPadding = PaddingValues(16.dp)\r\n    ) {\r\n        Box(\r\n            modifier = Modifier.fillMaxSize(),\r\n            contentAlignment = Alignment.Center\r\n        ) {\r\n            Text(\r\n                text = text,\r\n                fontSize = 22.sp,\r\n                fontWeight = FontWeight.Bold,\r\n                textAlign = TextAlign.Center,\r\n                color = Color.White\r\n            )\r\n        }\r\n    }\r\n}
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/app/src/main/java/com/nextapp/monasterio/ui/screens/JuegoPuzzleScreen.kt b/app/src/main/java/com/nextapp/monasterio/ui/screens/JuegoPuzzleScreen.kt
--- a/app/src/main/java/com/nextapp/monasterio/ui/screens/JuegoPuzzleScreen.kt	(revision 26d1bc7c4208f8005e97b4491e6d203945b2c691)
+++ b/app/src/main/java/com/nextapp/monasterio/ui/screens/JuegoPuzzleScreen.kt	(date 1765214377468)
@@ -30,7 +30,7 @@
 import com.nextapp.monasterio.AppRoutes
 import com.nextapp.monasterio.R
 import com.nextapp.monasterio.ui.theme.MonasteryBlue
-
+import com.nextapp.monasterio.ui.components.MonasteryButton
 @Composable
 fun JuegoPuzzleScreen(
     navController: NavController,
@@ -161,7 +161,7 @@
     modifier: Modifier = Modifier,
     onClick: () -> Unit
 ) {
-    Button(
+    MonasteryButton(
         onClick = onClick,
         colors = ButtonDefaults.buttonColors(containerColor = MonasteryBlue),
         shape = RoundedCornerShape(20.dp),
Index: app/src/main/java/com/nextapp/monasterio/ui/screens/OpcionesJuegoNinyos.kt
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>package com.nextapp.monasterio.ui.screens\r\n\r\nimport android.app.Activity\r\nimport android.content.pm.ActivityInfo\r\nimport android.content.res.Configuration\r\nimport androidx.compose.foundation.Image\r\nimport androidx.compose.foundation.layout.*\r\nimport androidx.compose.foundation.rememberScrollState\r\nimport androidx.compose.foundation.shape.RoundedCornerShape\r\nimport androidx.compose.foundation.verticalScroll\r\nimport androidx.compose.material3.Button\r\nimport androidx.compose.material3.ButtonDefaults\r\nimport androidx.compose.material3.Icon\r\nimport androidx.compose.material3.Text\r\nimport androidx.compose.runtime.Composable\r\nimport androidx.compose.runtime.DisposableEffect\r\nimport androidx.compose.ui.Alignment\r\nimport androidx.compose.ui.Modifier\r\nimport androidx.compose.ui.draw.shadow\r\nimport androidx.compose.ui.graphics.Color\r\nimport androidx.compose.ui.layout.ContentScale\r\nimport androidx.compose.ui.platform.LocalConfiguration\r\nimport androidx.compose.ui.platform.LocalContext\r\nimport androidx.compose.ui.res.painterResource\r\nimport androidx.compose.ui.res.stringResource\r\nimport androidx.compose.ui.text.font.FontWeight\r\nimport androidx.compose.ui.text.style.TextAlign\r\nimport androidx.compose.ui.text.style.TextOverflow\r\nimport androidx.compose.ui.unit.dp\r\nimport androidx.compose.ui.unit.sp\r\nimport androidx.navigation.NavController\r\nimport com.nextapp.monasterio.AppRoutes\r\nimport com.nextapp.monasterio.R\r\nimport com.nextapp.monasterio.ui.theme.MonasteryBlue\r\nimport com.nextapp.monasterio.ui.theme.MonasteryOrange\r\nimport com.nextapp.monasterio.ui.theme.MonasteryRed\r\n\r\n@Composable\r\nfun OpcionesJuegoNinyos(\r\n    navController: NavController,\r\n    modifier: Modifier = Modifier,\r\n    topPadding: PaddingValues = PaddingValues(0.dp) // Recibimos el padding\r\n) {\r\n    val context = LocalContext.current\r\n    val activity = (context as? Activity)\r\n\r\n    // Detectar orientación\r\n    val configuration = LocalConfiguration.current\r\n    val isLandscape = configuration.orientation == Configuration.ORIENTATION_LANDSCAPE\r\n\r\n    // Permitir rotación\r\n    DisposableEffect(Unit) {\r\n        activity?.requestedOrientation = ActivityInfo.SCREEN_ORIENTATION_UNSPECIFIED\r\n        onDispose { }\r\n    }\r\n\r\n    // --- ESTRUCTURA PRINCIPAL ---\r\n    Box(modifier = modifier.fillMaxSize()) {\r\n\r\n        // 1. FONDO (Ocupa TODO, sin padding)\r\n        Image(\r\n            painter = painterResource(R.drawable.fondo),\r\n            contentDescription = \"Fondo\",\r\n            contentScale = ContentScale.Crop,\r\n            modifier = Modifier.fillMaxSize()\r\n        )\r\n\r\n        // 2. CONTENIDO (Aplica el padding AQUÍ)\r\n        Box(\r\n            modifier = Modifier\r\n                .fillMaxSize()\r\n                .padding(topPadding) // \uD83D\uDC48 El contenido baja para no chocarse con la barra\r\n        ) {\r\n            // Contenedor interno con margen visual\r\n            Box(\r\n                modifier = Modifier\r\n                    .fillMaxSize()\r\n                    .padding(24.dp),\r\n                contentAlignment = Alignment.Center\r\n            ) {\r\n                if (isLandscape) {\r\n                    // --- DISEÑO HORIZONTAL (3 Botones en línea) ---\r\n                    Row(\r\n                        modifier = Modifier.fillMaxWidth(),\r\n                        horizontalArrangement = Arrangement.spacedBy(16.dp),\r\n                        verticalAlignment = Alignment.CenterVertically\r\n                    ) {\r\n                        // Puzzle\r\n                        GameOptionButton(\r\n                            text = stringResource(id = R.string.puzzle_option),\r\n                            iconRes = R.drawable.puzzle,\r\n                            backgroundColor = MonasteryBlue,\r\n                            modifier = Modifier.weight(1f).fillMaxHeight(0.6f),\r\n                            onClick = { navController.navigate(AppRoutes.JUEGO_PUZZLE) }\r\n                        )\r\n                        // Parejas (Memory)\r\n                        GameOptionButton(\r\n                            text = stringResource(id = R.string.memory_option),\r\n                            iconRes = R.drawable.memory,\r\n                            backgroundColor = MonasteryRed,\r\n                            modifier = Modifier.weight(1f).fillMaxHeight(0.6f),\r\n                            onClick = { navController.navigate(AppRoutes.JUEGO_PAREJAS) }\r\n                        )\r\n                        // Diferencias\r\n                        GameOptionButton(\r\n                            text = stringResource(id = R.string.differences_game),\r\n                            iconRes = R.drawable.lupa,\r\n                            backgroundColor = MonasteryOrange,\r\n                            modifier = Modifier.weight(1f).fillMaxHeight(0.6f),\r\n                            onClick = { navController.navigate(AppRoutes.JUEGO_DIFERENCIAS) }\r\n                        )\r\n                    }\r\n                } else {\r\n                    // --- DISEÑO VERTICAL (3 Botones en columna) ---\r\n                    Column(\r\n                        modifier = Modifier\r\n                            .fillMaxWidth()\r\n                            .verticalScroll(rememberScrollState()),\r\n                        verticalArrangement = Arrangement.spacedBy(32.dp), // Espacio entre botones\r\n                        horizontalAlignment = Alignment.CenterHorizontally\r\n                    ) {\r\n                        // Puzzle\r\n                        GameOptionButton(\r\n                            text = stringResource(id = R.string.puzzle_option),\r\n                            iconRes = R.drawable.puzzle,\r\n                            backgroundColor = MonasteryBlue,\r\n                            modifier = Modifier.fillMaxWidth().height(100.dp),\r\n                            onClick = { navController.navigate(AppRoutes.JUEGO_PUZZLE) }\r\n                        )\r\n\r\n                        // Parejas (Memory)\r\n                        GameOptionButton(\r\n                            text = stringResource(id = R.string.memory_option),\r\n                            iconRes = R.drawable.memory,\r\n                            backgroundColor = MonasteryRed,\r\n                            modifier = Modifier.fillMaxWidth().height(100.dp),\r\n                            onClick = { navController.navigate(AppRoutes.JUEGO_PAREJAS) }\r\n                        )\r\n\r\n                        // Diferencias\r\n                        GameOptionButton(\r\n                            text = stringResource(id = R.string.differences_game),\r\n                            iconRes = R.drawable.lupa,\r\n                            backgroundColor = MonasteryOrange,\r\n                            modifier = Modifier.fillMaxWidth().height(100.dp),\r\n                            onClick = { navController.navigate(AppRoutes.JUEGO_DIFERENCIAS) }\r\n                        )\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\n// --- COMPONENTE REUTILIZABLE PARA BOTONES DE JUEGO ---\r\n@Composable\r\nfun GameOptionButton(\r\n    text: String,\r\n    iconRes: Int,\r\n    backgroundColor: Color,\r\n    modifier: Modifier = Modifier,\r\n    onClick: () -> Unit\r\n) {\r\n    Button(\r\n        onClick = onClick,\r\n        colors = ButtonDefaults.buttonColors(containerColor = backgroundColor),\r\n        shape = RoundedCornerShape(20.dp),\r\n        modifier = modifier,\r\n        elevation = ButtonDefaults.buttonElevation(8.dp)\r\n    ) {\r\n        Row(\r\n            modifier = Modifier.fillMaxWidth(),\r\n            verticalAlignment = Alignment.CenterVertically,\r\n            horizontalArrangement = Arrangement.Start\r\n        ) {\r\n            Icon(\r\n                painter = painterResource(id = iconRes),\r\n                contentDescription = null,\r\n                modifier = Modifier.size(48.dp)\r\n            )\r\n            Spacer(modifier = Modifier.width(16.dp))\r\n            Text(\r\n                text = text,\r\n                fontSize = 20.sp,\r\n                fontWeight = FontWeight.Bold,\r\n                textAlign = TextAlign.Center,\r\n                overflow = TextOverflow.Ellipsis,\r\n                modifier = Modifier.weight(1f)\r\n            )\r\n            Spacer(modifier = Modifier.width(10.dp))\r\n        }\r\n    }\r\n}
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/app/src/main/java/com/nextapp/monasterio/ui/screens/OpcionesJuegoNinyos.kt b/app/src/main/java/com/nextapp/monasterio/ui/screens/OpcionesJuegoNinyos.kt
--- a/app/src/main/java/com/nextapp/monasterio/ui/screens/OpcionesJuegoNinyos.kt	(revision 26d1bc7c4208f8005e97b4491e6d203945b2c691)
+++ b/app/src/main/java/com/nextapp/monasterio/ui/screens/OpcionesJuegoNinyos.kt	(date 1765214239001)
@@ -34,7 +34,7 @@
 import com.nextapp.monasterio.ui.theme.MonasteryBlue
 import com.nextapp.monasterio.ui.theme.MonasteryOrange
 import com.nextapp.monasterio.ui.theme.MonasteryRed
-
+import com.nextapp.monasterio.ui.components.MonasteryButton
 @Composable
 fun OpcionesJuegoNinyos(
     navController: NavController,
@@ -161,7 +161,7 @@
     modifier: Modifier = Modifier,
     onClick: () -> Unit
 ) {
-    Button(
+    MonasteryButton(
         onClick = onClick,
         colors = ButtonDefaults.buttonColors(containerColor = backgroundColor),
         shape = RoundedCornerShape(20.dp),
Index: app/src/main/java/com/nextapp/monasterio/ui/screens/HomeScreen.kt
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>package com.nextapp.monasterio.ui.screens\r\n\r\nimport android.app.Activity\r\nimport android.content.pm.ActivityInfo\r\nimport android.content.res.Configuration\r\nimport androidx.compose.foundation.Image\r\nimport androidx.compose.foundation.clickable\r\nimport androidx.compose.foundation.layout.*\r\nimport androidx.compose.foundation.rememberScrollState\r\nimport androidx.compose.foundation.shape.RoundedCornerShape\r\nimport androidx.compose.foundation.verticalScroll\r\nimport androidx.compose.material3.*\r\nimport androidx.compose.runtime.*\r\nimport androidx.compose.ui.Alignment\r\nimport androidx.compose.ui.Modifier\r\nimport androidx.compose.ui.draw.clip\r\nimport androidx.compose.ui.draw.scale\r\nimport androidx.compose.ui.graphics.Color\r\nimport androidx.compose.ui.layout.ContentScale\r\nimport androidx.compose.ui.platform.LocalConfiguration\r\nimport androidx.compose.ui.platform.LocalContext\r\nimport androidx.compose.ui.res.painterResource\r\nimport androidx.compose.ui.res.stringResource\r\nimport androidx.compose.ui.text.font.FontWeight\r\nimport androidx.compose.ui.text.style.TextAlign\r\nimport androidx.compose.ui.text.style.TextOverflow\r\nimport androidx.compose.ui.unit.dp\r\nimport androidx.compose.ui.unit.sp\r\nimport androidx.lifecycle.viewmodel.compose.viewModel\r\nimport androidx.navigation.NavController\r\nimport coil.compose.AsyncImage\r\nimport com.nextapp.monasterio.models.User\r\nimport com.nextapp.monasterio.AppRoutes\r\nimport com.nextapp.monasterio.R\r\nimport com.nextapp.monasterio.repository.ImagenRepository\r\nimport com.nextapp.monasterio.ui.theme.MonasteryBlue\r\nimport com.nextapp.monasterio.ui.theme.MonasteryOrange\r\nimport com.nextapp.monasterio.viewModels.AuthViewModel\r\nimport androidx.lifecycle.viewmodel.compose.viewModel\r\nimport android.media.MediaPlayer\r\n\r\n@Composable\r\nfun HomeScreenContent(\r\n    navController: NavController,\r\n    topPadding: PaddingValues = PaddingValues(0.dp),\r\n    authViewModel: AuthViewModel = viewModel()\r\n) {\r\n    val context = LocalContext.current\r\n    val buttonSoundPlayer = remember {\r\n        // Asegúrate de que 'click_button' existe en res/raw, o cambia el nombre\r\n        MediaPlayer.create(context, R.raw.botones)\r\n    }\r\n    val activity = (context as? Activity)\r\n    val repo = ImagenRepository()\r\n    var imagenFondoInicio by remember { mutableStateOf<String?>(null) }\r\n\r\n    val configuration = LocalConfiguration.current\r\n    val isLandscape = configuration.orientation == Configuration.ORIENTATION_LANDSCAPE\r\n\r\n    val userState by authViewModel.currentUser.collectAsState()\r\n    val currentUser = userState\r\n\r\n    val playClickSound = {\r\n        if (buttonSoundPlayer != null) {\r\n            if (buttonSoundPlayer.isPlaying) {\r\n                buttonSoundPlayer.seekTo(0)\r\n            }\r\n            buttonSoundPlayer.start()\r\n        }\r\n    }\r\n\r\n    LaunchedEffect(Unit) {\r\n        val data = repo.getImagenFondoInicio()\r\n        imagenFondoInicio = data?.url\r\n    }\r\n\r\n    DisposableEffect(Unit) {\r\n        activity?.requestedOrientation = ActivityInfo.SCREEN_ORIENTATION_UNSPECIFIED\r\n        onDispose {buttonSoundPlayer?.release()}\r\n    }\r\n\r\n    Box(modifier = Modifier.fillMaxSize()) {\r\n        // 1. FONDO\r\n        if (imagenFondoInicio != null) {\r\n            AsyncImage(\r\n                model = imagenFondoInicio,\r\n                contentDescription = null,\r\n                contentScale = ContentScale.Crop,\r\n                modifier = Modifier.fillMaxSize()\r\n            )\r\n        } else {\r\n            Image(\r\n                painter = painterResource(id = R.drawable.monastery_background),\r\n                contentDescription = null,\r\n                contentScale = ContentScale.Crop,\r\n                modifier = Modifier.fillMaxSize()\r\n            )\r\n        }\r\n\r\n        // 2. CONTENIDO\r\n        Box(\r\n            modifier = Modifier\r\n                .fillMaxSize()\r\n                .padding(topPadding)\r\n        ) {\r\n            if (isLandscape) {\r\n                LandscapeLayout(navController, currentUser, playClickSound)\r\n            } else {\r\n                PortraitLayout(navController, currentUser, playClickSound)\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\n// =============================================================================\r\n// DISEÑO VERTICAL (PORTRAIT)\r\n// =============================================================================\r\n@Composable\r\nfun PortraitLayout(\r\n    navController: NavController,\r\n    currentUser: User?,\r\n    onPlaySound: () -> Unit\r\n) {\r\n    Column(\r\n        modifier = Modifier\r\n            .fillMaxSize()\r\n            .verticalScroll(rememberScrollState())\r\n            .padding(24.dp),\r\n        horizontalAlignment = Alignment.CenterHorizontally, // Centrado general\r\n        verticalArrangement = Arrangement.Center\r\n    ) {\r\n        // Logo Superior\r\n        Image(\r\n            painter = painterResource(id = R.drawable.huelgas_inicio),\r\n            contentDescription = \"Logo\",\r\n            contentScale = ContentScale.FillWidth,\r\n            modifier = Modifier\r\n                .fillMaxWidth()\r\n                .scale(1.1f) // Un poco más grande visualmente\r\n                .padding(bottom = 48.dp)\r\n        )\r\n\r\n        val buttonModifier = Modifier\r\n            .fillMaxWidth()\r\n            .height(80.dp)\r\n\r\n        // 1. Visita\r\n        HomeListButton(\r\n            text = stringResource(R.string.virtual_visit),\r\n            iconRes = R.drawable.ic_map_24,\r\n            backgroundColor = MonasteryOrange,\r\n            modifier = buttonModifier,\r\n            onClick = { onPlaySound()\r\n                navController.navigate(AppRoutes.VIRTUAL_VISIT) }\r\n        )\r\n\r\n        Spacer(modifier = Modifier.height(24.dp))\r\n\r\n        // 2. Niños\r\n        HomeListButton(\r\n            text = stringResource(R.string.child_mode),\r\n            iconRes = R.drawable.outline_account_child_invert_24,\r\n            backgroundColor = Color(0xFF6EB017),\r\n            modifier = buttonModifier,\r\n            onClick = { onPlaySound()\r\n                navController.navigate(AppRoutes.MODO_NINYOS) }\r\n        )\r\n\r\n        Spacer(modifier = Modifier.height(24.dp))\r\n\r\n        // 3. Reserva\r\n        HomeListButton(\r\n            text = stringResource(R.string.book_appointment),\r\n            iconRes = R.drawable.ic_time_24,\r\n            backgroundColor = MonasteryBlue,\r\n            modifier = buttonModifier,\r\n            onClick = { onPlaySound()\r\n                navController.navigate(AppRoutes.OPCIONES_RESERVA) }\r\n        )\r\n\r\n        // 4. Edición\r\n        if (currentUser != null) {\r\n            Spacer(modifier = Modifier.height(24.dp))\r\n            HomeListButton(\r\n                text = stringResource(R.string.edit_mode_button),\r\n                iconRes = R.drawable.lapiz,\r\n                backgroundColor = Color(0xFF9C27B0),\r\n                modifier = buttonModifier,\r\n                onClick = { onPlaySound()\r\n                    navController.navigate(AppRoutes.MODO_EDICION) }\r\n            )\r\n        }\r\n        Spacer(modifier = Modifier.height(40.dp))\r\n    }\r\n}\r\n\r\n// =============================================================================\r\n// DISEÑO HORIZONTAL (LANDSCAPE)\r\n// =============================================================================\r\n@Composable\r\nfun LandscapeLayout(\r\n    navController: NavController,\r\n    currentUser: User?,\r\n    onPlaySound: () -> Unit\r\n) {\r\n    Row(\r\n        modifier = Modifier\r\n            .fillMaxSize()\r\n            .padding(16.dp)\r\n            .statusBarsPadding()\r\n    ) {\r\n        // IZQUIERDA: Logo (40% ancho)\r\n        Box(\r\n            modifier = Modifier\r\n                .weight(0.4f)\r\n                .fillMaxHeight(),\r\n            contentAlignment = Alignment.Center\r\n        ) {\r\n            Image(\r\n                painter = painterResource(id = R.drawable.huelgas_inicio),\r\n                contentDescription = \"Logo\",\r\n                contentScale = ContentScale.Fit,\r\n                modifier = Modifier\r\n                    .fillMaxSize()\r\n                    .scale(1.1f)\r\n            )\r\n        }\r\n\r\n        Spacer(modifier = Modifier.width(16.dp))\r\n\r\n        // DERECHA: Cuadrícula (60% ancho)\r\n        Column(\r\n            modifier = Modifier\r\n                .weight(0.6f)\r\n                .fillMaxHeight(),\r\n            verticalArrangement = Arrangement.spacedBy(12.dp),\r\n            horizontalAlignment = Alignment.CenterHorizontally // Alineados a la derecha si sobra espacio\r\n        ) {\r\n            // FILA 1\r\n            Row(\r\n                modifier = Modifier.weight(1f),\r\n                horizontalArrangement = Arrangement.spacedBy(12.dp)\r\n            ) {\r\n                HomeGridButton(\r\n                    text = stringResource(R.string.virtual_visit),\r\n                    iconRes = R.drawable.ic_map_24,\r\n                    backgroundColor = MonasteryOrange,\r\n                    modifier = Modifier.weight(1f),\r\n                    onClick = { onPlaySound()\r\n                        navController.navigate(AppRoutes.VIRTUAL_VISIT) }\r\n                )\r\n                HomeGridButton(\r\n                    text = stringResource(R.string.child_mode),\r\n                    iconRes = R.drawable.outline_account_child_invert_24,\r\n                    backgroundColor = Color(0xFF6EB017),\r\n                    modifier = Modifier.weight(1f),\r\n                    onClick = { onPlaySound()\r\n                        navController.navigate(AppRoutes.MODO_NINYOS) }\r\n                )\r\n            }\r\n\r\n            // FILA 2\r\n            Row(\r\n                modifier = Modifier.weight(1f),\r\n                horizontalArrangement = Arrangement.spacedBy(12.dp)\r\n            ) {\r\n                HomeGridButton(\r\n                    text = stringResource(R.string.book_appointment),\r\n                    iconRes = R.drawable.ic_time_24,\r\n                    backgroundColor = MonasteryBlue,\r\n                    modifier = Modifier.weight(1f),\r\n                    onClick = { onPlaySound()\r\n                        navController.navigate(AppRoutes.OPCIONES_RESERVA) }\r\n                )\r\n\r\n                if (currentUser != null) {\r\n                    HomeGridButton(\r\n                        text = stringResource(R.string.edit_mode_button),\r\n                        iconRes = R.drawable.lapiz,\r\n                        backgroundColor = Color(0xFF9C27B0),\r\n                        modifier = Modifier.weight(1f),\r\n                        onClick = { onPlaySound()\r\n                            navController.navigate(AppRoutes.MODO_EDICION) }\r\n                    )\r\n                } else {\r\n                    Spacer(modifier = Modifier.weight(1f))\r\n                }\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\n// =============================================================================\r\n// COMPONENTES\r\n// =============================================================================\r\n\r\n@Composable\r\nfun HomeListButton(\r\n    text: String,\r\n    iconRes: Int,\r\n    backgroundColor: Color,\r\n    modifier: Modifier = Modifier,\r\n    onClick: () -> Unit\r\n) {\r\n    Button(\r\n        onClick = onClick,\r\n        colors = ButtonDefaults.buttonColors(containerColor = backgroundColor),\r\n        shape = RoundedCornerShape(20.dp),\r\n        modifier = modifier,\r\n        elevation = ButtonDefaults.buttonElevation(8.dp)\r\n    ) {\r\n        Row(\r\n            modifier = Modifier.fillMaxWidth(),\r\n            verticalAlignment = Alignment.CenterVertically,\r\n            horizontalArrangement = Arrangement.Start\r\n        ) {\r\n            Icon(\r\n                painter = painterResource(id = iconRes),\r\n                contentDescription = null,\r\n                modifier = Modifier.size(48.dp)\r\n            )\r\n            Spacer(modifier = Modifier.width(16.dp))\r\n            Text(\r\n                text = text,\r\n                fontSize = 20.sp,\r\n                fontWeight = FontWeight.Bold,\r\n                textAlign = TextAlign.Center,\r\n                modifier = Modifier.weight(1f)\r\n            )\r\n        }\r\n    }\r\n}\r\n\r\n@Composable\r\nfun HomeGridButton(\r\n    text: String,\r\n    iconRes: Int,\r\n    backgroundColor: Color,\r\n    modifier: Modifier = Modifier,\r\n    onClick: () -> Unit\r\n) {\r\n    Card(\r\n        modifier = modifier\r\n            .fillMaxHeight()\r\n            .clip(RoundedCornerShape(16.dp))\r\n            .clickable { onClick() },\r\n        colors = CardDefaults.cardColors(containerColor = backgroundColor),\r\n        elevation = CardDefaults.cardElevation(8.dp)\r\n    ) {\r\n        BoxWithConstraints(\r\n            modifier = Modifier\r\n                .fillMaxSize()\r\n                .padding(8.dp),\r\n            contentAlignment = Alignment.Center\r\n        ) {\r\n            // Autoajuste de tamaño según espacio disponible\r\n            val availableHeight = maxHeight\r\n            val iconSize = if (availableHeight < 100.dp) 24.dp else 40.dp\r\n            val textSize = if (availableHeight < 100.dp) 14.sp else 18.sp\r\n\r\n            Column(\r\n                horizontalAlignment = Alignment.CenterHorizontally,\r\n                verticalArrangement = Arrangement.Center\r\n            ) {\r\n                Icon(\r\n                    painter = painterResource(id = iconRes),\r\n                    contentDescription = null,\r\n                    modifier = Modifier.size(iconSize),\r\n                    tint = Color.White\r\n                )\r\n                Spacer(modifier = Modifier.height(8.dp))\r\n                Text(\r\n                    text = text,\r\n                    fontSize = textSize,\r\n                    fontWeight = FontWeight.Bold,\r\n                    color = Color.White,\r\n                    textAlign = TextAlign.Center,\r\n                    lineHeight = textSize * 1.1,\r\n                )\r\n            }\r\n        }\r\n    }\r\n}
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/app/src/main/java/com/nextapp/monasterio/ui/screens/HomeScreen.kt b/app/src/main/java/com/nextapp/monasterio/ui/screens/HomeScreen.kt
--- a/app/src/main/java/com/nextapp/monasterio/ui/screens/HomeScreen.kt	(revision 26d1bc7c4208f8005e97b4491e6d203945b2c691)
+++ b/app/src/main/java/com/nextapp/monasterio/ui/screens/HomeScreen.kt	(date 1765214149053)
@@ -38,7 +38,7 @@
 import com.nextapp.monasterio.viewModels.AuthViewModel
 import androidx.lifecycle.viewmodel.compose.viewModel
 import android.media.MediaPlayer
-
+import com.nextapp.monasterio.ui.components.MonasteryButton
 @Composable
 fun HomeScreenContent(
     navController: NavController,
@@ -46,10 +46,6 @@
     authViewModel: AuthViewModel = viewModel()
 ) {
     val context = LocalContext.current
-    val buttonSoundPlayer = remember {
-        // Asegúrate de que 'click_button' existe en res/raw, o cambia el nombre
-        MediaPlayer.create(context, R.raw.botones)
-    }
     val activity = (context as? Activity)
     val repo = ImagenRepository()
     var imagenFondoInicio by remember { mutableStateOf<String?>(null) }
@@ -60,15 +56,6 @@
     val userState by authViewModel.currentUser.collectAsState()
     val currentUser = userState
 
-    val playClickSound = {
-        if (buttonSoundPlayer != null) {
-            if (buttonSoundPlayer.isPlaying) {
-                buttonSoundPlayer.seekTo(0)
-            }
-            buttonSoundPlayer.start()
-        }
-    }
-
     LaunchedEffect(Unit) {
         val data = repo.getImagenFondoInicio()
         imagenFondoInicio = data?.url
@@ -76,7 +63,7 @@
 
     DisposableEffect(Unit) {
         activity?.requestedOrientation = ActivityInfo.SCREEN_ORIENTATION_UNSPECIFIED
-        onDispose {buttonSoundPlayer?.release()}
+        onDispose {}
     }
 
     Box(modifier = Modifier.fillMaxSize()) {
@@ -104,9 +91,9 @@
                 .padding(topPadding)
         ) {
             if (isLandscape) {
-                LandscapeLayout(navController, currentUser, playClickSound)
+                LandscapeLayout(navController, currentUser)
             } else {
-                PortraitLayout(navController, currentUser, playClickSound)
+                PortraitLayout(navController, currentUser)
             }
         }
     }
@@ -118,8 +105,7 @@
 @Composable
 fun PortraitLayout(
     navController: NavController,
-    currentUser: User?,
-    onPlaySound: () -> Unit
+    currentUser: User?
 ) {
     Column(
         modifier = Modifier
@@ -150,8 +136,7 @@
             iconRes = R.drawable.ic_map_24,
             backgroundColor = MonasteryOrange,
             modifier = buttonModifier,
-            onClick = { onPlaySound()
-                navController.navigate(AppRoutes.VIRTUAL_VISIT) }
+            onClick = { navController.navigate(AppRoutes.VIRTUAL_VISIT) }
         )
 
         Spacer(modifier = Modifier.height(24.dp))
@@ -162,8 +147,7 @@
             iconRes = R.drawable.outline_account_child_invert_24,
             backgroundColor = Color(0xFF6EB017),
             modifier = buttonModifier,
-            onClick = { onPlaySound()
-                navController.navigate(AppRoutes.MODO_NINYOS) }
+            onClick = { navController.navigate(AppRoutes.MODO_NINYOS) }
         )
 
         Spacer(modifier = Modifier.height(24.dp))
@@ -174,8 +158,7 @@
             iconRes = R.drawable.ic_time_24,
             backgroundColor = MonasteryBlue,
             modifier = buttonModifier,
-            onClick = { onPlaySound()
-                navController.navigate(AppRoutes.OPCIONES_RESERVA) }
+            onClick = { navController.navigate(AppRoutes.OPCIONES_RESERVA) }
         )
 
         // 4. Edición
@@ -186,8 +169,7 @@
                 iconRes = R.drawable.lapiz,
                 backgroundColor = Color(0xFF9C27B0),
                 modifier = buttonModifier,
-                onClick = { onPlaySound()
-                    navController.navigate(AppRoutes.MODO_EDICION) }
+                onClick = { navController.navigate(AppRoutes.MODO_EDICION) }
             )
         }
         Spacer(modifier = Modifier.height(40.dp))
@@ -200,8 +182,7 @@
 @Composable
 fun LandscapeLayout(
     navController: NavController,
-    currentUser: User?,
-    onPlaySound: () -> Unit
+    currentUser: User?
 ) {
     Row(
         modifier = Modifier
@@ -246,16 +227,14 @@
                     iconRes = R.drawable.ic_map_24,
                     backgroundColor = MonasteryOrange,
                     modifier = Modifier.weight(1f),
-                    onClick = { onPlaySound()
-                        navController.navigate(AppRoutes.VIRTUAL_VISIT) }
+                    onClick = { navController.navigate(AppRoutes.VIRTUAL_VISIT) }
                 )
                 HomeGridButton(
                     text = stringResource(R.string.child_mode),
                     iconRes = R.drawable.outline_account_child_invert_24,
                     backgroundColor = Color(0xFF6EB017),
                     modifier = Modifier.weight(1f),
-                    onClick = { onPlaySound()
-                        navController.navigate(AppRoutes.MODO_NINYOS) }
+                    onClick = { navController.navigate(AppRoutes.MODO_NINYOS) }
                 )
             }
 
@@ -269,8 +248,7 @@
                     iconRes = R.drawable.ic_time_24,
                     backgroundColor = MonasteryBlue,
                     modifier = Modifier.weight(1f),
-                    onClick = { onPlaySound()
-                        navController.navigate(AppRoutes.OPCIONES_RESERVA) }
+                    onClick = { navController.navigate(AppRoutes.OPCIONES_RESERVA) }
                 )
 
                 if (currentUser != null) {
@@ -279,8 +257,7 @@
                         iconRes = R.drawable.lapiz,
                         backgroundColor = Color(0xFF9C27B0),
                         modifier = Modifier.weight(1f),
-                        onClick = { onPlaySound()
-                            navController.navigate(AppRoutes.MODO_EDICION) }
+                        onClick = { navController.navigate(AppRoutes.MODO_EDICION) }
                     )
                 } else {
                     Spacer(modifier = Modifier.weight(1f))
@@ -302,7 +279,7 @@
     modifier: Modifier = Modifier,
     onClick: () -> Unit
 ) {
-    Button(
+     MonasteryButton(
         onClick = onClick,
         colors = ButtonDefaults.buttonColors(containerColor = backgroundColor),
         shape = RoundedCornerShape(20.dp),
Index: app/src/main/java/com/nextapp/monasterio/ui/virtualvisit/screens/PinDetalleScreen.kt
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>package com.nextapp.monasterio.ui.virtualvisit.screens\r\n\r\nimport android.app.Activity\r\nimport android.content.pm.ActivityInfo\r\nimport android.util.Log\r\nimport androidx.compose.animation.core.FastOutSlowInEasing\r\nimport androidx.compose.animation.core.tween\r\nimport androidx.compose.foundation.*\r\nimport androidx.compose.foundation.layout.*\r\nimport androidx.compose.foundation.pager.HorizontalPager\r\nimport androidx.compose.foundation.pager.rememberPagerState\r\nimport androidx.compose.foundation.shape.CircleShape\r\nimport androidx.compose.foundation.shape.RoundedCornerShape\r\nimport androidx.compose.material3.*\r\nimport androidx.compose.runtime.*\r\nimport androidx.compose.ui.Alignment\r\nimport androidx.compose.ui.BiasAlignment\r\nimport androidx.compose.ui.Modifier\r\nimport androidx.compose.ui.draw.clip\r\nimport androidx.compose.ui.geometry.Offset\r\nimport androidx.compose.ui.geometry.Size\r\nimport androidx.compose.ui.graphics.Color\r\nimport androidx.compose.ui.layout.ContentScale\r\nimport androidx.compose.ui.layout.onGloballyPositioned\r\nimport androidx.compose.ui.layout.positionInRoot\r\nimport androidx.compose.ui.platform.LocalConfiguration\r\nimport androidx.compose.ui.platform.LocalContext\r\nimport androidx.compose.ui.platform.LocalView\r\nimport androidx.compose.ui.res.painterResource\r\nimport androidx.compose.ui.res.stringResource\r\nimport androidx.compose.ui.text.font.FontWeight\r\nimport androidx.compose.ui.text.style.TextAlign\r\nimport androidx.compose.ui.unit.dp\r\nimport androidx.compose.ui.unit.sp\r\nimport androidx.compose.ui.viewinterop.AndroidView\r\nimport androidx.compose.ui.window.Dialog\r\nimport androidx.compose.ui.window.DialogProperties\r\nimport androidx.core.view.WindowCompat\r\nimport androidx.media3.common.MediaItem\r\nimport androidx.media3.common.Player\r\nimport androidx.media3.exoplayer.ExoPlayer\r\nimport coil.compose.AsyncImage\r\nimport coil.load\r\nimport com.github.chrisbanes.photoview.PhotoView\r\nimport com.nextapp.monasterio.R\r\nimport com.nextapp.monasterio.models.ImagenData\r\nimport com.nextapp.monasterio.models.PinData\r\nimport com.nextapp.monasterio.ui.virtualvisit.components.GenericTutorialOverlay\r\nimport com.nextapp.monasterio.viewModels.AjustesViewModel\r\nimport java.util.Locale\r\n\r\n\r\nprivate data class PinTutorialStep(\r\n    val description: String,\r\n    val focusCenter: Offset,\r\n    val focusRadius: Float = 0f,      // Para círculos\r\n    val rectSize: Size? = null,       // Para cuadrados/rectángulos\r\n    val alignment: Alignment = Alignment.BottomCenter // Dónde poner el cuadro de texto\r\n)\r\n\r\n@OptIn(ExperimentalFoundationApi::class)\r\n@Composable\r\nfun PinDetalleScreen(\r\n    viewModel: AjustesViewModel,\r\n    pin: PinData,\r\n    onBack: () -> Unit,\r\n    onVer360: (() -> Unit)? = null\r\n) {\r\n    val view = LocalView.current\r\n    LaunchedEffect(Unit) {\r\n        val window = (view.context as? Activity)?.window\r\n        window?.let { WindowCompat.setDecorFitsSystemWindows(it, false) }\r\n    }\r\n\r\n    val activity = view.context as? Activity\r\n\r\n    DisposableEffect(Unit) {\r\n        activity?.requestedOrientation = ActivityInfo.SCREEN_ORIENTATION_PORTRAIT\r\n        onDispose {\r\n            activity?.requestedOrientation = ActivityInfo.SCREEN_ORIENTATION_UNSPECIFIED\r\n        }\r\n    }\r\n\r\n    // --- LÓGICA DE ESTADO DEL TUTORIAL ---\r\n    val isPinDismissed by viewModel.isPinDismissed.collectAsState()\r\n    var showTutorialSession by remember { mutableStateOf(true) }\r\n    var currentStepIndex by remember { mutableIntStateOf(0) }\r\n\r\n    // --- VARIABLES PARA CAPTURAR POSICIONES REALES (LAYOUT) ---\r\n    // Estas variables se llenarán cuando Android dibuje la pantalla\r\n    var backButtonLayout by remember { mutableStateOf<Pair<Offset, Size>?>(null) }\r\n    var imageLayout by remember { mutableStateOf<Pair<Offset, Size>?>(null) }\r\n    var audioButtonLayout by remember { mutableStateOf<Pair<Offset, Size>?>(null) }\r\n    var button360Layout by remember { mutableStateOf<Pair<Offset, Size>?>(null) }\r\n\r\n    // --- Datos del Pin ---\r\n    val imagenes = if (pin.imagenesDetalladas.isNotEmpty()) pin.imagenesDetalladas else emptyList()\r\n    val pagerState = rememberPagerState(pageCount = { imagenes.size })\r\n    var selectedImageIndex by remember { mutableStateOf<Int?>(null)  }\r\n\r\n    if (imagenes.size > 1 && selectedImageIndex == null) {\r\n        // Usamos 'Unit' para que el LaunchedEffect no se reinicie en cada cambio de página\r\n        LaunchedEffect(Unit) {\r\n            while (true) {\r\n                kotlinx.coroutines.delay(5000L) // Espera 5 segundos\r\n\r\n                // Verificamos que el usuario no esté tocando el carrusel en este momento\r\n                if (!pagerState.isScrollInProgress) {\r\n                    val nextPage = (pagerState.currentPage + 1) % imagenes.size\r\n                    pagerState.animateScrollToPage(\r\n                        page = nextPage,\r\n                        // Animación suave para evitar saltos bruscos\r\n                        animationSpec = tween(durationMillis = 600, easing = FastOutSlowInEasing)\r\n                    )\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    val configuration = LocalConfiguration.current\r\n    val screenHeight = configuration.screenHeightDp.dp\r\n    val isTablet = configuration.screenWidthDp > 600\r\n    var carouselHeight = 0.dp\r\n    if(isTablet){carouselHeight = screenHeight*0.5f} else {carouselHeight = screenHeight*0.35f}\r\n    val locale: Locale = configuration.locales[0]\r\n    val language = locale.language\r\n\r\n    // --- Textos Multilingües ---\r\n    val titulo_pin: String // Ubicación compleja\r\n    val descripcion_pin: String // Descripción detallada\r\n    val area_pin: String? // Nombre del Área (anteriormente Ubicacion)\r\n\r\n    when (language) {\r\n        \"de\" -> {\r\n            titulo_pin = pin.ubicacion_de.orEmpty().ifBlank { pin.ubicacion_es.orEmpty() }\r\n            descripcion_pin = pin.descripcion_de.orEmpty().ifBlank { pin.descripcion_es.orEmpty() }\r\n            area_pin = pin.area_de\r\n        }\r\n        \"fr\" -> {\r\n            titulo_pin = pin.ubicacion_fr.orEmpty().ifBlank { pin.ubicacion_es.orEmpty() }\r\n            descripcion_pin = pin.descripcion_fr.orEmpty().ifBlank { pin.descripcion_es.orEmpty() }\r\n            area_pin = pin.area_fr\r\n        }\r\n        \"en\" -> {\r\n            titulo_pin = pin.ubicacion_en.orEmpty().ifBlank { pin.ubicacion_es.orEmpty() }\r\n            descripcion_pin = pin.descripcion_en.orEmpty().ifBlank { pin.descripcion_es.orEmpty() }\r\n            area_pin = pin.area_en\r\n        }\r\n        else -> { // Español por defecto\r\n            titulo_pin = pin.ubicacion_es.orEmpty()\r\n            descripcion_pin = pin.descripcion_es.orEmpty()\r\n            area_pin = pin.area_es\r\n        }\r\n    }\r\n\r\n    // --- LÓGICA DE AUDIO ---\r\n    val context = LocalContext.current\r\n    val audioUrl = when (language) {\r\n        \"en\" -> pin.audioUrl_en\r\n        \"de\" -> pin.audioUrl_de\r\n        \"fr\" -> pin.audioUrl_fr\r\n        else -> pin.audioUrl_es\r\n    }\r\n\r\n    Log.d(\"AudioDebug\", \"Pin: '${pin.ubicacion_es}', Idioma: $language, URL Audio: [$audioUrl]\")\r\n\r\n    val exoPlayer = remember { ExoPlayer.Builder(context).build() }\r\n    var isPlaying by remember { mutableStateOf(false) }\r\n    var hasUserInteracted by remember { mutableStateOf(false) }\r\n\r\n    DisposableEffect(audioUrl) {\r\n        if (!audioUrl.isNullOrBlank()) {\r\n            val mediaItem = MediaItem.fromUri(audioUrl)\r\n            exoPlayer.setMediaItem(mediaItem)\r\n            exoPlayer.prepare()\r\n        }\r\n        onDispose { }\r\n    }\r\n\r\n    LaunchedEffect(exoPlayer) {\r\n        exoPlayer.addListener(object : Player.Listener {\r\n            override fun onIsPlayingChanged(isPlayingValue: Boolean) {\r\n                isPlaying = isPlayingValue\r\n            }\r\n            override fun onPlaybackStateChanged(state: Int) {\r\n                if (state == Player.STATE_ENDED) {\r\n                    isPlaying = false\r\n                    exoPlayer.seekTo(0)\r\n                }\r\n            }\r\n        })\r\n    }\r\n\r\n    DisposableEffect(Unit) {\r\n        onDispose { exoPlayer.release() }\r\n    }\r\n\r\n    // --- UI PRINCIPAL ---\r\n    Box(\r\n        modifier = Modifier\r\n            .fillMaxSize()\r\n            .background(Color.White)\r\n            .statusBarsPadding()\r\n    ) {\r\n        Column(\r\n            modifier = Modifier\r\n                .fillMaxSize()\r\n                .padding(horizontal = 16.dp)\r\n                .padding(bottom = 40.dp),\r\n            horizontalAlignment = Alignment.CenterHorizontally\r\n        ) {\r\n            // --- CABECERA UNIFICADA (Flecha + Título) ---\r\n            Box(\r\n                modifier = Modifier\r\n                    .fillMaxWidth()\r\n                    .padding(top = 16.dp) // Margen superior general\r\n            ) {\r\n                // 1. BOTÓN ATRÁS (Alineado a la Izquierda)\r\n                Box(\r\n                    modifier = Modifier\r\n                        .align(Alignment.CenterStart) // \uD83D\uDC48 Lo pegamos a la izquierda\r\n                        // \uD83D\uDC47 MANTENEMOS TU LÓGICA DE POSICIÓN PARA EL TUTORIAL\r\n                        .onGloballyPositioned { coordinates ->\r\n                            val position = coordinates.positionInRoot()\r\n                            val size = coordinates.size\r\n                            backButtonLayout = position to Size(size.width.toFloat(), size.height.toFloat())\r\n                        }\r\n                ) {\r\n                    Image(\r\n                        painter = painterResource(id = R.drawable.arrow_back),\r\n                        contentDescription = stringResource(R.string.go_back),\r\n                        modifier = Modifier\r\n                            .size(28.dp)\r\n                            .clickable { onBack() }\r\n                    )\r\n                }\r\n\r\n\r\n                Text(\r\n                    text = buildString {\r\n                        append(titulo_pin)\r\n                        area_pin?.let { if (it.isNotBlank()) append(\" ($it)\") }\r\n                    },\r\n                    // Bajamos un poco la fuente (de 26 a 22) para que quepa mejor junto a la flecha\r\n                    fontSize = 22.sp,\r\n                    fontWeight = FontWeight.Bold,\r\n                    color = Color.Black,\r\n                    textAlign = TextAlign.Center,\r\n                    lineHeight = 26.sp,\r\n                    modifier = Modifier\r\n                        .align(Alignment.Center) // \uD83D\uDC48 Lo centramos en la pantalla\r\n                        .padding(horizontal = 48.dp) // \uD83D\uDC48 Importante: Margen para no escribir encima de la flecha si el texto es largo\r\n                )\r\n            }\r\n\r\n            // Espacio antes de la imagen\r\n            Spacer(modifier = Modifier.height(16.dp))\r\n\r\n            // 2. CARRUSEL DE IMÁGENES\r\n            if (imagenes.isNotEmpty()) {\r\n                Box(\r\n                    modifier = Modifier\r\n                        .fillMaxWidth()\r\n                        .height(carouselHeight)\r\n                        .clip(RoundedCornerShape(16.dp))\r\n                        .border(3.dp, Color.Black, RoundedCornerShape(16.dp))\r\n                        // \uD83D\uDC47 CAPTURAMOS POSICIÓN REAL\r\n                        .onGloballyPositioned { coordinates ->\r\n                            val position = coordinates.positionInRoot()\r\n                            val size = coordinates.size\r\n                            imageLayout = position to Size(size.width.toFloat(), size.height.toFloat())\r\n                        }\r\n                ) {\r\n                    HorizontalPager(state = pagerState) { page ->\r\n                        val imagen = imagenes[page]\r\n                        Box(modifier = Modifier.fillMaxSize()) {\r\n\r\n                            val alignment = remember{\r\n                                BiasAlignment(horizontalBias = 0f, verticalBias = imagen.foco)\r\n                            }\r\n\r\n\r\n                            AsyncImage(\r\n                                model = imagen.url,\r\n                                contentDescription = imagen.titulo,\r\n                                contentScale = ContentScale.Crop,\r\n                                alignment = alignment,\r\n                                modifier = Modifier\r\n                                    .fillMaxSize()\r\n                                    .clickable {\r\n                                        selectedImageIndex = page\r\n                                    }\r\n                            )\r\n                        }\r\n                    }\r\n                    Row(\r\n                        Modifier\r\n                            .align(Alignment.BottomCenter)\r\n                            .padding(bottom = 6.dp)\r\n                    ) {\r\n                        repeat(imagenes.size) { index ->\r\n                            val selected = pagerState.currentPage == index\r\n                            Box(\r\n                                Modifier\r\n                                    .padding(3.dp)\r\n                                    .size(if (selected) 8.dp else 6.dp)\r\n                                    .background(\r\n                                        Color.White.copy(alpha = if (selected) 1f else 0.6f),\r\n                                        CircleShape\r\n                                    )\r\n                            )\r\n                        }\r\n                    }\r\n                }\r\n                Spacer(modifier = Modifier.height(12.dp))\r\n            }\r\n\r\n            // 3. BOTÓN DE AUDIO\r\n            Row(\r\n                modifier = Modifier.fillMaxWidth(),\r\n                verticalAlignment = Alignment.CenterVertically\r\n            ) {\r\n                if (!audioUrl.isNullOrBlank()) {\r\n                    val iconRes = when {\r\n                        isPlaying -> R.drawable.pause\r\n                        !hasUserInteracted -> R.drawable.sound\r\n                        else -> R.drawable.play_arrow\r\n                    }\r\n                    Row(\r\n                        modifier = Modifier\r\n                            .fillMaxWidth()\r\n                            .padding(top = 8.dp),\r\n                        horizontalArrangement = Arrangement.Start\r\n                    ) {\r\n                        IconButton(\r\n                            onClick = {\r\n                                hasUserInteracted = true\r\n                                if (isPlaying) exoPlayer.pause() else exoPlayer.play()\r\n                            },\r\n                            modifier = Modifier\r\n                                // \uD83D\uDC47 CAPTURAMOS POSICIÓN REAL\r\n                                .onGloballyPositioned { coordinates ->\r\n                                    val position = coordinates.positionInRoot()\r\n                                    val size = coordinates.size\r\n                                    audioButtonLayout = position to Size(size.width.toFloat(), size.height.toFloat())\r\n                                }\r\n                        ) {\r\n                            Box(\r\n                                modifier = Modifier\r\n                                    .size(48.dp)\r\n                                    .clip(CircleShape)\r\n                                    .background(Color.Gray.copy(alpha = 0.3f)),\r\n                                contentAlignment = Alignment.Center\r\n                            ) {\r\n                                Icon(\r\n                                    painter = painterResource(id = iconRes),\r\n                                    contentDescription = stringResource(R.string.play_audio),\r\n                                    tint = Color.Black,\r\n                                    modifier = Modifier.size(28.dp)\r\n                                )\r\n                            }\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n\r\n            // Descripción Deslizable\r\n            val descripcion = descripcion_pin ?: \"\"\r\n            if (descripcion.isNotBlank()) {\r\n                val textScrollState = rememberScrollState()\r\n                Box(\r\n                    modifier = Modifier\r\n                        .fillMaxWidth()\r\n                        .weight(1f)\r\n                        .border(1.dp, Color.LightGray.copy(alpha = 0.5f), RoundedCornerShape(8.dp))\r\n                        .clip(RoundedCornerShape(8.dp))\r\n                ) {\r\n                    Text(\r\n                        text = descripcion,\r\n                        fontSize = 16.sp,\r\n                        color = Color.DarkGray,\r\n                        lineHeight = 22.sp,\r\n                        modifier = Modifier\r\n                            .fillMaxSize()\r\n                            .padding(horizontal = 12.dp, vertical = 8.dp)\r\n                            .verticalScroll(textScrollState)\r\n                    )\r\n                }\r\n            }\r\n\r\n            Spacer(modifier = Modifier.height(24.dp))\r\n\r\n            // 4. BOTÓN 360\r\n            onVer360?.let {\r\n                Box(\r\n                    modifier = Modifier\r\n                        .background(Color.White)\r\n                        .navigationBarsPadding()\r\n                        .padding(horizontal = 16.dp, vertical = 2.dp)\r\n                        .onGloballyPositioned { coordinates ->\r\n                            val position = coordinates.positionInRoot()\r\n                            val size = coordinates.size\r\n                            button360Layout = position to Size(size.width.toFloat(), size.height.toFloat())\r\n                        }\r\n                ) {\r\n                    Button(\r\n                        onClick = it,\r\n                        modifier = Modifier\r\n                            .fillMaxWidth()\r\n                            .height(56.dp),\r\n                        colors = ButtonDefaults.buttonColors(containerColor = Color.Black),\r\n                        shape = RoundedCornerShape(12.dp)\r\n                    ) {\r\n                        Text(\r\n                            text = stringResource(R.string.see_360),\r\n                            color = Color.White,\r\n                            fontSize = 18.sp,\r\n                            fontWeight = FontWeight.Bold,\r\n                        )\r\n                    }\r\n                }\r\n            }\r\n        }\r\n\r\n        // ====================================================================\r\n        // LOGICA VISUAL DEL TUTORIAL (CON COORDENADAS REALES)\r\n        // ====================================================================\r\n\r\n        // Verificar que tenemos al menos las coordenadas básicas (Botón atrás es lo mínimo)\r\n        val isLayoutReady = backButtonLayout != null\r\n\r\n        if (!isPinDismissed && showTutorialSession && isLayoutReady) {\r\n\r\n            // Construimos la lista de pasos usando las coordenadas CAPTURADAS\r\n            val steps = remember(backButtonLayout, imageLayout, audioButtonLayout, button360Layout, audioUrl, onVer360) {\r\n                val list = mutableListOf<PinTutorialStep>()\r\n\r\n                // PASO 1: Volver (Usamos las coordenadas reales del botón atrás)\r\n                backButtonLayout?.let { (pos, size) ->\r\n                    list.add(\r\n                        PinTutorialStep(\r\n                            description = activity?.getString(R.string.pin_1) ?: \"Volver\",\r\n                            // Calculamos el centro geométrico\r\n                            focusCenter = Offset(pos.x + size.width / 2, pos.y + size.height / 2),\r\n                            // Radio un poco más grande que el botón\r\n                            focusRadius = (size.width),\r\n                            alignment = Alignment.BottomCenter\r\n                        )\r\n                    )\r\n                }\r\n\r\n                // PASO 2: Imágenes (Usamos coordenadas reales del carrusel)\r\n                imageLayout?.let { (pos, size) ->\r\n                    list.add(\r\n                        PinTutorialStep(\r\n                            description = activity?.getString(R.string.pin_2) ?: \"Imágenes\",\r\n                            focusCenter = Offset(pos.x + size.width / 2, pos.y + size.height / 2),\r\n                            rectSize = size, // Usamos el tamaño exacto\r\n                            alignment = Alignment.BottomCenter\r\n                        )\r\n                    )\r\n                }\r\n\r\n                // PASO 3: Audio (Solo si existe y se ha medido)\r\n                if (!audioUrl.isNullOrBlank() && audioButtonLayout != null) {\r\n                    audioButtonLayout?.let { (pos, size) ->\r\n                        list.add(\r\n                            PinTutorialStep(\r\n                                description = activity?.getString(R.string.pin_3) ?: \"Audio\",\r\n                                focusCenter = Offset(pos.x + size.width / 2, pos.y + size.height / 2),\r\n                                focusRadius = (size.width / 2) + 20f,\r\n                                alignment = Alignment.TopCenter\r\n                            )\r\n                        )\r\n                    }\r\n                }\r\n\r\n                // PASO 4: Botón 360 (Solo si existe y se ha medido)\r\n                if (onVer360 != null && button360Layout != null) {\r\n                    button360Layout?.let { (pos, size) ->\r\n                        list.add(\r\n                            PinTutorialStep(\r\n                                description = activity?.getString(R.string.pin_4) ?: \"360\",\r\n                                focusCenter = Offset(pos.x + size.width / 2, pos.y + size.height / 2),\r\n                                rectSize = size,\r\n                                alignment = Alignment.TopCenter // Dialogo ARRIBA\r\n                            )\r\n                        )\r\n                    }\r\n                }\r\n                list\r\n            }\r\n\r\n            if (steps.isNotEmpty() && currentStepIndex < steps.size) {\r\n                val step = steps[currentStepIndex]\r\n                val isLastStep = currentStepIndex == steps.size - 1\r\n                val btnText = if (isLastStep) stringResource(R.string.understand) else stringResource(R.string.next)\r\n\r\n                GenericTutorialOverlay(\r\n                    description = step.description,\r\n                    highlightCenter = step.focusCenter,\r\n                    highlightRadius = step.focusRadius,\r\n                    highlightRectSize = step.rectSize,\r\n                    buttonText = btnText,\r\n                    dialogAlignment = step.alignment,\r\n\r\n                    onCloseClicked = { permanent ->\r\n                        if (isLastStep) {\r\n                            showTutorialSession = false\r\n                            if (permanent) viewModel.dismissPin()\r\n                        } else {\r\n                            currentStepIndex++\r\n                            if (permanent) viewModel.dismissPin()\r\n                        }\r\n                    }\r\n                )\r\n            }\r\n        }\r\n\r\n        // \uD83D\uDD0D Zoom Dialog\r\n        if (selectedImageIndex != null) {\r\n            ZoomableImageDialog(\r\n                imagenes = imagenes,\r\n                initialIndex = selectedImageIndex!!,\r\n                languageCode = language,\r\n                onDismiss = {\r\n                    selectedImageIndex = null\r\n                }\r\n            )\r\n        }\r\n    }\r\n}\r\n\r\n@OptIn(ExperimentalFoundationApi::class)\r\n@Composable\r\nprivate fun ZoomableImageDialog(\r\n    imagenes: List<ImagenData>,\r\n    initialIndex: Int,\r\n    languageCode: String,\r\n    onDismiss: () -> Unit\r\n) {\r\n    val view = LocalView.current\r\n    val activity = view.context as? Activity\r\n\r\n    DisposableEffect(Unit) {\r\n        activity?.requestedOrientation = ActivityInfo.SCREEN_ORIENTATION_SENSOR\r\n        onDispose {\r\n            activity?.requestedOrientation = ActivityInfo.SCREEN_ORIENTATION_PORTRAIT\r\n        }\r\n    }\r\n\r\n    val zoomPagerState = rememberPagerState(\r\n        initialPage = initialIndex,\r\n        pageCount = { imagenes.size }\r\n    )\r\n\r\n    Dialog(\r\n        onDismissRequest = onDismiss,\r\n        properties = DialogProperties(\r\n            usePlatformDefaultWidth = false,\r\n            dismissOnClickOutside = true\r\n        )\r\n    ) {\r\n        Box(\r\n            modifier = Modifier\r\n                .fillMaxSize()\r\n                .background(Color.Black.copy(alpha = 0.95f))\r\n        ) {\r\n\r\n            HorizontalPager(\r\n                state = zoomPagerState,\r\n                modifier = Modifier.fillMaxSize()\r\n            ) { page ->\r\n                val imagen = imagenes[page]\r\n                // Cada página tiene su propio PhotoView para zoom independiente\r\n                AndroidView(\r\n                    factory = { context ->\r\n                        PhotoView(context).apply {\r\n                            load(imagen.url) {\r\n                                crossfade(true)\r\n                            }\r\n                            maximumScale = 5.0f\r\n                            mediumScale = 2.5f\r\n                        }\r\n                    },\r\n                    modifier = Modifier.fillMaxSize()\r\n                )\r\n            }\r\n\r\n            // Título de la imagen actual\r\n            val currentImage = imagenes[zoomPagerState.currentPage]\r\n            val titulo = when (languageCode) {\r\n                \"es\" -> currentImage.titulo\r\n                \"de\" -> currentImage.tituloAleman\r\n                else -> currentImage.tituloIngles\r\n            }\r\n\r\n            Text(\r\n                text = titulo,\r\n                color = Color.White,\r\n                fontSize = 16.sp,\r\n                fontWeight = FontWeight.Medium,\r\n                modifier = Modifier\r\n                    .align(Alignment.BottomStart)\r\n                    .background(Color.Black.copy(alpha = 0.7f))\r\n                    .padding(horizontal = 12.dp, vertical = 8.dp)\r\n                    .padding(bottom = 16.dp)\r\n            )\r\n\r\n            // Indicador de página (opcional)\r\n            Text(\r\n                text = \"${zoomPagerState.currentPage + 1} / ${imagenes.size}\",\r\n                color = Color.White,\r\n                modifier = Modifier\r\n                    .align(Alignment.TopCenter)\r\n                    .padding(top = 16.dp)\r\n                    .statusBarsPadding()\r\n            )\r\n\r\n            IconButton(\r\n                onClick = onDismiss,\r\n                modifier = Modifier\r\n                    .align(Alignment.TopStart)\r\n                    .statusBarsPadding()\r\n                    .padding(16.dp)\r\n                    .background(Color.Black.copy(alpha = 0.5f), CircleShape)\r\n            ) {\r\n                Icon(\r\n                    painter = painterResource(id = R.drawable.arrow_back),\r\n                    contentDescription = stringResource(R.string.close),\r\n                    tint = Color.White\r\n                )\r\n            }\r\n        }\r\n    }\r\n}
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/app/src/main/java/com/nextapp/monasterio/ui/virtualvisit/screens/PinDetalleScreen.kt b/app/src/main/java/com/nextapp/monasterio/ui/virtualvisit/screens/PinDetalleScreen.kt
--- a/app/src/main/java/com/nextapp/monasterio/ui/virtualvisit/screens/PinDetalleScreen.kt	(revision 26d1bc7c4208f8005e97b4491e6d203945b2c691)
+++ b/app/src/main/java/com/nextapp/monasterio/ui/virtualvisit/screens/PinDetalleScreen.kt	(date 1765214558514)
@@ -48,7 +48,7 @@
 import com.nextapp.monasterio.ui.virtualvisit.components.GenericTutorialOverlay
 import com.nextapp.monasterio.viewModels.AjustesViewModel
 import java.util.Locale
-
+import com.nextapp.monasterio.ui.components.MonasteryButton
 
 private data class PinTutorialStep(
     val description: String,
@@ -403,7 +403,7 @@
                             button360Layout = position to Size(size.width.toFloat(), size.height.toFloat())
                         }
                 ) {
-                    Button(
+                    MonasteryButton(
                         onClick = it,
                         modifier = Modifier
                             .fillMaxWidth()
Index: app/src/main/java/com/nextapp/monasterio/ui/screens/OpcionesReservaScreen.kt
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>package com.nextapp.monasterio.ui.screens\r\n\r\nimport android.app.Activity\r\nimport android.content.pm.ActivityInfo\r\nimport android.content.res.Configuration\r\nimport androidx.compose.foundation.Image\r\nimport androidx.compose.foundation.layout.*\r\nimport androidx.compose.foundation.rememberScrollState\r\nimport androidx.compose.foundation.shape.RoundedCornerShape\r\nimport androidx.compose.foundation.verticalScroll\r\nimport androidx.compose.material3.*\r\nimport androidx.compose.runtime.Composable\r\nimport androidx.compose.runtime.DisposableEffect\r\nimport androidx.compose.ui.Alignment\r\nimport androidx.compose.ui.Modifier\r\nimport androidx.compose.ui.graphics.Color\r\nimport androidx.compose.ui.layout.ContentScale\r\nimport androidx.compose.ui.platform.LocalConfiguration\r\nimport androidx.compose.ui.platform.LocalContext\r\nimport androidx.compose.ui.res.painterResource\r\nimport androidx.compose.ui.res.stringResource\r\nimport androidx.compose.ui.text.font.FontFamily\r\nimport androidx.compose.ui.text.font.FontWeight\r\nimport androidx.compose.ui.text.style.TextAlign\r\nimport androidx.compose.ui.unit.dp\r\nimport androidx.compose.ui.unit.sp\r\nimport androidx.navigation.NavController\r\nimport com.nextapp.monasterio.AppRoutes\r\nimport com.nextapp.monasterio.R\r\nimport com.nextapp.monasterio.utils.llamarTelefono\r\n\r\n@Composable\r\nfun OpcionesReservaScreen(\r\n    navController: NavController,\r\n    topPadding: PaddingValues = PaddingValues(0.dp) // Recibimos el padding\r\n) {\r\n    val context = LocalContext.current\r\n    val activity = (context as? Activity)\r\n    val numerodetelefono = \"+34983291395\"\r\n\r\n    // Detectar orientación\r\n    val configuration = LocalConfiguration.current\r\n    val isLandscape = configuration.orientation == Configuration.ORIENTATION_LANDSCAPE\r\n\r\n    // Permitir rotación\r\n    DisposableEffect(Unit) {\r\n        activity?.requestedOrientation = ActivityInfo.SCREEN_ORIENTATION_UNSPECIFIED\r\n        onDispose { }\r\n    }\r\n\r\n    // --- ESTRUCTURA PRINCIPAL ---\r\n    Box(modifier = Modifier.fillMaxSize()) {\r\n\r\n        // 1. IMAGEN DE FONDO (Ocupa todo)\r\n        Image(\r\n            painter = painterResource(R.drawable.fondo_desplegable3),\r\n            contentDescription = \"Fondo\",\r\n            contentScale = ContentScale.Crop,\r\n            modifier = Modifier.fillMaxSize()\r\n        )\r\n\r\n        // 2. CONTENIDO (Respeta la barra superior)\r\n        Box(\r\n            modifier = Modifier\r\n                .fillMaxSize()\r\n                .padding(topPadding)\r\n        ) {\r\n            // Contenedor con margen visual\r\n            Box(\r\n                modifier = Modifier\r\n                    .fillMaxSize()\r\n                    .padding(24.dp),\r\n                contentAlignment = Alignment.Center\r\n            ) {\r\n                if (isLandscape) {\r\n                    // --- DISEÑO HORIZONTAL (Lado a lado) ---\r\n                    Row(\r\n                        modifier = Modifier.fillMaxWidth(),\r\n                        horizontalArrangement = Arrangement.spacedBy(24.dp),\r\n                        verticalAlignment = Alignment.CenterVertically\r\n                    ) {\r\n                        // Botón Teléfono\r\n                        ReservaOptionButton(\r\n                            text = stringResource(R.string.option_phone_appointment),\r\n                            iconRes = R.drawable.telefono,\r\n                            backgroundColor = Color(0xFF1E8E3E), // Verde\r\n                            modifier = Modifier\r\n                                .weight(1f)\r\n                                .fillMaxHeight(0.7f), // Altura controlada en horizontal\r\n                            onClick = { context.llamarTelefono(numerodetelefono) }\r\n                        )\r\n\r\n                        // Botón Online\r\n                        ReservaOptionButton(\r\n                            text = stringResource(R.string.option_online_appointment),\r\n                            iconRes = R.drawable.calendario,\r\n                            backgroundColor = Color(0xFF303F9F), // Azul\r\n                            modifier = Modifier\r\n                                .weight(1f)\r\n                                .fillMaxHeight(0.7f),\r\n                            onClick = { navController.navigate(AppRoutes.RESERVA) }\r\n                        )\r\n                    }\r\n                } else {\r\n                    // --- DISEÑO VERTICAL (Uno encima de otro) ---\r\n                    Column(\r\n                        modifier = Modifier\r\n                            .fillMaxWidth()\r\n                            .verticalScroll(rememberScrollState()),\r\n                        verticalArrangement = Arrangement.Center,\r\n                        horizontalAlignment = Alignment.CenterHorizontally\r\n                    ) {\r\n                        // Botón Teléfono\r\n                        ReservaOptionButton(\r\n                            text = stringResource(R.string.option_phone_appointment),\r\n                            iconRes = R.drawable.telefono,\r\n                            backgroundColor = Color(0xFF1E8E3E),\r\n                            modifier = Modifier\r\n                                .fillMaxWidth()\r\n                                .height(140.dp), // Un poco más altos para que quepa el icono grande\r\n                            onClick = { context.llamarTelefono(numerodetelefono) }\r\n                        )\r\n\r\n                        Spacer(modifier = Modifier.height(32.dp))\r\n\r\n                        // Botón Online\r\n                        ReservaOptionButton(\r\n                            text = stringResource(R.string.option_online_appointment),\r\n                            iconRes = R.drawable.calendario,\r\n                            backgroundColor = Color(0xFF303F9F),\r\n                            modifier = Modifier\r\n                                .fillMaxWidth()\r\n                                .height(140.dp),\r\n                            onClick = { navController.navigate(AppRoutes.RESERVA) }\r\n                        )\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\n// --- COMPONENTE REUTILIZABLE ---\r\n@Composable\r\nfun ReservaOptionButton(\r\n    text: String,\r\n    iconRes: Int,\r\n    backgroundColor: Color,\r\n    modifier: Modifier = Modifier,\r\n    onClick: () -> Unit\r\n) {\r\n    Button(\r\n        onClick = onClick,\r\n        enabled = true,\r\n        shape = RoundedCornerShape(16.dp),\r\n        colors = ButtonDefaults.buttonColors(\r\n            containerColor = backgroundColor,\r\n            contentColor = Color.Black // Iconos y texto negros según tu diseño original\r\n        ),\r\n        modifier = modifier\r\n    ) {\r\n        // Usamos BoxWithConstraints para ajustar el tamaño del icono si el botón se hace pequeño\r\n        BoxWithConstraints(contentAlignment = Alignment.Center) {\r\n            val availableHeight = maxHeight\r\n            // Si hay poco espacio vertical, reducimos el icono\r\n            val iconSize = if (availableHeight < 100.dp) 48.dp else 80.dp\r\n\r\n            Row(\r\n                verticalAlignment = Alignment.CenterVertically,\r\n                horizontalArrangement = Arrangement.Center,\r\n                modifier = Modifier.fillMaxWidth()\r\n            ) {\r\n                Icon(\r\n                    painter = painterResource(iconRes),\r\n                    contentDescription = null,\r\n                    modifier = Modifier.size(iconSize),\r\n                    tint = Color.White // Aseguramos color negro\r\n                )\r\n\r\n                Spacer(Modifier.width(24.dp))\r\n\r\n                Text(\r\n                    text = text,\r\n                    fontSize = 22.sp,\r\n                    fontFamily = FontFamily.Serif,\r\n                    fontWeight = FontWeight.Bold,\r\n                    textAlign = TextAlign.Center,\r\n                    color = Color.White\r\n                )\r\n            }\r\n        }\r\n    }\r\n}
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/app/src/main/java/com/nextapp/monasterio/ui/screens/OpcionesReservaScreen.kt b/app/src/main/java/com/nextapp/monasterio/ui/screens/OpcionesReservaScreen.kt
--- a/app/src/main/java/com/nextapp/monasterio/ui/screens/OpcionesReservaScreen.kt	(revision 26d1bc7c4208f8005e97b4491e6d203945b2c691)
+++ b/app/src/main/java/com/nextapp/monasterio/ui/screens/OpcionesReservaScreen.kt	(date 1765214239036)
@@ -28,7 +28,7 @@
 import com.nextapp.monasterio.AppRoutes
 import com.nextapp.monasterio.R
 import com.nextapp.monasterio.utils.llamarTelefono
-
+import com.nextapp.monasterio.ui.components.MonasteryButton
 @Composable
 fun OpcionesReservaScreen(
     navController: NavController,
@@ -149,7 +149,7 @@
     modifier: Modifier = Modifier,
     onClick: () -> Unit
 ) {
-    Button(
+    MonasteryButton(
         onClick = onClick,
         enabled = true,
         shape = RoundedCornerShape(16.dp),
Index: app/src/main/java/com/nextapp/monasterio/ui/screens/OpcionesModoNiño.kt
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>package com.nextapp.monasterio.ui.screens\r\n\r\nimport android.app.Activity\r\nimport android.content.pm.ActivityInfo\r\nimport android.content.res.Configuration\r\nimport androidx.compose.foundation.Image\r\nimport androidx.compose.foundation.layout.*\r\nimport androidx.compose.foundation.rememberScrollState\r\nimport androidx.compose.foundation.shape.RoundedCornerShape\r\nimport androidx.compose.foundation.verticalScroll\r\nimport androidx.compose.material3.Button\r\nimport androidx.compose.material3.ButtonDefaults\r\nimport androidx.compose.material3.Icon\r\nimport androidx.compose.material3.Text\r\nimport androidx.compose.runtime.Composable\r\nimport androidx.compose.runtime.DisposableEffect\r\nimport androidx.compose.ui.Alignment\r\nimport androidx.compose.ui.Modifier\r\nimport androidx.compose.ui.draw.shadow\r\nimport androidx.compose.ui.graphics.Color\r\nimport androidx.compose.ui.layout.ContentScale\r\nimport androidx.compose.ui.platform.LocalConfiguration\r\nimport androidx.compose.ui.platform.LocalContext\r\nimport androidx.compose.ui.res.painterResource\r\nimport androidx.compose.ui.res.stringResource\r\nimport androidx.compose.ui.text.font.FontWeight\r\nimport androidx.compose.ui.text.style.TextAlign\r\nimport androidx.compose.ui.text.style.TextOverflow\r\nimport androidx.compose.ui.unit.dp\r\nimport androidx.compose.ui.unit.sp\r\nimport androidx.navigation.NavController\r\nimport com.nextapp.monasterio.AppRoutes\r\nimport com.nextapp.monasterio.R\r\nimport com.nextapp.monasterio.ui.theme.MonasteryBlue\r\nimport com.nextapp.monasterio.ui.theme.MonasteryOrange\r\n\r\n@Composable\r\nfun OpcionesModoNiño(\r\n    navController: NavController,\r\n    // \uD83D\uDC47 Recibimos el padding del sistema (igual que en HomeScreen)\r\n    topPadding: PaddingValues = PaddingValues(0.dp)\r\n) {\r\n    val context = LocalContext.current\r\n    val activity = (context as? Activity)\r\n\r\n    // Detectar orientación\r\n    val configuration = LocalConfiguration.current\r\n    val isLandscape = configuration.orientation == Configuration.ORIENTATION_LANDSCAPE\r\n\r\n    // Permitir rotación\r\n    DisposableEffect(Unit) {\r\n        activity?.requestedOrientation = ActivityInfo.SCREEN_ORIENTATION_UNSPECIFIED\r\n        onDispose { }\r\n    }\r\n\r\n    // --- ESTRUCTURA PRINCIPAL ---\r\n    Box(modifier = Modifier.fillMaxSize()) {\r\n\r\n        // 1. FONDO (Ocupa TODO, sin padding)\r\n        Image(\r\n            painter = painterResource(R.drawable.fondo),\r\n            contentDescription = \"Fondo\",\r\n            contentScale = ContentScale.Crop,\r\n            modifier = Modifier.fillMaxSize()\r\n        )\r\n\r\n        // 2. CONTENIDO (Aplica el padding AQUÍ para respetar la barra roja)\r\n        Box(\r\n            modifier = Modifier\r\n                .fillMaxSize()\r\n                .padding(topPadding) // \uD83D\uDC48 CLAVE: El contenido baja, el fondo se queda\r\n        ) {\r\n            // Contenedor interno con padding visual para separar de los bordes de la pantalla\r\n            Box(\r\n                modifier = Modifier\r\n                    .fillMaxSize()\r\n                    .padding(24.dp),\r\n                contentAlignment = Alignment.Center\r\n            ) {\r\n                if (isLandscape) {\r\n                    // --- DISEÑO HORIZONTAL (Lado a lado) ---\r\n                    Row(\r\n                        modifier = Modifier.fillMaxWidth(),\r\n                        horizontalArrangement = Arrangement.spacedBy(24.dp),\r\n                        verticalAlignment = Alignment.CenterVertically\r\n                    ) {\r\n                        // Botón Video (50% ancho)\r\n                        OpcionNinyoButton(\r\n                            text = stringResource(id = R.string.video_child),\r\n                            iconRes = R.drawable.youtube,\r\n                            backgroundColor = MonasteryOrange,\r\n                            modifier = Modifier\r\n                                .weight(1f)\r\n                                .fillMaxHeight(0.7f), // Altura controlada en horizontal\r\n                            onClick = { navController.navigate(AppRoutes.VIDEO_NINYOS) }\r\n                        )\r\n\r\n                        // Botón Juego (50% ancho)\r\n                        OpcionNinyoButton(\r\n                            text = stringResource(id = R.string.game_child),\r\n                            iconRes = R.drawable.console,\r\n                            backgroundColor = MonasteryBlue,\r\n                            modifier = Modifier\r\n                                .weight(1f)\r\n                                .fillMaxHeight(0.7f),\r\n                            onClick = { navController.navigate(AppRoutes.JUEGO_NINYOS) }\r\n                        )\r\n                    }\r\n                } else {\r\n                    // --- DISEÑO VERTICAL (Uno encima de otro) ---\r\n                    Column(\r\n                        modifier = Modifier\r\n                            .fillMaxWidth()\r\n                            .verticalScroll(rememberScrollState()),\r\n                        verticalArrangement = Arrangement.Center,\r\n                        horizontalAlignment = Alignment.CenterHorizontally\r\n                    ) {\r\n                        // Botón Video\r\n                        OpcionNinyoButton(\r\n                            text = stringResource(id = R.string.video_child),\r\n                            iconRes = R.drawable.youtube,\r\n                            backgroundColor = MonasteryOrange,\r\n                            modifier = Modifier\r\n                                .fillMaxWidth()\r\n                                .height(120.dp), // Altura fija grande\r\n                            onClick = { navController.navigate(AppRoutes.VIDEO_NINYOS) }\r\n                        )\r\n\r\n                        Spacer(modifier = Modifier.height(32.dp))\r\n\r\n                        // Botón Juego\r\n                        OpcionNinyoButton(\r\n                            text = stringResource(id = R.string.game_child),\r\n                            iconRes = R.drawable.console,\r\n                            backgroundColor = MonasteryBlue,\r\n                            modifier = Modifier\r\n                                .fillMaxWidth()\r\n                                .height(120.dp),\r\n                            onClick = { navController.navigate(AppRoutes.JUEGO_NINYOS) }\r\n                        )\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    }\r\n}\r\n// --- COMPONENTE REUTILIZABLE PARA LOS BOTONES ---\r\n@Composable\r\nfun OpcionNinyoButton(\r\n    text: String,\r\n    iconRes: Int,\r\n    backgroundColor: Color,\r\n    modifier: Modifier = Modifier,\r\n    onClick: () -> Unit\r\n) {\r\n    Button(\r\n        onClick = onClick,\r\n        colors = ButtonDefaults.buttonColors(containerColor = backgroundColor),\r\n        shape = RoundedCornerShape(20.dp),\r\n        modifier = modifier,\r\n        elevation = ButtonDefaults.buttonElevation(8.dp)\r\n    ) {\r\n        Row(\r\n            modifier = Modifier.fillMaxWidth(),\r\n            verticalAlignment = Alignment.CenterVertically,\r\n            horizontalArrangement = Arrangement.Start\r\n        ) {\r\n            Icon(\r\n                painter = painterResource(id = iconRes),\r\n                contentDescription = null,\r\n                modifier = Modifier.size(48.dp)\r\n            )\r\n            Spacer(modifier = Modifier.width(16.dp))\r\n            Text(\r\n                text = text,\r\n                fontSize = 20.sp,\r\n                fontWeight = FontWeight.Bold,\r\n                textAlign = TextAlign.Center,\r\n                overflow = TextOverflow.Ellipsis,\r\n                modifier = Modifier.weight(1f)\r\n            )\r\n            Spacer(modifier = Modifier.width(10.dp))\r\n        }\r\n    }\r\n}
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/app/src/main/java/com/nextapp/monasterio/ui/screens/OpcionesModoNiño.kt b/app/src/main/java/com/nextapp/monasterio/ui/screens/OpcionesModoNiño.kt
--- a/app/src/main/java/com/nextapp/monasterio/ui/screens/OpcionesModoNiño.kt	(revision 26d1bc7c4208f8005e97b4491e6d203945b2c691)
+++ b/app/src/main/java/com/nextapp/monasterio/ui/screens/OpcionesModoNiño.kt	(date 1765214199592)
@@ -33,6 +33,7 @@
 import com.nextapp.monasterio.R
 import com.nextapp.monasterio.ui.theme.MonasteryBlue
 import com.nextapp.monasterio.ui.theme.MonasteryOrange
+import com.nextapp.monasterio.ui.components.MonasteryButton
 
 @Composable
 fun OpcionesModoNiño(
@@ -153,7 +154,7 @@
     modifier: Modifier = Modifier,
     onClick: () -> Unit
 ) {
-    Button(
+    MonasteryButton(
         onClick = onClick,
         colors = ButtonDefaults.buttonColors(containerColor = backgroundColor),
         shape = RoundedCornerShape(20.dp),
Index: app/src/main/java/com/nextapp/monasterio/ui/screens/ProfileScreen.kt
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>package com.nextapp.monasterio.ui.screens\r\n\r\nimport android.content.res.Configuration\r\nimport androidx.compose.foundation.layout.*\r\nimport androidx.compose.foundation.rememberScrollState\r\nimport androidx.compose.foundation.shape.RoundedCornerShape\r\nimport androidx.compose.foundation.verticalScroll\r\nimport androidx.compose.material3.*\r\nimport androidx.compose.runtime.*\r\nimport androidx.compose.ui.Alignment\r\nimport androidx.compose.ui.Modifier\r\nimport androidx.compose.ui.platform.LocalConfiguration\r\nimport androidx.compose.ui.res.painterResource\r\nimport androidx.compose.ui.res.stringResource\r\nimport androidx.compose.ui.text.input.PasswordVisualTransformation\r\nimport androidx.compose.ui.unit.dp\r\nimport androidx.lifecycle.viewmodel.compose.viewModel\r\nimport com.nextapp.monasterio.R\r\nimport com.nextapp.monasterio.ui.components.EditableContent\r\nimport com.nextapp.monasterio.ui.components.EditableText\r\nimport com.nextapp.monasterio.viewModels.AuthViewModel\r\n\r\n@Composable\r\nfun ProfileScreen(\r\n    isEditing: Boolean,\r\n    viewModel: AuthViewModel = viewModel(),\r\n) {\r\n    val userState by viewModel.currentUser.collectAsState()\r\n    val user = userState\r\n    val isLoading by viewModel.isLoading.collectAsState()\r\n    val error by viewModel.error.collectAsState()\r\n\r\n    // Detectar orientación\r\n    val configuration = LocalConfiguration.current\r\n    val isLandscape = configuration.orientation == Configuration.ORIENTATION_LANDSCAPE\r\n\r\n    if (isLoading) {\r\n        Box(modifier = Modifier.fillMaxSize(), contentAlignment = Alignment.Center) {\r\n            CircularProgressIndicator()\r\n        }\r\n    } else if (user == null) {\r\n        // --- PANTALLA DE LOGIN ---\r\n        if (isLandscape) {\r\n            LoginScreenLandscape(viewModel, error)\r\n        } else {\r\n            LoginScreenPortrait(viewModel, error)\r\n        }\r\n    } else {\r\n        // --- PANTALLA DE PERFIL (AUTENTICADO) ---\r\n        // Lógica de edición (común para ambas orientaciones)\r\n        var editableName by remember(user) { mutableStateOf(user.name ?: \"\") }\r\n        var editableEmail by remember(user) { mutableStateOf(user.email ?: \"\") }\r\n\r\n        val hasChanges = remember(editableName, editableEmail, user) {\r\n            editableName != (user.name ?: \"\") || editableEmail != (user.email ?: \"\")\r\n        }\r\n\r\n        val saveChanges = { viewModel.updateUser(name = editableName, email = editableEmail) }\r\n        val cancelChanges = {\r\n            editableName = user.name ?: \"\"\r\n            editableEmail = user.email ?: \"\"\r\n        }\r\n\r\n        if (isEditing) {\r\n            // MODO EDICIÓN (Lo mantenemos simple en vertical con scroll para no complicar)\r\n            EditableProfileView(\r\n                isEditing = true,\r\n                hasChanges = hasChanges,\r\n                onSave = saveChanges,\r\n                onCancel = cancelChanges,\r\n                name = editableName,\r\n                email = editableEmail,\r\n                onNameChange = { editableName = it },\r\n                onEmailChange = { editableEmail = it }\r\n            )\r\n        } else {\r\n            // MODO LECTURA (Aquí aplicamos el cambio de diseño radical)\r\n            if (isLandscape) {\r\n                ProfileViewLandscape(user, viewModel)\r\n            } else {\r\n                ProfileViewPortrait(user, viewModel)\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\n// =============================================================================\r\n// COMPONENTES DE LOGIN\r\n// =============================================================================\r\n\r\n@Composable\r\nfun LoginScreenPortrait(viewModel: AuthViewModel, error: String?) {\r\n    var email by remember { mutableStateOf(\"\") }\r\n    var password by remember { mutableStateOf(\"\") }\r\n\r\n    Column(\r\n        modifier = Modifier\r\n            .fillMaxSize()\r\n            .padding(16.dp),\r\n        verticalArrangement = Arrangement.Center,\r\n        horizontalAlignment = Alignment.CenterHorizontally\r\n    ) {\r\n        Text(text = stringResource(id = R.string.profile_login), style = MaterialTheme.typography.headlineMedium)\r\n        Spacer(modifier = Modifier.height(32.dp))\r\n\r\n        LoginForm(email, { email = it }, password, { password = it })\r\n\r\n        Spacer(modifier = Modifier.height(24.dp))\r\n\r\n        Button(\r\n            onClick = { viewModel.login(email, password) },\r\n            modifier = Modifier.fillMaxWidth()\r\n        ) {\r\n            Text(stringResource(id = R.string.profile_login))\r\n        }\r\n\r\n        if (error != null) {\r\n            Spacer(modifier = Modifier.height(16.dp))\r\n            Text(text = error, color = MaterialTheme.colorScheme.error)\r\n        }\r\n    }\r\n}\r\n\r\n@Composable\r\nfun LoginScreenLandscape(viewModel: AuthViewModel, error: String?) {\r\n    var email by remember { mutableStateOf(\"\") }\r\n    var password by remember { mutableStateOf(\"\") }\r\n\r\n    Row(\r\n        modifier = Modifier\r\n            .fillMaxSize()\r\n            .padding(16.dp), // Un poco más de margen para que respire\r\n        verticalAlignment = Alignment.CenterVertically, // Centrado vertical general\r\n        horizontalArrangement = Arrangement.spacedBy(32.dp) // Separación entre la zona de escribir y la de pulsar\r\n    ) {\r\n        // --- IZQUIERDA: FORMULARIO (Campos de texto) ---\r\n        Column(\r\n            modifier = Modifier\r\n                .weight(1f)\r\n                .fillMaxHeight(), // Para centrar verticalmente el contenido\r\n            verticalArrangement = Arrangement.Center,\r\n            horizontalAlignment = Alignment.CenterHorizontally\r\n        ) {\r\n            Text(\r\n                text = stringResource(id = R.string.profile_login),\r\n                style = MaterialTheme.typography.headlineSmall,\r\n                color = MaterialTheme.colorScheme.primary\r\n            )\r\n\r\n            Spacer(modifier = Modifier.height(10.dp))\r\n\r\n            // Campos de Email y Contraseña\r\n            LoginForm(email, { email = it }, password, { password = it })\r\n        }\r\n\r\n        // --- DERECHA: BOTÓN DE ACCIÓN Y ERRORES ---\r\n        Column(\r\n            modifier = Modifier\r\n                .weight(1f)\r\n                .fillMaxHeight(),\r\n            verticalArrangement = Arrangement.Center,\r\n            horizontalAlignment = Alignment.CenterHorizontally\r\n        ) {\r\n            // Botón grande y llamativo\r\n            Button(\r\n                onClick = { viewModel.login(email, password) },\r\n                modifier = Modifier.fillMaxWidth(),\r\n                shape = RoundedCornerShape(12.dp) // Bordes redondeados\r\n            ) {\r\n                Text(\r\n                    text = stringResource(id = R.string.profile_login),\r\n                    modifier = Modifier.padding(vertical = 8.dp) // Más alto para facilitar el toque\r\n                )\r\n            }\r\n\r\n            // Mensaje de error debajo del botón\r\n            if (error != null) {\r\n                Spacer(modifier = Modifier.height(16.dp))\r\n                Text(\r\n                    text = error,\r\n                    color = MaterialTheme.colorScheme.error,\r\n                    style = MaterialTheme.typography.bodyMedium,\r\n                    textAlign = androidx.compose.ui.text.style.TextAlign.Center\r\n                )\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\n@Composable\r\nfun LoginForm(email: String, onEmailChange: (String) -> Unit, pass: String, onPassChange: (String) -> Unit) {\r\n    OutlinedTextField(\r\n        value = email,\r\n        onValueChange = onEmailChange,\r\n        label = { Text(stringResource(id = R.string.profile_email)) },\r\n        singleLine = true,\r\n        modifier = Modifier.fillMaxWidth()\r\n    )\r\n    Spacer(modifier = Modifier.height(8.dp))\r\n    OutlinedTextField(\r\n        value = pass,\r\n        onValueChange = onPassChange,\r\n        label = { Text(stringResource(id = R.string.profile_password)) },\r\n        visualTransformation = PasswordVisualTransformation(),\r\n        singleLine = true,\r\n        modifier = Modifier.fillMaxWidth()\r\n    )\r\n}\r\n\r\n// =============================================================================\r\n// COMPONENTES DE PERFIL (LECTURA)\r\n// =============================================================================\r\n\r\n@Composable\r\nfun ProfileViewPortrait(user: com.nextapp.monasterio.models.User, viewModel: AuthViewModel) {\r\n    Column(\r\n        modifier = Modifier\r\n            .fillMaxSize()\r\n            .padding(24.dp)\r\n            .verticalScroll(rememberScrollState()), // Scroll por si acaso\r\n        horizontalAlignment = Alignment.CenterHorizontally,\r\n        verticalArrangement = Arrangement.Center\r\n    ) {\r\n        Icon(\r\n            painter = painterResource(id = R.drawable.escudo),\r\n            contentDescription = null,\r\n            modifier = Modifier.fillMaxWidth(0.5f),\r\n            tint = androidx.compose.ui.graphics.Color.Unspecified\r\n        )\r\n        Spacer(modifier = Modifier.height(24.dp))\r\n\r\n        Text(\r\n            text = \"Bienvenido, ${user.name}\",\r\n            style = MaterialTheme.typography.headlineSmall,\r\n            color = MaterialTheme.colorScheme.onBackground\r\n        )\r\n        Spacer(modifier = Modifier.height(32.dp))\r\n\r\n        UserInfoCard(user)\r\n\r\n        Spacer(modifier = Modifier.height(48.dp))\r\n\r\n        LogoutButton(viewModel)\r\n    }\r\n}\r\n\r\n@Composable\r\nfun ProfileViewLandscape(user: com.nextapp.monasterio.models.User, viewModel: AuthViewModel) {\r\n    Row(\r\n        modifier = Modifier\r\n            .fillMaxSize()\r\n            .padding(16.dp),\r\n        verticalAlignment = Alignment.CenterVertically,\r\n        horizontalArrangement = Arrangement.SpaceBetween\r\n    ) {\r\n        // 1. ESCUDO (30%)\r\n        Box(\r\n            modifier = Modifier.weight(0.3f),\r\n            contentAlignment = Alignment.Center\r\n        ) {\r\n            Icon(\r\n                painter = painterResource(id = R.drawable.escudo),\r\n                contentDescription = null,\r\n                modifier = Modifier.fillMaxHeight(0.8f), // Un poco más grande en tablet\r\n                tint = androidx.compose.ui.graphics.Color.Unspecified\r\n            )\r\n        }\r\n\r\n        // 2. DATOS USUARIO (40%)\r\n        Box(\r\n            modifier = Modifier\r\n                .weight(0.4f)\r\n                .padding(horizontal = 16.dp),\r\n            contentAlignment = Alignment.Center\r\n        ) {\r\n            UserInfoCard(user)\r\n        }\r\n\r\n        // 3. BOTÓN LOGOUT (30%)\r\n        Box(\r\n            modifier = Modifier.weight(0.3f),\r\n            contentAlignment = Alignment.Center\r\n        ) {\r\n            LogoutButton(viewModel)\r\n        }\r\n    }\r\n}\r\n\r\n@Composable\r\nfun UserInfoCard(user: com.nextapp.monasterio.models.User) {\r\n    Card(\r\n        modifier = Modifier.fillMaxWidth(),\r\n        elevation = CardDefaults.cardElevation(defaultElevation = 4.dp),\r\n        colors = CardDefaults.cardColors(containerColor = MaterialTheme.colorScheme.surface)\r\n    ) {\r\n        Column(\r\n            modifier = Modifier.padding(20.dp),\r\n            verticalArrangement = Arrangement.spacedBy(20.dp)\r\n        ) {\r\n            // Nombre\r\n            Row(verticalAlignment = Alignment.CenterVertically) {\r\n                Icon(\r\n                    painter = painterResource(id = R.drawable.outline_account_child_invert_24),\r\n                    contentDescription = null,\r\n                    tint = MaterialTheme.colorScheme.primary,\r\n                    modifier = Modifier.size(24.dp)\r\n                )\r\n                Spacer(modifier = Modifier.width(16.dp))\r\n                Column {\r\n                    Text(\r\n                        text = stringResource(id = R.string.profile_name),\r\n                        style = MaterialTheme.typography.labelMedium,\r\n                        color = MaterialTheme.colorScheme.onSurfaceVariant\r\n                    )\r\n                    Text(\r\n                        text = user.name ?: \"\",\r\n                        style = MaterialTheme.typography.bodyLarge,\r\n                        color = MaterialTheme.colorScheme.onSurface\r\n                    )\r\n                }\r\n            }\r\n            HorizontalDivider(color = MaterialTheme.colorScheme.outlineVariant)\r\n            // Email\r\n            Row(verticalAlignment = Alignment.CenterVertically) {\r\n                Icon(\r\n                    painter = painterResource(id = R.drawable.mail),\r\n                    contentDescription = null,\r\n                    tint = MaterialTheme.colorScheme.primary,\r\n                    modifier = Modifier.size(24.dp)\r\n                )\r\n                Spacer(modifier = Modifier.width(16.dp))\r\n                Column {\r\n                    Text(\r\n                        text = stringResource(id = R.string.profile_email),\r\n                        style = MaterialTheme.typography.labelMedium,\r\n                        color = MaterialTheme.colorScheme.onSurfaceVariant\r\n                    )\r\n                    Text(\r\n                        text = user.email ?: \"\",\r\n                        style = MaterialTheme.typography.bodyLarge,\r\n                        color = MaterialTheme.colorScheme.onSurface\r\n                    )\r\n                }\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\n@Composable\r\nfun LogoutButton(viewModel: AuthViewModel) {\r\n    Button(\r\n        onClick = { viewModel.logout() },\r\n        colors = ButtonDefaults.buttonColors(containerColor = MaterialTheme.colorScheme.error),\r\n        modifier = Modifier.widthIn(min = 200.dp) // Ancho mínimo para que se vea bien\r\n    ) {\r\n        Icon(\r\n            painter = painterResource(id = R.drawable.ic_close_24),\r\n            contentDescription = null,\r\n            modifier = Modifier.size(18.dp)\r\n        )\r\n        Spacer(modifier = Modifier.width(8.dp))\r\n        Text(stringResource(id = R.string.profile_logout))\r\n    }\r\n}\r\n\r\n// =============================================================================\r\n// MODO EDICIÓN (COMPONENTE EXISTENTE REUTILIZADO)\r\n// =============================================================================\r\n\r\n@Composable\r\nfun EditableProfileView(\r\n    isEditing: Boolean,\r\n    hasChanges: Boolean,\r\n    onSave: () -> Unit,\r\n    onCancel: () -> Unit,\r\n    name: String,\r\n    email: String,\r\n    onNameChange: (String) -> Unit,\r\n    onEmailChange: (String) -> Unit\r\n) {\r\n    Column(\r\n        modifier = Modifier\r\n            .fillMaxSize()\r\n            .padding(24.dp),\r\n        verticalArrangement = Arrangement.Center,\r\n        horizontalAlignment = Alignment.CenterHorizontally\r\n    ) {\r\n        EditableContent(\r\n            isEditing = isEditing,\r\n            hasChanges = hasChanges,\r\n            onSave = onSave,\r\n            onCancel = onCancel,\r\n            modifier = Modifier.fillMaxWidth()\r\n        ) {\r\n            Column(\r\n                modifier = Modifier.fillMaxWidth(),\r\n                verticalArrangement = Arrangement.spacedBy(16.dp)\r\n            ) {\r\n                Text(\r\n                    text = stringResource(id = R.string.title_profile),\r\n                    style = MaterialTheme.typography.titleLarge\r\n                )\r\n\r\n                // Campo Nombre\r\n                Column {\r\n                    Text(\r\n                        text = stringResource(id = R.string.profile_name),\r\n                        style = MaterialTheme.typography.labelMedium,\r\n                        color = MaterialTheme.colorScheme.onSurfaceVariant\r\n                    )\r\n                    Spacer(modifier = Modifier.height(4.dp))\r\n                    EditableText(\r\n                        text = name,\r\n                        isEditing = isEditing,\r\n                        onTextChange = onNameChange,\r\n                        label = stringResource(id = R.string.profile_name),\r\n                        modifier = Modifier.fillMaxWidth()\r\n                    )\r\n                }\r\n\r\n                // Campo Email\r\n                Column {\r\n                    Text(\r\n                        text = stringResource(id = R.string.profile_email),\r\n                        style = MaterialTheme.typography.labelMedium,\r\n                        color = MaterialTheme.colorScheme.onSurfaceVariant\r\n                    )\r\n                    Spacer(modifier = Modifier.height(4.dp))\r\n                    EditableText(\r\n                        text = email,\r\n                        isEditing = isEditing,\r\n                        onTextChange = onEmailChange,\r\n                        label = stringResource(id = R.string.profile_email),\r\n                        modifier = Modifier.fillMaxWidth()\r\n                    )\r\n                }\r\n            }\r\n        }\r\n    }\r\n}
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/app/src/main/java/com/nextapp/monasterio/ui/screens/ProfileScreen.kt b/app/src/main/java/com/nextapp/monasterio/ui/screens/ProfileScreen.kt
--- a/app/src/main/java/com/nextapp/monasterio/ui/screens/ProfileScreen.kt	(revision 26d1bc7c4208f8005e97b4491e6d203945b2c691)
+++ b/app/src/main/java/com/nextapp/monasterio/ui/screens/ProfileScreen.kt	(date 1765214377407)
@@ -19,7 +19,7 @@
 import com.nextapp.monasterio.ui.components.EditableContent
 import com.nextapp.monasterio.ui.components.EditableText
 import com.nextapp.monasterio.viewModels.AuthViewModel
-
+import com.nextapp.monasterio.ui.components.MonasteryButton
 @Composable
 fun ProfileScreen(
     isEditing: Boolean,
@@ -348,7 +348,7 @@
 
 @Composable
 fun LogoutButton(viewModel: AuthViewModel) {
-    Button(
+    MonasteryButton(
         onClick = { viewModel.logout() },
         colors = ButtonDefaults.buttonColors(containerColor = MaterialTheme.colorScheme.error),
         modifier = Modifier.widthIn(min = 200.dp) // Ancho mínimo para que se vea bien
Index: app/src/main/java/com/nextapp/monasterio/ui/virtualvisit/screens/DetalleFiguraScreen.kt
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>package com.nextapp.monasterio.ui.virtualvisit.screens\r\n\r\nimport androidx.compose.animation.Crossfade\r\nimport androidx.compose.animation.ExperimentalAnimationApi\r\nimport androidx.compose.foundation.background\r\nimport androidx.compose.foundation.border\r\nimport androidx.compose.foundation.clickable\r\nimport androidx.compose.foundation.layout.*\r\nimport androidx.compose.foundation.rememberScrollState\r\nimport androidx.compose.foundation.shape.CircleShape\r\nimport androidx.compose.foundation.shape.RoundedCornerShape\r\nimport androidx.compose.foundation.verticalScroll\r\nimport androidx.compose.material3.*\r\nimport androidx.compose.runtime.*\r\nimport androidx.compose.ui.Alignment\r\nimport androidx.compose.ui.Modifier\r\nimport androidx.compose.ui.draw.clip\r\nimport androidx.compose.ui.graphics.Color\r\nimport androidx.compose.ui.layout.ContentScale\r\nimport androidx.compose.ui.platform.LocalConfiguration\r\nimport androidx.compose.ui.platform.LocalContext\r\nimport androidx.compose.ui.res.painterResource\r\nimport androidx.compose.ui.res.stringResource\r\nimport androidx.compose.ui.text.font.FontWeight\r\nimport androidx.compose.ui.text.style.TextAlign\r\nimport androidx.compose.ui.unit.dp\r\nimport androidx.compose.ui.unit.sp\r\nimport androidx.navigation.NavHostController\r\nimport coil.compose.AsyncImage\r\nimport com.nextapp.monasterio.AppRoutes\r\nimport com.nextapp.monasterio.R\r\nimport com.nextapp.monasterio.models.FiguraData\r\nimport com.nextapp.monasterio.models.ImagenData\r\nimport com.nextapp.monasterio.repository.FiguraRepository\r\nimport com.nextapp.monasterio.repository.ImagenRepository\r\nimport kotlinx.coroutines.delay\r\nimport android.util.Log\r\n\r\n@OptIn(ExperimentalAnimationApi::class)\r\n@Composable\r\nfun DetalleFiguraScreen(\r\n    navController: NavHostController,\r\n    rootNavController: NavHostController? = null, // \uD83D\uDC48 AÑADIDO: Ahora acepta el navegador raíz\r\n    nombre: String\r\n) {\r\n    // 1. Estados de Datos\r\n    var figura by remember { mutableStateOf<FiguraData?>(null) }\r\n    var imagenes by remember { mutableStateOf<List<ImagenData>>(emptyList()) }\r\n    var isLoading by remember { mutableStateOf(true) }\r\n\r\n    // 2. Determinación del Idioma\r\n    val configuration = LocalConfiguration.current\r\n    val locale = configuration.locales[0]\r\n    val currentLanguageCode = locale.language\r\n\r\n    // 3. ESTADO DEL CARRUSEL\r\n    var currentIndex by remember { mutableStateOf(0) }\r\n\r\n    // Repositorios\r\n    val figuraRepository = remember { FiguraRepository }\r\n    val imagenRepository = remember { ImagenRepository() }\r\n\r\n    // 4. LÓGICA DE CARGA ROBUSTA (DOBLE INTENTO)\r\n    LaunchedEffect(nombre, currentLanguageCode) {\r\n        isLoading = true\r\n        Log.d(\"DetalleFigura\", \"Buscando figura con clave: $nombre\")\r\n\r\n        // INTENTO 1: Buscar por campo 'nombre'\r\n        var loadedFigura = figuraRepository.getFiguraByNombre(nombre)\r\n\r\n        // INTENTO 2: Si falla, buscar por ID del documento\r\n        if (loadedFigura == null) {\r\n            Log.d(\"DetalleFigura\", \"No encontrada por nombre. Probando por ID...\")\r\n            loadedFigura = figuraRepository.getFiguraById(nombre)\r\n        }\r\n\r\n        figura = loadedFigura\r\n\r\n        // Cargar imágenes referenciadas\r\n        if (loadedFigura != null) {\r\n            Log.d(\"DetalleFigura\", \"Figura encontrada: ${loadedFigura.nombre}\")\r\n            val loadedImages = loadedFigura.imagenes.mapNotNull { imageId ->\r\n                // Asumimos que la lista 'imagenes' contiene IDs de string\r\n                imagenRepository.getImageById(imageId)\r\n            }\r\n            imagenes = loadedImages\r\n        } else {\r\n            Log.e(\"DetalleFigura\", \"❌ No se encontró ninguna figura con clave: $nombre\")\r\n        }\r\n        isLoading = false\r\n    }\r\n\r\n    // 5. LÓGICA DE TRANSICIÓN AUTOMÁTICA DEL CARRUSEL\r\n    if (imagenes.size > 1) {\r\n        LaunchedEffect(currentIndex, imagenes.size) {\r\n            delay(4000L)\r\n            currentIndex = (currentIndex + 1) % imagenes.size\r\n        }\r\n    }\r\n\r\n    Box(\r\n        modifier = Modifier\r\n            .fillMaxSize()\r\n            .background(Color.White)\r\n            .statusBarsPadding()\r\n    ) {\r\n        if (isLoading) {\r\n            Box(modifier = Modifier.fillMaxSize(), contentAlignment = Alignment.Center) {\r\n                CircularProgressIndicator(color = Color(0xFFFF8F00))\r\n            }\r\n        } else if (figura == null) {\r\n            // Mensaje de error si fallan ambos intentos\r\n            Box(modifier = Modifier.fillMaxSize(), contentAlignment = Alignment.Center) {\r\n                Text(\"Error cargando datos: $nombre\", color = Color.Red)\r\n            }\r\n        } else {\r\n            // CONTENIDO PRINCIPAL\r\n            Column(\r\n                modifier = Modifier\r\n                    .fillMaxSize()\r\n                    .verticalScroll(rememberScrollState())\r\n                    .padding(horizontal = 16.dp)\r\n                    .padding(bottom = 40.dp) // Espacio inferior\r\n            ) {\r\n\r\n                // --- CABECERA (Atrás + Título) ---\r\n                Box(\r\n                    modifier = Modifier\r\n                        .fillMaxWidth()\r\n                        .padding(top = 16.dp)\r\n                ) {\r\n                    // 1. Botón Atrás (Izq)\r\n                    Box(modifier = Modifier.align(Alignment.CenterStart)) {\r\n                        IconButton(\r\n                            onClick = { navController.popBackStack() },\r\n                            modifier = Modifier\r\n                                .background(Color.Black.copy(alpha = 0.5f), RoundedCornerShape(12.dp))\r\n                                .size(36.dp)\r\n                        ) {\r\n                            Icon(\r\n                                painter = painterResource(id = R.drawable.arrow_back),\r\n                                contentDescription = stringResource(R.string.go_back),\r\n                                tint = Color.White,\r\n                                modifier = Modifier.size(20.dp)\r\n                            )\r\n                        }\r\n                    }\r\n\r\n                    val nombreFigura = when (currentLanguageCode) {\r\n                        \"de\" -> figura!!.nombre_de\r\n                        \"en\" -> figura!!.nombre_en\r\n                        \"fr\" -> figura!!.nombre_fr\r\n                        else -> figura!!.nombre\r\n                    }\r\n\r\n                    // 2. Título (Centro)\r\n                    Text(\r\n                        text = nombreFigura,\r\n                        fontSize = 22.sp,\r\n                        fontWeight = FontWeight.Black,\r\n                        color = Color(figura!!.colorResaltado.toUInt().toInt()),\r\n                        textAlign = TextAlign.Center,\r\n                        modifier = Modifier\r\n                            .align(Alignment.Center)\r\n                            .padding(horizontal = 48.dp)\r\n                    )\r\n                }\r\n\r\n                Spacer(modifier = Modifier.height(16.dp))\r\n\r\n                // --- 7. IMÁGENES (CARRUSEL) ---\r\n                if (imagenes.isNotEmpty()) {\r\n                    Box(\r\n                        modifier = Modifier\r\n                            .fillMaxWidth()\r\n                            .height(260.dp)\r\n                            .clip(RoundedCornerShape(12.dp))\r\n                            .border(2.dp, Color(figura!!.colorResaltado.toUInt().toInt()), RoundedCornerShape(12.dp)),\r\n                        contentAlignment = Alignment.Center\r\n                    ) {\r\n                        Crossfade(targetState = currentIndex, label = \"img\") { page ->\r\n                            AsyncImage(\r\n                                model = imagenes[page].url,\r\n                                contentDescription = null,\r\n                                contentScale = ContentScale.Crop,\r\n                                modifier = Modifier.fillMaxSize()\r\n                            )\r\n                        }\r\n                        // Puntos indicadores\r\n                        Row(\r\n                            Modifier.align(Alignment.BottomCenter).padding(6.dp)\r\n                        ) {\r\n                            repeat(imagenes.size) { index ->\r\n                                val selected = currentIndex == index\r\n                                Box(\r\n                                    Modifier.padding(3.dp).size(if (selected) 8.dp else 6.dp)\r\n                                        .background(if (selected) Color.White else Color.White.copy(0.5f), CircleShape)\r\n                                )\r\n                            }\r\n                        }\r\n                    }\r\n                    Spacer(modifier = Modifier.height(24.dp))\r\n                }\r\n\r\n                // --- 8. INFORMACIÓN ---\r\n                val infoText = when (currentLanguageCode) {\r\n                    \"de\" -> figura!!.info_de\r\n                    \"en\" -> figura!!.info_en\r\n                    \"fr\" -> figura!!.info_fr\r\n                    else -> figura!!.info_es\r\n                }\r\n\r\n                Text(\r\n                    text = stringResource(R.string.general_information_figure),\r\n                    fontSize = 20.sp,\r\n                    fontWeight = FontWeight.Bold,\r\n                    color = Color(figura!!.colorResaltado.toUInt().toInt()),\r\n                    modifier = Modifier.padding(bottom = 8.dp)\r\n                )\r\n                Text(\r\n                    text = infoText ?: \"\",\r\n                    fontSize = 16.sp,\r\n                    color = Color.Black\r\n                )\r\n\r\n                Spacer(modifier = Modifier.height(32.dp))\r\n\r\n                // --- 9. BOTÓN VER 360 (PIE DE PÁGINA) ---\r\n                // Solo se muestra si la figura tiene URL 360 en Firebase\r\n                if (!figura!!.vista360Url.isNullOrBlank()) {\r\n                    Button(\r\n                        onClick = {\r\n                            // Navegamos usando el rootNavController para salir del contexto del mapa\r\n                            rootNavController?.navigate(AppRoutes.PIN_360 + \"/${figura!!.id}\")\r\n                        },\r\n                        modifier = Modifier\r\n                            .fillMaxWidth()\r\n                            .height(56.dp),\r\n                        colors = ButtonDefaults.buttonColors(containerColor = Color.Black),\r\n                        shape = RoundedCornerShape(12.dp)\r\n                    ) {\r\n                        Text(\r\n                            text = stringResource(R.string.see_360),\r\n                            color = Color.White,\r\n                            fontSize = 18.sp,\r\n                            fontWeight = FontWeight.Bold\r\n                        )\r\n                    }\r\n                    // Espacio extra al final\r\n                    Spacer(modifier = Modifier.height(16.dp))\r\n                }\r\n            }\r\n        }\r\n    }\r\n}
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/app/src/main/java/com/nextapp/monasterio/ui/virtualvisit/screens/DetalleFiguraScreen.kt b/app/src/main/java/com/nextapp/monasterio/ui/virtualvisit/screens/DetalleFiguraScreen.kt
--- a/app/src/main/java/com/nextapp/monasterio/ui/virtualvisit/screens/DetalleFiguraScreen.kt	(revision 26d1bc7c4208f8005e97b4491e6d203945b2c691)
+++ b/app/src/main/java/com/nextapp/monasterio/ui/virtualvisit/screens/DetalleFiguraScreen.kt	(date 1765214558453)
@@ -35,7 +35,7 @@
 import com.nextapp.monasterio.repository.ImagenRepository
 import kotlinx.coroutines.delay
 import android.util.Log
-
+import com.nextapp.monasterio.ui.components.MonasteryButton
 @OptIn(ExperimentalAnimationApi::class)
 @Composable
 fun DetalleFiguraScreen(
@@ -228,7 +228,7 @@
                 // --- 9. BOTÓN VER 360 (PIE DE PÁGINA) ---
                 // Solo se muestra si la figura tiene URL 360 en Firebase
                 if (!figura!!.vista360Url.isNullOrBlank()) {
-                    Button(
+                    MonasteryButton(
                         onClick = {
                             // Navegamos usando el rootNavController para salir del contexto del mapa
                             rootNavController?.navigate(AppRoutes.PIN_360 + "/${figura!!.id}")
Index: app/src/main/java/com/nextapp/monasterio/ui/virtualvisit/components/MapTutorialOverlay.kt
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>package com.nextapp.monasterio.ui.virtualvisit.components\r\n\r\nimport androidx.compose.foundation.Canvas\r\nimport androidx.compose.foundation.background\r\nimport androidx.compose.foundation.border\r\nimport androidx.compose.foundation.clickable\r\nimport androidx.compose.foundation.layout.*\r\nimport androidx.compose.foundation.rememberScrollState\r\nimport androidx.compose.foundation.shape.RoundedCornerShape\r\nimport androidx.compose.foundation.verticalScroll\r\nimport androidx.compose.material3.*\r\nimport androidx.compose.runtime.*\r\nimport androidx.compose.ui.Alignment\r\nimport androidx.compose.ui.Modifier\r\nimport androidx.compose.ui.draw.clip\r\nimport androidx.compose.ui.geometry.CornerRadius\r\nimport androidx.compose.ui.geometry.Offset\r\nimport androidx.compose.ui.geometry.Size\r\nimport androidx.compose.ui.graphics.BlendMode\r\nimport androidx.compose.ui.graphics.Color\r\nimport androidx.compose.ui.graphics.graphicsLayer\r\nimport androidx.compose.ui.platform.LocalConfiguration\r\nimport androidx.compose.ui.platform.LocalDensity\r\nimport androidx.compose.ui.res.stringResource\r\nimport androidx.compose.ui.text.style.TextAlign\r\nimport androidx.compose.ui.unit.Dp\r\nimport androidx.compose.ui.unit.dp\r\nimport androidx.compose.ui.window.Dialog\r\nimport androidx.compose.ui.window.DialogProperties\r\nimport com.nextapp.monasterio.R\r\nimport kotlin.math.max\r\n\r\n@Composable\r\nfun GenericTutorialOverlay(\r\n    title: String? = null,\r\n    description: String,\r\n    highlightCenter: Offset = Offset.Unspecified,\r\n    highlightRadius: Float = 0f,\r\n    highlightRectSize: Size? = null,\r\n    dialogAlignment: Alignment? = null,\r\n    buttonText: String,\r\n    onCloseClicked: (Boolean) -> Unit\r\n) {\r\n    var dontShowAgain by remember { mutableStateOf(false) }\r\n    // El estado del scroll ahora solo afecta a la descripción\r\n    val descriptionScrollState = rememberScrollState()\r\n\r\n    val parentDensity = LocalDensity.current\r\n    val parentConfiguration = LocalConfiguration.current\r\n\r\n    Dialog(\r\n        onDismissRequest = { },\r\n        properties = DialogProperties(usePlatformDefaultWidth = false, decorFitsSystemWindows = false)\r\n    ) {\r\n        CompositionLocalProvider(\r\n            LocalDensity provides parentDensity,\r\n            LocalConfiguration provides parentConfiguration\r\n        ) {\r\n            BoxWithConstraints(\r\n                modifier = Modifier.fillMaxSize()\r\n            ) {\r\n                val screenHeightPx = constraints.maxHeight.toFloat()\r\n                val density = LocalDensity.current\r\n\r\n                // 1. Determinar Alineación\r\n                val finalAlignment = if (dialogAlignment != null) {\r\n                    dialogAlignment\r\n                } else {\r\n                    if (highlightCenter != Offset.Unspecified) {\r\n                        if (highlightCenter.y > (screenHeightPx / 2)) Alignment.TopCenter else Alignment.BottomCenter\r\n                    } else {\r\n                        Alignment.BottomCenter\r\n                    }\r\n                }\r\n\r\n                // 2. Calcular altura máxima (igual que antes, para no tapar el foco)\r\n                val maxCardHeight: Dp = if (highlightCenter != Offset.Unspecified) {\r\n                    val safeMargin = with(density) { 32.dp.toPx() }\r\n                    val focusEdgeY = if (highlightRectSize != null) {\r\n                        if (finalAlignment == Alignment.TopCenter) highlightCenter.y - (highlightRectSize.height / 2) else highlightCenter.y + (highlightRectSize.height / 2)\r\n                    } else {\r\n                        if (finalAlignment == Alignment.TopCenter) highlightCenter.y - highlightRadius else highlightCenter.y + highlightRadius\r\n                    }\r\n                    val availableSpacePx = if (finalAlignment == Alignment.TopCenter) {\r\n                        focusEdgeY - safeMargin\r\n                    } else {\r\n                        screenHeightPx - focusEdgeY - safeMargin\r\n                    }\r\n                    with(density) { max(150f, availableSpacePx).toDp() } // Mínimo un poco más alto ahora\r\n                } else {\r\n                    450.dp\r\n                }\r\n\r\n                Box(\r\n                    modifier = Modifier.fillMaxSize(),\r\n                    contentAlignment = finalAlignment\r\n                ) {\r\n                    // --- CANVAS (Fondo y Foco) ---\r\n                    Canvas(\r\n                        modifier = Modifier.fillMaxSize().clickable(enabled = false) {}.graphicsLayer { alpha = 0.99f }\r\n                    ) {\r\n                        drawRect(color = Color.Black.copy(alpha = 0.85f))\r\n                        if (highlightCenter != Offset.Unspecified) {\r\n                            if (highlightRectSize != null) {\r\n                                val topLeft = highlightCenter - Offset(highlightRectSize.width / 2, highlightRectSize.height / 2)\r\n                                val cornerRadius = CornerRadius(16.dp.toPx(), 16.dp.toPx())\r\n                                drawRoundRect(color = Color.Transparent, topLeft = topLeft, size = highlightRectSize, cornerRadius = cornerRadius, blendMode = BlendMode.Clear)\r\n                                drawRoundRect(color = Color.White.copy(alpha = 0.3f), topLeft = topLeft - Offset(4f, 4f), size = Size(highlightRectSize.width + 8f, highlightRectSize.height + 8f), cornerRadius = cornerRadius, style = androidx.compose.ui.graphics.drawscope.Stroke(width = 8f))\r\n                            } else if (highlightRadius > 0) {\r\n                                drawCircle(color = Color.Transparent, center = highlightCenter, radius = highlightRadius, blendMode = BlendMode.Clear)\r\n                                drawCircle(color = Color.White.copy(alpha = 0.3f), center = highlightCenter, radius = highlightRadius + 4f, style = androidx.compose.ui.graphics.drawscope.Stroke(width = 12f))\r\n                            }\r\n                        }\r\n                    }\r\n\r\n                    // --- TARJETA DEL DIÁLOGO ---\r\n                    Surface(\r\n                        modifier = Modifier\r\n                            .fillMaxWidth(1f)\r\n                            .padding(horizontal = 16.dp)\r\n                            .padding(\r\n                                bottom = if (finalAlignment == Alignment.BottomCenter) 32.dp else 0.dp,\r\n                                top = if (finalAlignment == Alignment.TopCenter) 60.dp else 0.dp\r\n                            )\r\n                            .navigationBarsPadding()\r\n                            .statusBarsPadding()\r\n                            // La altura se restringe dinámicamente aquí\r\n                            .heightIn(max = maxCardHeight),\r\n                        shape = RoundedCornerShape(24.dp),\r\n                        color = MaterialTheme.colorScheme.surface,\r\n                        tonalElevation = 8.dp\r\n                    ) {\r\n                        // Usamos una Columna normal, SIN scroll global\r\n                        Column(\r\n                            modifier = Modifier.padding(20.dp),\r\n                            horizontalAlignment = Alignment.CenterHorizontally\r\n                        ) {\r\n                            // 1. CABECERA FIJA (Título)\r\n                            if (title != null) {\r\n                                Text(\r\n                                    text = title,\r\n                                    style = MaterialTheme.typography.headlineSmall,\r\n                                    textAlign = TextAlign.Center,\r\n                                    color = MaterialTheme.colorScheme.onSurface\r\n                                )\r\n                                Spacer(Modifier.height(12.dp))\r\n                            }\r\n\r\n                            // 2. CUERPO SCROLLABLE (Descripción con borde)\r\n                            // Este Box ocupa el espacio intermedio y permite scroll si es necesario\r\n                            Box(\r\n                                modifier = Modifier\r\n                                    .fillMaxWidth()\r\n                                    // weight(1f, fill = false) es clave: Ocupa el espacio disponible\r\n                                    // pero no se estira si el texto es corto. Si es largo, se limita.\r\n                                    .weight(1f, fill = false)\r\n                                    // Borde fino alrededor del área de texto\r\n                                    .border(\r\n                                        width = 1.dp,\r\n                                        color = MaterialTheme.colorScheme.outlineVariant, // Color sutil\r\n                                        shape = RoundedCornerShape(12.dp)\r\n                                    )\r\n                                    // Clip para que el scroll no se salga de las esquinas redondeadas\r\n                                    .clip(RoundedCornerShape(12.dp))\r\n                                    // Padding interno para que el texto no toque el borde\r\n                                    .padding(12.dp)\r\n                                    // AQUÍ ESTÁ EL SCROLL: Solo afecta a este cuadro\r\n                                    .verticalScroll(descriptionScrollState),\r\n                                contentAlignment = Alignment.Center\r\n                            ) {\r\n                                Text(\r\n                                    text = description,\r\n                                    style = MaterialTheme.typography.bodyLarge,\r\n                                    textAlign = TextAlign.Center,\r\n                                    color = MaterialTheme.colorScheme.onSurfaceVariant\r\n                                )\r\n                            }\r\n\r\n                            // 3. PIE FIJO (Checkbox y Botón)\r\n                            // Estos elementos siempre estarán visibles abajo\r\n                            Column(\r\n                                horizontalAlignment = Alignment.CenterHorizontally\r\n                            ) {\r\n                                Row(\r\n                                    verticalAlignment = Alignment.CenterVertically,\r\n                                    modifier = Modifier\r\n                                        .fillMaxWidth()\r\n                                        .background(MaterialTheme.colorScheme.surfaceVariant.copy(alpha = 0.3f), RoundedCornerShape(12.dp))\r\n                                        .clickable { dontShowAgain = !dontShowAgain }\r\n                                        .padding(horizontal = 0.dp, vertical = 0.dp)\r\n                                ) {\r\n                                    Checkbox(\r\n                                        checked = dontShowAgain,\r\n                                        onCheckedChange = { dontShowAgain = it },\r\n                                        colors = CheckboxDefaults.colors(checkedColor = MaterialTheme.colorScheme.primary)\r\n                                    )\r\n                                    Spacer(Modifier.width(8.dp))\r\n                                    Text(\r\n                                        text = stringResource(R.string.dont_show_again),\r\n                                        style = MaterialTheme.typography.bodyMedium,\r\n                                        color = MaterialTheme.colorScheme.onSurface\r\n                                    )\r\n                                }\r\n\r\n                                Spacer(Modifier.height(16.dp))\r\n\r\n                                Button(\r\n                                    onClick = { onCloseClicked(dontShowAgain) },\r\n                                    modifier = Modifier.fillMaxWidth(),\r\n                                    shape = RoundedCornerShape(12.dp)\r\n                                ) {\r\n                                    Text(\r\n                                        text = buttonText.uppercase(),\r\n                                        style = MaterialTheme.typography.labelLarge\r\n                                    )\r\n                                }\r\n                            }\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    }\r\n}
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/app/src/main/java/com/nextapp/monasterio/ui/virtualvisit/components/MapTutorialOverlay.kt b/app/src/main/java/com/nextapp/monasterio/ui/virtualvisit/components/MapTutorialOverlay.kt
--- a/app/src/main/java/com/nextapp/monasterio/ui/virtualvisit/components/MapTutorialOverlay.kt	(revision 26d1bc7c4208f8005e97b4491e6d203945b2c691)
+++ b/app/src/main/java/com/nextapp/monasterio/ui/virtualvisit/components/MapTutorialOverlay.kt	(date 1765214652630)
@@ -29,7 +29,7 @@
 import androidx.compose.ui.window.DialogProperties
 import com.nextapp.monasterio.R
 import kotlin.math.max
-
+import com.nextapp.monasterio.ui.components.MonasteryButton
 @Composable
 fun GenericTutorialOverlay(
     title: String? = null,
@@ -204,7 +204,7 @@
 
                                 Spacer(Modifier.height(16.dp))
 
-                                Button(
+                                MonasteryButton(
                                     onClick = { onCloseClicked(dontShowAgain) },
                                     modifier = Modifier.fillMaxWidth(),
                                     shape = RoundedCornerShape(12.dp)
Index: app/src/main/java/com/nextapp/monasterio/ui/components/MonasteryButton.kt
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/app/src/main/java/com/nextapp/monasterio/ui/components/MonasteryButton.kt b/app/src/main/java/com/nextapp/monasterio/ui/components/MonasteryButton.kt
new file mode 100644
--- /dev/null	(date 1765212880498)
+++ b/app/src/main/java/com/nextapp/monasterio/ui/components/MonasteryButton.kt	(date 1765212880498)
@@ -0,0 +1,41 @@
+package com.nextapp.monasterio.ui.components
+
+import androidx.compose.foundation.layout.RowScope
+import androidx.compose.material3.*
+import androidx.compose.runtime.Composable
+import androidx.compose.ui.Modifier
+import androidx.compose.ui.graphics.Shape
+import androidx.compose.ui.platform.LocalContext
+import com.nextapp.monasterio.utils.SoundManager
+
+@Composable
+fun MonasteryButton(
+    onClick: () -> Unit,
+    modifier: Modifier = Modifier,
+    enabled: Boolean = true,
+    shape: Shape = ButtonDefaults.shape,
+    colors: ButtonColors = ButtonDefaults.buttonColors(),
+    elevation: ButtonElevation? = ButtonDefaults.buttonElevation(),
+    border: androidx.compose.foundation.BorderStroke? = null,
+    contentPadding: androidx.compose.foundation.layout.PaddingValues = ButtonDefaults.ContentPadding,
+    content: @Composable RowScope.() -> Unit
+) {
+    val context = LocalContext.current
+
+    Button(
+        onClick = {
+            // 1. Reproducir sonido automáticamente
+            SoundManager.playClickSound(context)
+            // 2. Ejecutar la acción real del botón
+            onClick()
+        },
+        modifier = modifier,
+        enabled = enabled,
+        shape = shape,
+        colors = colors,
+        elevation = elevation,
+        border = border,
+        contentPadding = contentPadding,
+        content = content
+    )
+}
\ No newline at end of file
Index: app/src/main/java/com/nextapp/monasterio/utils/SoundManager.kt
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/app/src/main/java/com/nextapp/monasterio/utils/SoundManager.kt b/app/src/main/java/com/nextapp/monasterio/utils/SoundManager.kt
new file mode 100644
--- /dev/null	(date 1765212827580)
+++ b/app/src/main/java/com/nextapp/monasterio/utils/SoundManager.kt	(date 1765212827580)
@@ -0,0 +1,30 @@
+package com.nextapp.monasterio.utils
+
+import android.content.Context
+import android.media.MediaPlayer
+import com.nextapp.monasterio.R
+
+object SoundManager {
+    private var mediaPlayer: MediaPlayer? = null
+
+    fun playClickSound(context: Context) {
+        // Si no existe, lo creamos
+        if (mediaPlayer == null) {
+            mediaPlayer = MediaPlayer.create(context, R.raw.botones)
+        }
+
+        // Si está sonando, lo rebobinamos
+        if (mediaPlayer?.isPlaying == true) {
+            mediaPlayer?.seekTo(0)
+        }
+
+        mediaPlayer?.start()
+    }
+
+    // Llamar a esto en el onDestroy del MainActivity si quieres ser muy estricto,
+    // aunque para sonidos cortos de UI no es crítico.
+    fun release() {
+        mediaPlayer?.release()
+        mediaPlayer = null
+    }
+}
\ No newline at end of file
