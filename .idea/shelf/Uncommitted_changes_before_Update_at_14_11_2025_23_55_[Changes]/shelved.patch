Index: app/src/main/java/com/nextapp/monasterio/ui/virtualvisit/screens/PinDetalleScreen.kt
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>package com.nextapp.monasterio.ui.virtualvisit.screens\r\n\r\nimport android.app.Activity\r\nimport androidx.compose.foundation.*\r\nimport androidx.compose.foundation.layout.*\r\nimport androidx.compose.foundation.pager.HorizontalPager\r\nimport androidx.compose.foundation.pager.rememberPagerState\r\nimport androidx.compose.foundation.shape.CircleShape\r\nimport androidx.compose.foundation.shape.RoundedCornerShape\r\nimport androidx.compose.material3.*\r\nimport androidx.compose.runtime.*\r\nimport androidx.compose.ui.Alignment\r\nimport androidx.compose.ui.Modifier\r\nimport androidx.compose.ui.draw.clip\r\nimport androidx.compose.ui.graphics.Color\r\nimport androidx.compose.ui.layout.ContentScale\r\nimport androidx.compose.ui.platform.LocalView\r\nimport androidx.compose.ui.res.painterResource\r\nimport androidx.compose.ui.text.font.FontWeight\r\nimport androidx.compose.ui.text.style.TextAlign\r\nimport androidx.compose.ui.unit.dp\r\nimport androidx.compose.ui.unit.sp\r\nimport androidx.compose.ui.viewinterop.AndroidView\r\nimport androidx.compose.ui.window.Dialog\r\nimport androidx.compose.ui.window.DialogProperties\r\nimport androidx.core.view.WindowCompat\r\nimport coil.compose.AsyncImage\r\nimport coil.load\r\nimport com.github.chrisbanes.photoview.PhotoView\r\nimport com.nextapp.monasterio.R\r\nimport com.nextapp.monasterio.models.PinData\r\nimport androidx.compose.foundation.verticalScroll\r\nimport androidx.compose.foundation.rememberScrollState\r\nimport androidx.compose.ui.platform.LocalConfiguration\r\nimport androidx.compose.ui.res.stringResource\r\nimport com.nextapp.monasterio.models.Ubicacion\r\nimport java.util.Locale\r\n\r\n@OptIn(ExperimentalFoundationApi::class)\r\n@Composable\r\nfun PinDetalleScreen(\r\n    pin: PinData,\r\n    onBack: () -> Unit,\r\n    onVer360: (() -> Unit)? = null\r\n) {\r\n    val view = LocalView.current\r\n    LaunchedEffect(Unit) {\r\n        val window = (view.context as? Activity)?.window\r\n        window?.let { WindowCompat.setDecorFitsSystemWindows(it, false) }\r\n    }\r\n\r\n    val imagenes = if (pin.imagenesDetalladas.isNotEmpty()) pin.imagenesDetalladas else emptyList()\r\n\r\n    LaunchedEffect(Unit) {\r\n        android.util.Log.d(\"PinDetalleScreen\", \"\uD83D\uDDBC\uFE0F Imagenes cargadas: ${imagenes.map { it.etiqueta }}\")\r\n    }\r\n\r\n    val pagerState = rememberPagerState(pageCount = { imagenes.size })\r\n    var selectedImageUrl by remember { mutableStateOf<String?>(null) }\r\n    var selectedImageLabel by remember { mutableStateOf<String?>(null) }\r\n\r\n    val configuration = LocalConfiguration.current\r\n    val locale: Locale = configuration.locales[0]\r\n    val language = locale.language\r\n\r\n    val titulo_pin: String\r\n    val descripcion_pin: String?\r\n    val ubicacion_pin: Ubicacion?\r\n\r\n    when (language) {\r\n        \"es\" -> {\r\n            titulo_pin = pin.titulo\r\n            descripcion_pin = pin.descripcion\r\n            ubicacion_pin = pin.ubicacion\r\n        }\r\n        \"de\" -> {\r\n            titulo_pin = pin.tituloAleman\r\n            descripcion_pin = pin.descripcionAleman\r\n            ubicacion_pin = pin.ubicacionAleman\r\n        }\r\n        else -> {\r\n            titulo_pin = pin.tituloIngles\r\n            descripcion_pin = pin.descripcionIngles\r\n            ubicacion_pin = pin.ubicacionIngles\r\n        }\r\n    }\r\n\r\n    Box(\r\n        modifier = Modifier\r\n            .fillMaxSize()\r\n            .background(Color.White)\r\n            .statusBarsPadding()\r\n    ) {\r\n        Column(\r\n            modifier = Modifier\r\n                .fillMaxSize()\r\n                .padding(horizontal = 16.dp)\r\n                .padding(bottom = 90.dp),\r\n            horizontalAlignment = Alignment.CenterHorizontally\r\n        ) {\r\n            // \uD83D\uDD19 Botón atrás\r\n            Box(\r\n                modifier = Modifier\r\n                    .fillMaxWidth()\r\n                    .padding(top = 16.dp),\r\n                contentAlignment = Alignment.CenterStart\r\n            ) {\r\n                Image(\r\n                    painter = painterResource(id = R.drawable.arrow_back),\r\n                    contentDescription = stringResource(R.string.go_back),\r\n                    modifier = Modifier\r\n                        .size(28.dp)\r\n                        .clickable { onBack() }\r\n                )\r\n            }\r\n\r\n            Spacer(modifier = Modifier.height(16.dp))\r\n\r\n            // \uD83C\uDFF7\uFE0F Título\r\n            Text(\r\n                text = buildString {\r\n                    append(titulo_pin)\r\n                    ubicacion_pin?.let { append(\" (${it.displayName})\") }\r\n                },\r\n                fontSize = 26.sp,\r\n                fontWeight = FontWeight.Bold,\r\n                color = Color.Black,\r\n                textAlign = TextAlign.Center,\r\n                modifier = Modifier.fillMaxWidth()\r\n            )\r\n\r\n            Spacer(modifier = Modifier.height(20.dp))\r\n\r\n            // \uD83D\uDDBC\uFE0F Carrusel con etiqueta real desde Firestore\r\n            if (imagenes.isNotEmpty()) {\r\n                Box(\r\n                    modifier = Modifier\r\n                        .fillMaxWidth()\r\n                        .height(250.dp)\r\n                        .clip(RoundedCornerShape(16.dp))\r\n                        .border(3.dp, Color.Black, RoundedCornerShape(16.dp))\r\n                ) {\r\n                    HorizontalPager(state = pagerState) { page ->\r\n                        val imagen = imagenes[page]\r\n                        Box(modifier = Modifier.fillMaxSize()) {\r\n                            AsyncImage(\r\n                                model = imagen.url,\r\n                                contentDescription = imagen.etiqueta,\r\n                                contentScale = ContentScale.Crop,\r\n                                modifier = Modifier\r\n                                    .fillMaxSize()\r\n                                    .clickable {\r\n                                        selectedImageUrl = imagen.url\r\n                                        selectedImageLabel = imagen.etiqueta\r\n                                    }\r\n                            )\r\n\r\n                            // \uD83D\uDD39 Etiqueta abajo a la izquierda\r\n                            Text(\r\n                                text = imagen.etiqueta,\r\n                                color = Color.White,\r\n                                fontSize = 14.sp,\r\n                                modifier = Modifier\r\n                                    .align(Alignment.BottomStart)\r\n                                    .background(Color.Black.copy(alpha = 0.6f))\r\n                                    .padding(horizontal = 10.dp, vertical = 6.dp)\r\n                            )\r\n                        }\r\n                    }\r\n\r\n                    // \uD83D\uDD38 Indicadores inferiores\r\n                    Row(\r\n                        Modifier\r\n                            .align(Alignment.BottomCenter)\r\n                            .padding(bottom = 6.dp)\r\n                    ) {\r\n                        repeat(imagenes.size) { index ->\r\n                            val selected = pagerState.currentPage == index\r\n                            Box(\r\n                                Modifier\r\n                                    .padding(3.dp)\r\n                                    .size(if (selected) 8.dp else 6.dp)\r\n                                    .background(Color.White.copy(alpha = if (selected) 1f else 0.6f), shape = CircleShape)\r\n                            )\r\n                        }\r\n                    }\r\n                }\r\n                Spacer(modifier = Modifier.height(24.dp))\r\n            }\r\n\r\n            // \uD83D\uDCDD Descripción\r\n            val descripcion = descripcion_pin ?: \"\"\r\n            if (descripcion.isNotBlank()) {\r\n                val textScrollState = rememberScrollState()\r\n                Box(\r\n                    modifier = Modifier\r\n                        .fillMaxWidth()\r\n                        .weight(1f)\r\n                        .border(1.dp, Color.LightGray.copy(alpha = 0.5f), RoundedCornerShape(8.dp))\r\n                        .clip(RoundedCornerShape(8.dp))\r\n                ) {\r\n                    Text(\r\n                        text = descripcion,\r\n                        fontSize = 16.sp,\r\n                        color = Color.DarkGray,\r\n                        lineHeight = 22.sp,\r\n                        modifier = Modifier\r\n                            .fillMaxSize()\r\n                            .padding(horizontal = 12.dp, vertical = 8.dp)\r\n                            .verticalScroll(textScrollState)\r\n                    )\r\n                }\r\n            }\r\n        }\r\n\r\n        // \uD83D\uDD18 Botón 360\r\n        onVer360?.let {\r\n            Box(\r\n                modifier = Modifier\r\n                    .align(Alignment.BottomCenter)\r\n                    .fillMaxWidth()\r\n                    .background(Color.White)\r\n                    .navigationBarsPadding()\r\n                    .padding(horizontal = 16.dp, vertical = 12.dp)\r\n            ) {\r\n                Button(\r\n                    onClick = it,\r\n                    modifier = Modifier\r\n                        .fillMaxWidth()\r\n                        .height(56.dp),\r\n                    colors = ButtonDefaults.buttonColors(containerColor = Color.Black),\r\n                    shape = RoundedCornerShape(12.dp)\r\n                ) {\r\n                    Text(\r\n                        text = stringResource(R.string.see_360),\r\n                        color = Color.White,\r\n                        fontSize = 18.sp,\r\n                        fontWeight = FontWeight.Bold,\r\n                    )\r\n                }\r\n            }\r\n        }\r\n\r\n        // \uD83D\uDD0D Zoom con etiqueta real\r\n        if (selectedImageUrl != null) {\r\n            ZoomableImageDialog(\r\n                imageUrl = selectedImageUrl!!,\r\n                label = selectedImageLabel ?: \"\",\r\n                onDismiss = {\r\n                    selectedImageUrl = null\r\n                    selectedImageLabel = null\r\n                }\r\n            )\r\n        }\r\n    }\r\n}\r\n\r\n// \uD83D\uDD0D Diálogo de zoom\r\n@Composable\r\nprivate fun ZoomableImageDialog(imageUrl: String, label: String, onDismiss: () -> Unit) {\r\n    Dialog(\r\n        onDismissRequest = onDismiss,\r\n        properties = DialogProperties(usePlatformDefaultWidth = false, dismissOnClickOutside = true)\r\n    ) {\r\n        Box(\r\n            modifier = Modifier\r\n                .fillMaxSize()\r\n                .background(Color.Black.copy(alpha = 0.95f))\r\n        ) {\r\n            AndroidView(\r\n                factory = { context ->\r\n                    PhotoView(context).apply {\r\n                        load(imageUrl) { crossfade(true) }\r\n                    }\r\n                },\r\n                modifier = Modifier.fillMaxSize()\r\n            )\r\n\r\n            // \uD83D\uDD39 Etiqueta abajo a la izquierda\r\n            Text(\r\n                text = label,\r\n                color = Color.White,\r\n                fontSize = 16.sp,\r\n                fontWeight = FontWeight.Medium,\r\n                modifier = Modifier\r\n                    .align(Alignment.BottomStart)\r\n                    .background(Color.Black.copy(alpha = 0.7f))\r\n                    .padding(horizontal = 12.dp, vertical = 8.dp)\r\n            )\r\n\r\n            // ❌ Botón cerrar\r\n            IconButton(\r\n                onClick = onDismiss,\r\n                modifier = Modifier\r\n                    .align(Alignment.TopEnd)\r\n                    .statusBarsPadding()\r\n                    .padding(16.dp)\r\n                    .background(Color.Black.copy(alpha = 0.5f), CircleShape)\r\n            ) {\r\n                Icon(\r\n                    painter = painterResource(id = R.drawable.arrow_back),\r\n                    contentDescription = stringResource(R.string.close),\r\n                    tint = Color.White\r\n                )\r\n            }\r\n        }\r\n    }\r\n}\r\n
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/app/src/main/java/com/nextapp/monasterio/ui/virtualvisit/screens/PinDetalleScreen.kt b/app/src/main/java/com/nextapp/monasterio/ui/virtualvisit/screens/PinDetalleScreen.kt
--- a/app/src/main/java/com/nextapp/monasterio/ui/virtualvisit/screens/PinDetalleScreen.kt	(revision f2590b6482faf9e9b826aeb8a231cc260554145f)
+++ b/app/src/main/java/com/nextapp/monasterio/ui/virtualvisit/screens/PinDetalleScreen.kt	(date 1763021461028)
@@ -34,6 +34,7 @@
 import androidx.compose.ui.platform.LocalConfiguration
 import androidx.compose.ui.res.stringResource
 import com.nextapp.monasterio.models.Ubicacion
+import com.nextapp.monasterio.ui.theme.MonasteryRed
 import java.util.Locale
 
 @OptIn(ExperimentalFoundationApi::class)
@@ -124,7 +125,7 @@
                 },
                 fontSize = 26.sp,
                 fontWeight = FontWeight.Bold,
-                color = Color.Black,
+                color = MonasteryRed,
                 textAlign = TextAlign.Center,
                 modifier = Modifier.fillMaxWidth()
             )
@@ -138,7 +139,7 @@
                         .fillMaxWidth()
                         .height(250.dp)
                         .clip(RoundedCornerShape(16.dp))
-                        .border(3.dp, Color.Black, RoundedCornerShape(16.dp))
+                        .border(3.dp, MonasteryRed, RoundedCornerShape(16.dp))
                 ) {
                     HorizontalPager(state = pagerState) { page ->
                         val imagen = imagenes[page]
@@ -180,6 +181,10 @@
                                 Modifier
                                     .padding(3.dp)
                                     .size(if (selected) 8.dp else 6.dp)
+                                    .background(
+                                        MonasteryRed,
+                                        shape = CircleShape
+                                    )
                                     .background(Color.White.copy(alpha = if (selected) 1f else 0.6f), shape = CircleShape)
                             )
                         }
@@ -228,7 +233,7 @@
                     modifier = Modifier
                         .fillMaxWidth()
                         .height(56.dp),
-                    colors = ButtonDefaults.buttonColors(containerColor = Color.Black),
+                    colors = ButtonDefaults.buttonColors(containerColor = MonasteryRed),
                     shape = RoundedCornerShape(12.dp)
                 ) {
                     Text(
@@ -266,6 +271,9 @@
             modifier = Modifier
                 .fillMaxSize()
                 .background(Color.Black.copy(alpha = 0.95f))
+                .background(MonasteryRed.copy(alpha = 0.85f))
+                .clickable(onClick = onDismiss), // Permite cerrar pulsando el fondo
+            contentAlignment = Alignment.Center
         ) {
             AndroidView(
                 factory = { context ->
