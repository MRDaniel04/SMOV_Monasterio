Index: app/src/main/java/com/nextapp/monasterio/MainActivity.kt
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>package com.nextapp.monasterio\r\n\r\nimport android.R.attr.text\r\nimport android.app.Activity\r\nimport android.os.Bundle\r\nimport android.widget.Toast\r\nimport androidx.activity.compose.setContent\r\nimport androidx.appcompat.app.AppCompatActivity\r\nimport androidx.appcompat.app.AppCompatDelegate\r\nimport androidx.compose.foundation.Image\r\nimport androidx.compose.foundation.border\r\nimport androidx.compose.foundation.layout.*\r\nimport androidx.compose.foundation.shape.RoundedCornerShape\r\nimport androidx.compose.material3.*\r\nimport androidx.compose.runtime.*\r\nimport androidx.compose.ui.Alignment\r\nimport androidx.compose.ui.Modifier\r\nimport androidx.compose.ui.platform.LocalContext\r\nimport androidx.compose.ui.res.painterResource\r\nimport androidx.compose.ui.res.stringResource\r\nimport androidx.navigation.compose.rememberNavController\r\nimport com.nextapp.monasterio.ui.navigation.AppDrawerContent\r\nimport com.nextapp.monasterio.ui.navigation.AppNavigationHost\r\nimport com.nextapp.monasterio.ui.theme.*\r\nimport kotlinx.coroutines.launch\r\nimport androidx.compose.ui.draw.clip\r\nimport androidx.compose.ui.graphics.Color\r\nimport androidx.compose.ui.layout.ContentScale\r\nimport androidx.compose.ui.platform.LocalConfiguration\r\nimport androidx.compose.ui.platform.LocalDensity\r\nimport androidx.compose.ui.unit.Density\r\nimport androidx.compose.ui.unit.dp\r\nimport androidx.lifecycle.viewmodel.compose.viewModel\r\nimport androidx.navigation.compose.currentBackStackEntryAsState\r\nimport com.nextapp.monasterio.utils.FontSize\r\nimport com.nextapp.monasterio.viewModels.AuthViewModel\r\n\r\n\r\nclass MainActivity : AppCompatActivity() {\r\n    override fun onCreate(savedInstanceState: Bundle?) {\r\n        AppCompatDelegate.setDefaultNightMode(AppCompatDelegate.MODE_NIGHT_NO)\r\n        super.onCreate(savedInstanceState)\r\n        LanguageHelper.loadLocale(this)\r\n\r\n        setContent {\r\n            // 1. Leemos el tamaño guardado\r\n            val appFontScale = FontSize.devolverFontScale(this)\r\n            val currentDensity = LocalDensity.current\r\n            val currentConfig = LocalConfiguration.current\r\n\r\n            // 2. Calculamos la nueva Densidad\r\n            val newDensity = Density(\r\n                density = currentDensity.density,\r\n                fontScale = appFontScale\r\n            )\r\n\r\n            // 3. Actualizamos la Configuración\r\n            val newConfiguration = android.content.res.Configuration(currentConfig).apply {\r\n                fontScale = appFontScale\r\n            }\r\n\r\n            // 4. Inyectamos AMBOS valores\r\n            CompositionLocalProvider(\r\n                LocalDensity provides newDensity,\r\n                LocalConfiguration provides newConfiguration\r\n            ) {\r\n                Smov_monasterioTheme {\r\n                    // \uD83D\uDC47 PASAMOS 'this' (la actividad)\r\n                    MonasteryAppScreen(activity = this@MainActivity)\r\n                }\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\n@OptIn(ExperimentalMaterial3Api::class)\r\n@Composable\r\nfun MonasteryAppScreen(activity: AppCompatActivity) { // \uD83D\uDC48 Recibimos la actividad\r\n    val context = LocalContext.current\r\n    val navController = rememberNavController()\r\n    val drawerState = rememberDrawerState(initialValue = DrawerValue.Closed)\r\n    val scope = rememberCoroutineScope()\r\n\r\n    // ViewModel Auth\r\n    val authViewModel: AuthViewModel = viewModel()\r\n    val currentUser by authViewModel.currentUser.collectAsState(initial = null)\r\n\r\n    // Estado global edición\r\n    var isEditing by remember { mutableStateOf(false) }\r\n\r\n    val currentTitle = remember { mutableStateOf(context.getString(R.string.title_inicio)) }\r\n\r\n    // Detectar ruta actual\r\n    val currentBackStackEntry by navController.currentBackStackEntryAsState()\r\n    val currentRoute = currentBackStackEntry?.destination?.route\r\n\r\n    val isPanorama = currentRoute?.startsWith(AppRoutes.PANORAMA) == true\r\n    val isVirtualVisit = currentRoute == AppRoutes.VIRTUAL_VISIT\r\n    val isPin360 = currentRoute?.startsWith(AppRoutes.PIN_360) == true\r\n    val isEdicion = currentRoute == AppRoutes.EDICION_PINES\r\n    val isEdicionFondo = currentRoute == AppRoutes.EDICION_FONDO_INICIO\r\n\r\n    val isImmersive = isPanorama || isVirtualVisit || isPin360 || isEdicion || isEdicionFondo\r\n\r\n    val gesturesEnabled = when(currentRoute){\r\n        AppRoutes.VIRTUAL_VISIT -> false\r\n        else -> true\r\n    }\r\n    LaunchedEffect(navController) {\r\n        navController.currentBackStackEntryFlow.collect { backStackEntry ->\r\n            val route = backStackEntry.destination.route\r\n            val routeBase = route?.split(\"/\")?.firstOrNull() ?: route\r\n\r\n            currentTitle.value = when (routeBase) { // <-- Usamos routeBase\r\n                AppRoutes.INFO -> context.getString(R.string.title_info_general)\r\n                AppRoutes.HISTORIA -> context.getString(R.string.title_history)\r\n                AppRoutes.GALERIA -> context.getString(R.string.title_gallery)\r\n                AppRoutes.PERFIL -> context.getString(R.string.title_profile)\r\n                AppRoutes.AJUSTES -> context.getString(R.string.title_settings)\r\n                AppRoutes.OPCIONES_RESERVA,\r\n                AppRoutes.RESERVA,\r\n                AppRoutes.CONFIRMACION_RESERVA -> context.getString(R.string.title_appointment)\r\n                AppRoutes.VIRTUAL_VISIT -> context.getString(R.string.title_monasterio)\r\n                AppRoutes.MODO_NINYOS -> context.getString(R.string.child_mode_view)\r\n                AppRoutes.VIDEO_NINYOS -> context.getString(R.string.video_view)\r\n                AppRoutes.JUEGO_NINYOS -> context.getString(R.string.game_view)\r\n                AppRoutes.MODO_EDICION -> context.getString(R.string.edit_mode)\r\n                AppRoutes.PIN_ENTRADA_MONASTERIO -> context.getString(R.string.title_entrada)\r\n                AppRoutes.JUEGO_PUZZLE -> context.getString(R.string.puzzle_screen)\r\n                AppRoutes.JUEGO_PAREJAS -> context.getString(R.string.memory_screen)\r\n                AppRoutes.PUZZLENIVEL1 -> context.getString(R.string.puzzle_screen)\r\n                AppRoutes.PUZZLENIVEL2 -> context.getString(R.string.puzzle_screen)\r\n                AppRoutes.PUZZLENIVEL3 -> context.getString(R.string.puzzle_screen)\r\n                AppRoutes.PUZZLENIVEL4 -> context.getString(R.string.puzzle_screen)\r\n                AppRoutes.PAREJASNIVEL1 -> context.getString(R.string.memory_screen)\r\n                AppRoutes.PAREJASNIVEL2 -> context.getString(R.string.memory_screen)\r\n                AppRoutes.PAREJASNIVEL3 -> context.getString(R.string.memory_screen)\r\n                AppRoutes.PAREJASNIVEL4 -> context.getString(R.string.memory_screen)\r\n                else -> context.getString(R.string.title_inicio)\r\n            }\r\n        }\r\n    }\r\n\r\n    ModalNavigationDrawer(\r\n        drawerState = drawerState,\r\n        drawerContent = {\r\n            AppDrawerContent(\r\n                navController = navController,\r\n                scope = scope,\r\n                drawerState = drawerState\r\n            )\r\n        },\r\n        gesturesEnabled = gesturesEnabled && !isImmersive\r\n    ) {\r\n        Scaffold(\r\n            topBar = {\r\n                if (!isImmersive) {\r\n                    CenterAlignedTopAppBar(\r\n                        title = { Text(currentTitle.value) },\r\n                        colors = TopAppBarDefaults.topAppBarColors(\r\n                            containerColor = MonasteryRed,\r\n                            titleContentColor = White,\r\n                            navigationIconContentColor = White,\r\n                            actionIconContentColor = White\r\n                        ),\r\n                        navigationIcon = {\r\n                            IconButton(onClick = {\r\n                                scope.launch {\r\n                                    if (drawerState.isClosed) drawerState.open() else drawerState.close()\r\n                                }\r\n                            }) {\r\n                                val iconRes = if (drawerState.isOpen) R.drawable.menu_close else R.drawable.ic_menu_24\r\n                                Icon(\r\n                                    painter = painterResource(id = iconRes),\r\n                                    contentDescription = stringResource(id = R.string.navigation_drawer_open)\r\n                                )\r\n                            }\r\n                        },\r\n                        actions = {\r\n                            // \uD83D\uDC47 1. SELECTOR DE IDIOMA LIMPIO\r\n                            MainLanguageSelector(activity)\r\n\r\n                            // Icono Editar\r\n                            if (currentUser != null) {\r\n                                IconButton(onClick = {\r\n                                    isEditing = !isEditing\r\n                                    val message = if (isEditing) context.getString(R.string.edit_mode_activate_message) else context.getString(R.string.edit_mode_deactivate_message)\r\n                                    Toast.makeText(context, message, Toast.LENGTH_SHORT).show()\r\n                                }) {\r\n                                    Icon(\r\n                                        painter = painterResource(id = R.drawable.lapiz),\r\n                                        contentDescription = if (isEditing) stringResource(id = R.string.edit_mode_deactivate_icon) else stringResource(id = R.string.edit_mode_activate_icon),\r\n                                        tint = White\r\n                                    )\r\n                                }\r\n                            }\r\n                        }\r\n                    )\r\n                }\r\n            }\r\n        ) { paddingValues ->\r\n            AppNavigationHost(\r\n                authViewModel = authViewModel,\r\n                navController = navController,\r\n                isEditing = isEditing,\r\n                modifier = Modifier.padding(paddingValues)\r\n            )\r\n        }\r\n    }\r\n}\r\n\r\n// --- COMPONENTES DE IDIOMA PARA LA BARRA ---\r\n\r\n@Composable\r\nfun MainLanguageSelector(activity: AppCompatActivity) {\r\n    var expanded by remember { mutableStateOf(false) }\r\n\r\n    // Obtenemos idioma actual\r\n    val currentLanguageCode = activity.resources.configuration.locales[0].language\r\n\r\n    // Determinamos bandera actual\r\n    val currentFlag = when (currentLanguageCode) {\r\n        \"de\" -> R.drawable.alemania\r\n        \"en\" -> R.drawable.reinounido\r\n        else -> R.drawable.espanya\r\n    }\r\n\r\n    Box {\r\n        // Botón de la bandera\r\n        IconButton(onClick = { expanded = true }) {\r\n            Image(\r\n                painter = painterResource(id = currentFlag),\r\n                contentDescription = \"Cambiar idioma\",\r\n                contentScale = ContentScale.Crop,\r\n                modifier = Modifier\r\n                    .size(28.dp)\r\n                    .clip(RoundedCornerShape(4.dp))\r\n                    .border(1.dp, Color.White.copy(alpha = 0.5f), RoundedCornerShape(4.dp))\r\n            )\r\n        }\r\n\r\n        // Menú desplegable\r\n        DropdownMenu(\r\n            expanded = expanded,\r\n            onDismissRequest = { expanded = false },\r\n            modifier = Modifier.width(150.dp)\r\n        ) {\r\n            MainLanguageItem(activity, \"es\", stringResource(R.string.lang_es), R.drawable.espanya) { expanded = false }\r\n            MainLanguageItem(activity, \"en\", stringResource(R.string.lang_en), R.drawable.reinounido) { expanded = false }\r\n            MainLanguageItem(activity, \"de\", stringResource(R.string.lang_de), R.drawable.alemania) { expanded = false }\r\n        }\r\n    }\r\n}\r\n\r\n@Composable\r\nfun MainLanguageItem(\r\n    activity: AppCompatActivity,\r\n    code: String,\r\n    name: String,\r\n    flagRes: Int,\r\n    onDismiss: () -> Unit\r\n) {\r\n    DropdownMenuItem(\r\n        text = {\r\n            Row(verticalAlignment = Alignment.CenterVertically) {\r\n                Image(\r\n                    painter = painterResource(id = flagRes),\r\n                    contentDescription = null,\r\n                    modifier = Modifier.size(24.dp).clip(RoundedCornerShape(2.dp))\r\n                )\r\n                Spacer(modifier = Modifier.width(12.dp))\r\n                Text(text = name, style = MaterialTheme.typography.bodyMedium)\r\n            }\r\n        },\r\n        onClick = {\r\n            onDismiss()\r\n            val currentLanguage = activity.resources.configuration.locales[0].language\r\n            if (currentLanguage != code) {\r\n                LanguageHelper.saveLocale(activity, code)\r\n                activity.recreate()\r\n            }\r\n        }\r\n    )\r\n}
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/app/src/main/java/com/nextapp/monasterio/MainActivity.kt b/app/src/main/java/com/nextapp/monasterio/MainActivity.kt
--- a/app/src/main/java/com/nextapp/monasterio/MainActivity.kt	(revision b563b49dc11c723564618e771e0193249d97dff7)
+++ b/app/src/main/java/com/nextapp/monasterio/MainActivity.kt	(date 1764252090069)
@@ -222,7 +222,9 @@
     val currentFlag = when (currentLanguageCode) {
         "de" -> R.drawable.alemania
         "en" -> R.drawable.reinounido
+        "fr" -> R.drawable.francia
         else -> R.drawable.espanya
+
     }
 
     Box {
@@ -248,6 +250,7 @@
             MainLanguageItem(activity, "es", stringResource(R.string.lang_es), R.drawable.espanya) { expanded = false }
             MainLanguageItem(activity, "en", stringResource(R.string.lang_en), R.drawable.reinounido) { expanded = false }
             MainLanguageItem(activity, "de", stringResource(R.string.lang_de), R.drawable.alemania) { expanded = false }
+            MainLanguageItem(activity, "fr", stringResource(R.string.lang_fr), R.drawable.francia) { expanded = false }
         }
     }
 }
Index: app/src/main/java/com/nextapp/monasterio/repository/PinRepository.kt
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>package com.nextapp.monasterio.repository\r\n\r\nimport android.util.Log\r\nimport com.google.firebase.firestore.DocumentReference\r\nimport com.google.firebase.firestore.FirebaseFirestore\r\nimport com.google.firebase.firestore.SetOptions\r\nimport com.nextapp.monasterio.models.*\r\nimport kotlinx.coroutines.tasks.await\r\n\r\nobject PinRepository {\r\n    private val firestore = FirebaseFirestore.getInstance()\r\n    private val collection = firestore.collection(\"pines\")\r\n\r\n    // -----------------------\r\n    // CREATE\r\n    // -----------------------\r\n    suspend fun createPinAutoId(pinPayload: Map<String, Any?>): String {\r\n        val docRef = collection.add(pinPayload).await()\r\n        val generatedId = docRef.id\r\n        docRef.set(mapOf(\"id\" to generatedId), SetOptions.merge()).await()\r\n        return generatedId\r\n    }\r\n\r\n    suspend fun createPin(pin: PinData): String {\r\n        val payload = mapOf(\r\n            \"titulo\" to pin.titulo,\r\n            \"ubicacion\" to pin.ubicacion?.name,\r\n            \"x\" to pin.x.toDouble(),\r\n            \"y\" to pin.y.toDouble(),\r\n            \"tema\" to pin.tema?.name,\r\n            \"imagenes\" to pin.imagenes,\r\n            \"descripcion\" to pin.descripcion,\r\n            \"tapRadius\" to pin.tapRadius.toDouble(),\r\n            \"vista360Url\" to pin.vista360Url,\r\n            \"audioUrl_es\" to pin.audioUrl_es,\r\n            \"audioUrl_en\" to pin.audioUrl_en,\r\n            \"audioUrl_ge\" to pin.audioUrl_ge\r\n        )\r\n        return createPinAutoId(payload)\r\n    }\r\n\r\n    // -----------------------\r\n// CREATE desde formulario (EdicionPines)\r\n// -----------------------\r\n    suspend fun createPinFromForm(\r\n        titulo: String,\r\n        descripcion: String,\r\n        imagenes: List<String>,\r\n        imagenes360: List<String>,\r\n        ubicacion: String,\r\n        x: Float,\r\n        y: Float\r\n    ): String {\r\n\r\n        val payload = mapOf(\r\n            \"titulo\" to titulo,\r\n            \"tituloIngles\" to \"\",\r\n            \"tituloAleman\" to \"\",\r\n\r\n            \"descripcion\" to descripcion,\r\n            \"descripcionIngles\" to \"\",\r\n            \"descripcionAleman\" to \"\",\r\n\r\n            \"ubicacion\" to ubicacion,\r\n            \"ubicacionIngles\" to ubicacion,\r\n            \"ubicacionAleman\" to ubicacion,\r\n\r\n            \"x\" to x.toDouble(),\r\n            \"y\" to y.toDouble(),\r\n\r\n            // Imágenes: convertimos a referencias de Firestore\r\n            \"imagenes\" to imagenes.map {\r\n                firestore.collection(\"imagenes\").document().path\r\n            },\r\n\r\n            // Por ahora guardamos solo como URL (si Cloudinary ya devuelve URL)\r\n            \"vista360Url\" to imagenes360.firstOrNull(),\r\n\r\n            \"tipoDestino\" to \"detalle\",\r\n            \"valorDestino\" to \"pin_detalle\"\r\n        )\r\n\r\n        return createPinAutoId(payload)\r\n    }\r\n\r\n\r\n    // -----------------------\r\n    // READ: todos los pines\r\n    // -----------------------\r\n    suspend fun getAllPins(): List<PinData> {\r\n        val snapshot = collection.get().await()\r\n        Log.d(\"PinRepository\", \"\uD83D\uDCE6 getAllPins() → ${snapshot.size()} documentos\")\r\n        return snapshot.documents.mapNotNull { doc ->\r\n            mapDocToPinData(doc.id, doc.data)\r\n        }\r\n    }\r\n\r\n    // -----------------------\r\n    // READ: pin individual\r\n    // -----------------------\r\n    suspend fun getPinById(id: String): PinData? {\r\n        Log.d(\"PinRepository\", \"\uD83D\uDD0D getPinById($id)\")\r\n        val doc = collection.document(id).get().await()\r\n\r\n        if (!doc.exists()) {\r\n            Log.e(\"PinRepository\", \"❌ Documento de pin no encontrado: $id\")\r\n            return null\r\n        }\r\n\r\n        val data = doc.data\r\n        Log.d(\"PinRepository\", \"\uD83D\uDCC4 Datos del pin recuperados: ${data?.keys}\")\r\n\r\n        val basePin = mapDocToPinData(doc.id, data)\r\n        if (basePin == null) {\r\n            Log.e(\"PinRepository\", \"❌ Fallo al mapear el pin $id\")\r\n            return null\r\n        }\r\n\r\n        if (basePin.imagenes.isEmpty()) {\r\n            Log.w(\"PinRepository\", \"⚠\uFE0F El pin $id no tiene referencias de imágenes\")\r\n        } else {\r\n            Log.d(\"PinRepository\", \"\uD83D\uDD17 Referencias detectadas: ${basePin.imagenes}\")\r\n        }\r\n\r\n        val imagenesDetalladas = mutableListOf<ImagenData>()\r\n\r\n        for (ref in basePin.imagenes) {\r\n            try {\r\n                val imageId = ref.substringAfterLast(\"/\")\r\n                val imageDoc = firestore.collection(\"imagenes\").document(imageId).get().await()\r\n                if (imageDoc.exists()) {\r\n                    val url = imageDoc.getString(\"url\") ?: \"\"\r\n                    val etiqueta = imageDoc.getString(\"etiqueta\") ?: \"\"\r\n                    val titulo = imageDoc.getString(\"titulo\") ?: \"\"\r\n                    val tituloIngles = imageDoc.getString(\"tituloIngles\") ?: \"\"\r\n                    val tituloAleman = imageDoc.getString(\"tituloAleman\") ?: \"\"\r\n\r\n                    Log.d(\r\n                        \"PinRepository\",\r\n                        \"✅ Imagen encontrada '$imageId' → etiqueta='$etiqueta', titulo='$titulo', url='$url'\"\r\n                    )\r\n\r\n                    if (url.isNotBlank()) {\r\n                        imagenesDetalladas.add(\r\n                            ImagenData(\r\n                                id = imageId,\r\n                                url = url,\r\n                                etiqueta = etiqueta,\r\n                                titulo = titulo,\r\n                                tituloIngles = tituloIngles,\r\n                                tituloAleman = tituloAleman\r\n                            )\r\n                        )\r\n                    }\r\n                } else {\r\n                    Log.w(\"PinRepository\", \"⚠\uFE0F Documento no encontrado en /imagenes/: $imageId\")\r\n                }\r\n            } catch (e: Exception) {\r\n                Log.e(\"PinRepository\", \"❌ Error al obtener imagen referenciada para $ref\", e)\r\n            }\r\n        }\r\n\r\n        return basePin.copy(imagenesDetalladas = imagenesDetalladas)\r\n    }\r\n\r\n    suspend fun deletePin(pinId: String): Boolean {\r\n        return try {\r\n            collection.document(pinId)\r\n                .delete()\r\n                .await()\r\n            Log.d(\"PinRepository\", \"✅ Pin '$pinId' eliminado correctamente.\")\r\n            true\r\n        } catch (e: Exception) {\r\n            Log.e(\"PinRepository\", \"❌ Error al eliminar el pin '$pinId'\", e)\r\n            false\r\n        }\r\n    }\r\n\r\n    suspend fun updatePinPosition(pinId: String, newX: Float, newY: Float) {\r\n        val payload = mapOf(\r\n            \"x\" to newX.toDouble(), // Firebase usa Double para números\r\n            \"y\" to newY.toDouble()\r\n        )\r\n        try {\r\n            collection.document(pinId)\r\n                .update(payload)\r\n                .await()\r\n\r\n        } catch (e: Exception) {\r\n\r\n            throw e // Propagar el error para manejo en la UI\r\n        }\r\n    }\r\n\r\n    // -----------------------\r\n    // Helper: mapear doc -> PinData\r\n    // -----------------------\r\n    private fun mapDocToPinData(docId: String, data: Map<String, Any>?): PinData? {\r\n        if (data == null) return null\r\n\r\n        return try {\r\n            val titulo = data[\"titulo\"] as? String ?: \"\"\r\n            val tituloIngles = data[\"tituloIngles\"] as? String ?: \"\"\r\n            val tituloAleman = data[\"tituloAleman\"] as? String ?: \"\"\r\n\r\n            val ubicacion = (data[\"ubicacion\"] as? String)?.let { safeUbicacionOf(it) }\r\n            val ubicacionIngles = (data[\"ubicacionIngles\"] as? String)?.let { safeUbicacionOf(it) }\r\n            val ubicacionAleman = (data[\"ubicacionAleman\"] as? String)?.let { safeUbicacionOf(it) }\r\n\r\n            val x = (data[\"x\"] as? Number)?.toFloat() ?: 0f\r\n            val y = (data[\"y\"] as? Number)?.toFloat() ?: 0f\r\n            val temaStr = data[\"tema\"] as? String\r\n            val tema = temaStr?.let { safeTemaOf(it) } ?: Tema.PINTURA_Y_ARTE_VISUAL\r\n\r\n            // \uD83E\uDDE9 Referencias de imágenes\r\n            val imagenes: List<String> = when (val raw = data[\"imagenes\"]) {\r\n                is List<*> -> raw.mapNotNull {\r\n                    when (it) {\r\n                        is String -> it\r\n                        is DocumentReference -> it.path\r\n                        else -> null\r\n                    }\r\n                }\r\n                else -> emptyList()\r\n            }\r\n\r\n            val descripcion = data[\"descripcion\"] as? String\r\n            val descripcionIngles = data[\"descripcionIngles\"] as? String\r\n            val descripcionAleman = data[\"descripcionAleman\"] as? String\r\n            val tapRadius = (data[\"tapRadius\"] as? Number)?.toFloat() ?: 0.04f\r\n            val vista360Url = data[\"vista360Url\"] as? String\r\n\r\n            val audioUrl_es = data[\"audioUrl_es\"] as? String\r\n            val audioUrl_en = data[\"audioUrl_en\"] as? String\r\n            val audioUrl_ge = data[\"audioUrl_ge\"] as? String\r\n\r\n            // \uD83D\uDD39 NUEVO: leer los campos de destino\r\n            val tipoDestino = data[\"tipoDestino\"] as? String\r\n            val valorDestino = data[\"valorDestino\"] as? String\r\n\r\n            // \uD83D\uDD39 Crear el destino dinámicamente\r\n            val destino = when (tipoDestino?.lowercase()) {\r\n                \"ruta\" -> DestinoPin.Ruta(valorDestino ?: \"\")\r\n                \"detalle\" -> DestinoPin.Detalle(valorDestino ?: docId)\r\n                \"popup\" -> DestinoPin.Popup(valorDestino ?: \"Sin mensaje\")\r\n                else -> DestinoPin.Detalle(docId)\r\n            }\r\n\r\n            Log.d(\"PinRepository\", \"\uD83D\uDCCD Mapeando pin '$titulo' ($docId) → tipoDestino=$tipoDestino, valor=$valorDestino\")\r\n\r\n            PinData(\r\n                id = docId,\r\n                titulo = titulo,\r\n                tituloIngles = tituloIngles,\r\n                tituloAleman = tituloAleman,\r\n                ubicacion = ubicacion,\r\n                ubicacionIngles = ubicacionIngles,\r\n                ubicacionAleman = ubicacionAleman,\r\n                x = x,\r\n                y = y,\r\n                tema = tema,\r\n                color = null,\r\n                iconRes = null,\r\n                imagenes = imagenes,\r\n                imagenesDetalladas = emptyList(),\r\n                descripcion = descripcion,\r\n                descripcionIngles = descripcionIngles,\r\n                descripcionAleman = descripcionAleman,\r\n                tipoDestino = tipoDestino,\r\n                valorDestino = valorDestino,\r\n                destino = destino,\r\n                tapRadius = tapRadius,\r\n                vista360Url = vista360Url,\r\n                audioUrl_es = audioUrl_es,\r\n                audioUrl_en = audioUrl_en,\r\n                audioUrl_ge = audioUrl_ge\r\n            )\r\n        } catch (e: Exception) {\r\n            Log.e(\"PinRepository\", \"❌ Error mapeando pin $docId\", e)\r\n            null\r\n        }\r\n    }\r\n\r\n\r\n    private fun safeTemaOf(name: String): Tema {\r\n        return try {\r\n            Tema.valueOf(name)\r\n        } catch (_: Exception) {\r\n            Tema.PINTURA_Y_ARTE_VISUAL\r\n        }\r\n    }\r\n\r\n    private fun safeUbicacionOf(name: String): Ubicacion? {\r\n        return try {\r\n            Ubicacion.valueOf(name)\r\n        } catch (_: Exception) {\r\n            null\r\n        }\r\n    }\r\n}\r\n
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/app/src/main/java/com/nextapp/monasterio/repository/PinRepository.kt b/app/src/main/java/com/nextapp/monasterio/repository/PinRepository.kt
--- a/app/src/main/java/com/nextapp/monasterio/repository/PinRepository.kt	(revision b563b49dc11c723564618e771e0193249d97dff7)
+++ b/app/src/main/java/com/nextapp/monasterio/repository/PinRepository.kt	(date 1764252090079)
@@ -134,6 +134,7 @@
                     val titulo = imageDoc.getString("titulo") ?: ""
                     val tituloIngles = imageDoc.getString("tituloIngles") ?: ""
                     val tituloAleman = imageDoc.getString("tituloAleman") ?: ""
+                    val foco = imageDoc.getString("foco") ?: ""
 
                     Log.d(
                         "PinRepository",
@@ -148,7 +149,8 @@
                                 etiqueta = etiqueta,
                                 titulo = titulo,
                                 tituloIngles = tituloIngles,
-                                tituloAleman = tituloAleman
+                                tituloAleman = tituloAleman,
+                                foco = foco,
                             )
                         )
                     }
Index: app/src/main/res/values/strings.xml
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+><resources>\r\n    <string name=\"app_name\">Santa María la Real de Huelgas</string>\r\n    <string name=\"title_inicio\">Inicio</string>\r\n    <string name=\"virtual_visit\">VISITA VIRTUAL</string>\r\n    <string name=\"book_appointment\">RESERVA CITA</string>\r\n    <string name=\"monastery_name\">Santa María\\nla Real de Huelgas</string>\r\n    <string name=\"edit_mode_activate_icon\">Modo edición</string>\r\n    <string name=\"edit_mode_deactivate_icon\">Salir del modo edición</string>\r\n    <string name=\"edit_mode_activate_message\">Modo edición activado</string>\r\n    <string name=\"edit_mode_deactivate_message\">Modo edición desactivado</string>\r\n    <string name=\"edit_save_changes\">Guardar cambios</string>\r\n    <string name=\"profile_login\">Iniciar Sesión</string>\r\n    <string name=\"profile_logout\">Cerrar Sesión</string>\r\n    <string name=\"profile_email\">Correo Electrónico</string>\r\n    <string name=\"profile_password\">Contraseña</string>\r\n    <string name=\"navigation_drawer_open\">Abrir menú</string>\r\n    <string name=\"navigation_drawer_close\">Cerrar menú</string>\r\n    <string name=\"menu_info\">Información monasterio</string>\r\n    <string name=\"menu_history\">Historia</string>\r\n    <string name=\"menu_gallery\">Galería</string>\r\n    <string name=\"menu_profile\">Perfil</string>\r\n    <string name=\"menu_settings\">Ajustes</string>\r\n    <string name=\"title_info_general\">Información General</string>\r\n    <string name=\"title_history\">Historia</string>\r\n    <string name=\"title_gallery\">Galería</string>\r\n    <string name=\"title_profile\">Perfil</string>\r\n    <string name=\"title_settings\">Ajustes</string>\r\n    <string name=\"info_location\">C/…</string>\r\n    <string name=\"info_hours\">C/XX:XX - YY:YY</string>\r\n    <string name=\"general_info\">Información general:</string>\r\n    <string name=\"history_1328\">1328 \uD83D\uDD25 Incendio y reconstrucción</string>\r\n    <string name=\"history_1328_body\">Durante un incendio en Valladolid provocado por tropas de Alfonso XI, el monasterio en los palacios de la Magdalena quedó gravemente dañado. Las monjas comenzaron su reconstrucción gracias a la ayuda económica de Álvaro Nuño Pérez de Monroy.</string>\r\n    <string name=\"history_1579\">1579 \uD83C\uDFF0 Reconstrucción de la iglesia y el claustro</string>\r\n    <string name=\"history_579_body\">Las monjas levantaron la iglesia siguiendo el diseño del maestro italiano Pietro Palladio. El retablo fue obra de Gregorio Fernández y el nuevo claustro, de Francisco de Praves. Todo esto se hizo posible gracias a las donaciones de las abadesas Ana e Isabel de Mendoza.</string>\r\n    <string name=\"history_1869\">1869 \uD83C\uDF93 Nace la escuela del monasterio</string>\r\n    <string name=\"history_1869_body\">La comunidad de las Huelgas Reales abrió su propia escuela, acogiendo a niñas de la nobleza vallisoletana como medio pensionistas.</string>\r\n    <string name=\"history_XX\">Siglo XX-XXI ✨ Restauración y vida moderna</string>\r\n    <string name=\"history_XX_body\">El monasterio fue totalmente restaurado. La disminución de vocaciones impulsó la creación de la Hermandad Laica Cisterciense, que mantiene vivo el espíritu de la Regla de San Benito.</string>\r\n    <string name=\"history_2007\">2007 en adelante \uD83D\uDC69\u200D\uD83E\uDDB3 Liderazgo y Congregación femenina</string>\r\n    <string name=\"history_2007_body\">El monasterio forma parte de la Congregación de Castilla de la Orden del Cister, activa como congregación femenina desde 2007. La primera abadesa presidenta fue María del Mar Martínez; tras su fallecimiento en 2013, Sor Isabel Vallés Gallego asumió el cargo. Actualmente, Sor María dirige el monasterio y el colegio.</string>\r\n    <string name=\"title_appointment\">Reservar Cita</string>\r\n    <string name=\"option_phone_appointment\">Reservar por teléfono</string>\r\n    <string name=\"option_online_appointment\">Reservar online</string>\r\n    <string name=\"name_appointment\">Nombre y apellidos</string>\r\n    <string name=\"email_appointment\">Correo electrónico</string>\r\n    <string name=\"date_appointment\">Fecha</string>\r\n    <string name=\"hour_appointment\">Hora</string>\r\n    <string name=\"placeholdername_appointment\">Introduce tu nombre y apellidos</string>\r\n    <string name=\"placeholderemail_appointment\">Introduce tu correo electrónico</string>\r\n    <string name=\"placeholderdate_appointment\">Selecciona una fecha</string>\r\n    <string name=\"placeholderhour_appointment\">Selecciona una hora</string>\r\n    <string name=\"compulsory_name\">El nombre es obligatorio</string>\r\n    <string name=\"valid_name\">El nombre contiene algún simbolo no válido</string>\r\n    <string name=\"compulsory_email\">El email es obligatorio</string>\r\n    <string name=\"valid_email\">El formato del email no es válido</string>\r\n    <string name=\"date_no_selected\">Se debe seleccionar una fecha</string>\r\n    <string name=\"hour_no_selected\">Se debe seleccionar una hora</string>\r\n    <string name=\"datepicker_ok\">Ok</string>\r\n    <string name=\"datepicker_cancel\">Cancelar</string>\r\n    <string name=\"confirm_button\">CONFIRMAR</string>\r\n    <string name=\"contentimage_confirmation\">Confirmado</string>\r\n    <string name=\"confirmation_appointment\">¡CASI LISTO!</string>\r\n    <string name=\"details_appointment\">Tu solicitud de reserva está preparada. Por favor, pulsa \\'enviar\\' en la aplicación de correo que se acaba de abrir para finalizar tu solicitud. Te responderemos a ese correo para confirmar la disponibilidad.</string>\r\n    <string name=\"email_subject\">Solicitud de Reserva de Vista - %1$s</string>\r\n    <string name=\"email_message\">Hola,\\n\\nMe gustaría solicitar una reserva para una visita al monasterio con los siguientes datos:\\n\\n* Nombre: %1$s\\n* Email: %2$s\\n* Fecha de la visita: %3$s\\n* Hora de la visita: %4$s\\n\\nQuedo a la espera de su amable confirmación.\\n\\nMuchas gracias,\\nAtentamente,\\n\\n%1$s</string>\r\n    <string name=\"email_error\">No se encontró ninguna app de correo</string>\r\n    <string name=\"history_content_placeholder\">Mauris vel nisi id metus vestibulum vehicula nec ac orci. Curabitur massa diam, fermentum sit amet augue sit, volutpat efficitur enim. Phasellus a cursus orci, id laoreet dolor. Class aptent taciti sociosqu ad litora torquent per conubia nostra, per inceptos himenaeos.</string>\r\n    <string name=\"language_select\">Seleccionar Idioma</string>\r\n    <string name=\"font_size_select\">Selecciona el tamaño de la letra</string>\r\n    <string name=\"font_extrabig\">Extra Grande</string>\r\n    <string name=\"font_normal\">Mediana</string>\r\n    <string name=\"font_big\">Grande</string>\r\n    <string name=\"title_monasterio\">Monasterio</string>\r\n    <string name=\"title_entrada\">Entrada Monasterio</string>\r\n    <string name=\"spanish_language\">Español</string>\r\n    <string name=\"german_language\">Alemán</string>\r\n    <string name=\"english_language\">Inglés</string>\r\n    <string name=\"navegation_button\">Ocultar botones de navegación</string>\r\n    <string name=\"close\">Cerrar</string>\r\n    <string name=\"go_back\">Volver</string>\r\n    <string name=\"see_360\">Ver 360º</string>\r\n    <string name=\"contentdescription_image_pin\">Imagen del pin (pulsar para ampliar)</string>\r\n    <string name=\"readjust\">Reajustar</string>\r\n    <string name=\"decrease\">Disminuir</string>\r\n    <string name=\"increase\">Aumentar</string>\r\n    <string name=\"out_interactive_area\">Fuera del área interactiva</string>\r\n    <string name=\"notdefined_destiny\">Destino no definido</string>\r\n    <string name=\"notdefined_destinyplane\">Plano destino no definido</string>\r\n    <string name=\"plane_loading\">Cargando plano...</string>\r\n    <string name=\"error_loading_plane\">Error cargando datos del plano</string>\r\n    <string name=\"child_mode\">MODO NIÑOS</string>\r\n    <string name=\"child_mode_view\">Modo Niños</string>\r\n    <string name=\"video_view\">Video</string>\r\n    <string name=\"game_view\">Juegos</string>\r\n    <string name=\"video_child\">VIDEO</string>\r\n    <string name=\"game_child\">JUEGOS</string>\r\n    <string name=\"edit_mode\">MODO EDICIÓN</string>\r\n    <string name=\"edit_home_background\">Edición fondo inicio</string>\r\n    <string name=\"edit_pins\">Edición pines</string>\r\n    <string name=\"location_error\">No se encontró una app para abrir la ubicación.</string>\r\n    <string name=\"contact_data\">Datos de contacto</string>\r\n    <string name=\"location_data\">Ubicación</string>\r\n    <string name=\"email_data\">Correo electrónico</string>\r\n    <string name=\"phone_data\">Teléfono</string>\r\n    <string name=\"visit_schedule\">Horarios de Visita</string>\r\n    <string name=\"monday_to_friday\">Lunes a Viernes:</string>\r\n    <string name=\"four_pieces\">4 piezas</string>\r\n    <string name=\"nine_pieces\">9 piezas</string>\r\n    <string name=\"sixteen_pieces\">16 piezas</string>\r\n    <string name=\"twentyfive_pieces\">25 piezas</string>\r\n    <string name=\"three_pairs\">3 Parejas</string>\r\n    <string name=\"four_pairs\">4 Parejas</string>\r\n    <string name=\"five_pairs\">5 parejas</string>\r\n    <string name=\"six_pairs\">6 Parejas</string>\r\n    <string name=\"dont_show_again\">No volver a mostrar</string>\r\n    <string name=\"understand\">Entendido</string>\r\n    <string name=\"map_tutorial_body\">Este es el cuerpo del tutorial</string>\r\n    <string name=\"map_tutorial_title\">Este es el titulo del tutorial</string>\r\n    <string name=\"map_tutorial_body2\">Este es el cuerpo del tutorial del mapa 2</string>\r\n    <string name=\"map_tutorial_title2\">Este es el titulo del tutorial del mapa 2</string>\r\n    <string name=\"pin_tutorial_body\">Este es el cuerpo del tutorial del pin</string>\r\n    <string name=\"pineºº_tutorial_title\">Este es el titulo del tutorial del pin</string>\r\n    <string name=\"next\">Siguiente</string>\r\n    <string name=\"map_tutorial_body1\">En la parte superior izquierda, el símbolo (←) permite volver al inicio</string>\r\n    <string name=\"map_tutorial_body1_2\">Tocando en las zonas con color del mapa podemos entrar a las distintas partes visualizables</string>\r\n    <string name=\"map_tutorial_body1_3\">Además, los botones de la parte derecha te permiten ampliar el mapa, reducirlo o volver a su tamaño   original</string>\r\n    <string name=\"submapa_1\">Tocando en el símbolo (←) podemos volver al mapa general</string>\r\n    <string name=\"submapa_2\">Tocando en los distintos pines podemos entrar a los puntos de interés</string>\r\n    <string name=\"pin_1\">Pulsando en el símbolo (←), se puede volver al mapa</string>\r\n    <string name=\"pin_2\">Puedes desplazarte por las imágenes o pulsar en ellas para ampliarlas</string>\r\n    <string name=\"pin_3\">Pulsando aquí puedes escuchar el audio del texto</string>\r\n    <string name=\"pin_4\">Para acceder a la vista 360 pulse este botón</string>\r\n    <string name=\"confirm_save_title\">¿Guardar cambios?</string>\r\n    <string name=\"confirm_save_message\">¿Estás seguro de que quieres guardar los cambios realizados?</string>\r\n    <string name=\"confirm_save_button\">Guardar</string>\r\n    <string name=\"confirm_cancel_button\">Cancelar</string>\r\n    <string name=\"edit_cancel_changes\">Cancelar</string>\r\n    <string name=\"profile_name\">Nombre</string>\r\n    <string name=\"image_add\">Añadir imagen</string>\r\n    <string name=\"image_delete\">Borrar</string>\r\n    <string name=\"image_delete_confirm_title\">¿Borrar imagen?</string>\r\n    <string name=\"image_delete_confirm_message\">¿Seguro que quieres borrar la imagen?</string>\r\n    <string name=\"image_uploading\">Subiendo imagen...</string>\r\n    <string name=\"image_upload_success\">Imagen subida correctamente</string>\r\n    <string name=\"image_upload_error\">Error al subir la imagen</string>\r\n    <string name=\"image_select_error\">Error al cargar la imagen</string>\r\n    <string name=\"congratulations\">¡Felicidades!</string>\r\n    <string name=\"message_game_completed\">¡Has resuelto el juego! ¿Listo para el siguiente desafío?</string>\r\n    <string name=\"ready\">Listo</string>\r\n    <string name=\"original_image\">Ver imagen</string>\r\n    <string name=\"image_gallery_title\">Imágenes</string>\r\n    <string name=\"visible\">Visibles</string>\r\n    <string name=\"hidden\">Ocultos</string>\r\n    <string name=\"lang_en\">Engish</string>\r\n    <string name=\"lang_es\">Español</string>\r\n    <string name=\"sample_text\">Ejemplo</string>\r\n    <string name=\"lang_de\">Deutsch</string>\r\n    <string name=\"font_small\">Pequeña</string>\r\n    <string name=\"font_medium\">Mediana</string>\r\n    <string name=\"font_large\">Grande</string>\r\n    <string name=\"puzzle_screen\">Puzle</string>\r\n    <string name=\"puzzle_option\">PUZLE</string>\r\n    <string name=\"memory_screen\">Parejas</string>\r\n    <string name=\"memory_option\">PAREJAS</string>\r\n    <string name=\"back_piece\">Parte de atrás de la pieza</string>\r\n    <string name=\"left_pairs\">Parejas restantes: %1$s</string>\r\n    <string name=\"left_pieces\">Piezas restantes: %1$s</string>\r\n\r\n    <string name=\"play_audio\"></string>\r\n</resources>
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/app/src/main/res/values/strings.xml b/app/src/main/res/values/strings.xml
--- a/app/src/main/res/values/strings.xml	(revision b563b49dc11c723564618e771e0193249d97dff7)
+++ b/app/src/main/res/values/strings.xml	(date 1764252090118)
@@ -1,3 +1,4 @@
+<?xml version="1.0" encoding="utf-8"?>
 <resources>
     <string name="app_name">Santa María la Real de Huelgas</string>
     <string name="title_inicio">Inicio</string>
@@ -151,10 +152,11 @@
     <string name="image_gallery_title">Imágenes</string>
     <string name="visible">Visibles</string>
     <string name="hidden">Ocultos</string>
-    <string name="lang_en">Engish</string>
+    <string name="lang_en">English</string>
     <string name="lang_es">Español</string>
     <string name="sample_text">Ejemplo</string>
     <string name="lang_de">Deutsch</string>
+    <string name="lang_fr">Français</string>
     <string name="font_small">Pequeña</string>
     <string name="font_medium">Mediana</string>
     <string name="font_large">Grande</string>
Index: app/src/main/res/values-en/strings.xml
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+><?xml version=\"1.0\" encoding=\"utf-8\"?>\r\n<resources>\r\n    <string name=\"app_name\">Museum360</string>\r\n    <string name=\"title_inicio\">Home</string>\r\n    <string name=\"virtual_visit\">VIRTUAL VISIT</string>\r\n    <string name=\"book_appointment\">BOOK APPOINTMENT</string>\r\n    <string name=\"monastery_name\">Santa María\\nla Real de Huelgas</string>\r\n    <string name=\"edit_mode_activate_icon\">Editor mode</string>\r\n    <string name=\"edit_mode_deactivate_icon\">Exit from editor mode</string>\r\n    <string name=\"edit_mode_activate_message\">Editor mode activated</string>\r\n    <string name=\"edit_mode_deactivate_message\">Editor mode deactivated</string>\r\n    <string name=\"edit_save_changes\">Save changes</string>\r\n    <string name=\"profile_login\">Login</string>\r\n    <string name=\"profile_logout\">Logout</string>\r\n    <string name=\"profile_email\">Email</string>\r\n    <string name=\"profile_password\">Password</string>\r\n    <string name=\"navigation_drawer_open\">Open menu</string>\r\n    <string name=\"navigation_drawer_close\">Close menu</string>\r\n    <string name=\"menu_info\">Monastery information</string>\r\n    <string name=\"menu_history\">History</string>\r\n    <string name=\"menu_gallery\">Gallery</string>\r\n    <string name=\"menu_profile\">Profile</string>\r\n    <string name=\"menu_settings\">Settings</string>\r\n    <string name=\"title_info_general\">General Information</string>\r\n    <string name=\"title_history\">History</string>\r\n    <string name=\"title_gallery\">Gallery</string>\r\n    <string name=\"title_profile\">Profile</string>\r\n    <string name=\"title_settings\">Settings</string>\r\n\r\n    <string name=\"info_location\">Street: …</string>\r\n    <string name=\"history_1328\">1328 \uD83D\uDD25 Fire and Reconstruction</string>\r\n    <string name=\"history_1328_body\">During a fire in Valladolid caused by the troops of Alfonso XI, the monastery in the Palaces of La Magdalena was severely damaged. The nuns began its reconstruction thanks to the financial support of Álvaro Nuño Pérez de Monroy.</string>\r\n\r\n    <string name=\"history_1579\">1579 \uD83C\uDFF0 Reconstruction of the Church and the Cloister</string>\r\n    <string name=\"history_579_body\">The nuns built the church following the design of the Italian master Pietro Palladio. The altarpiece was the work of Gregorio Fernández, and the new cloister was built by Francisco de Praves. All this was made possible thanks to donations from the abbesses Ana and Isabel de Mendoza.</string>\r\n\r\n    <string name=\"history_1869\">1869 \uD83C\uDF93 The Monastery School Is Founded</string>\r\n    <string name=\"history_1869_body\">The community of Las Huelgas Reales opened its own school, welcoming young noble girls from Valladolid as semi-boarders.</string>\r\n\r\n    <string name=\"history_XX\">20th–21st Centuries ✨ Restoration and Modern Life</string>\r\n    <string name=\"history_XX_body\">The monastery was fully restored. The decline in vocations encouraged the creation of the Lay Cistercian Brotherhood, which keeps alive the spirit of the Rule of Saint Benedict.</string>\r\n\r\n    <string name=\"history_2007\">2007 Onwards \uD83D\uDC69\u200D\uD83E\uDDB3 Leadership and Female Congregation</string>\r\n    <string name=\"history_2007_body\">The monastery is part of the Castile Congregation of the Cistercian Order, active as a female congregation since 2007. The first abbess president was María del Mar Martínez; after her death in 2013, Sister Isabel Vallés Gallego took over the position. Currently, Sister María leads the monastery and the school.</string>\r\n    <string name=\"info_hours\">Hours: XX:XX - YY:YY</string>\r\n    <string name=\"general_info\">General information:</string>\r\n    <string name=\"title_appointment\">Book Appointment</string>\r\n    <string name=\"option_phone_appointment\">Book by phone</string>\r\n    <string name=\"option_online_appointment\">Book online</string>\r\n    <string name=\"name_appointment\">Name</string>\r\n    <string name=\"email_appointment\">Email</string>\r\n    <string name=\"date_appointment\">Date</string>\r\n    <string name=\"hour_appointment\">Time</string>\r\n    <string name=\"placeholdername_appointment\">Enter your full name</string>\r\n    <string name=\"placeholderemail_appointment\">Enter your email address</string>\r\n    <string name=\"placeholderdate_appointment\">Select a date</string>\r\n    <string name=\"placeholderhour_appointment\">Select a time</string>\r\n    <string name=\"compulsory_name\">Name is required</string>\r\n    <string name=\"valid_name\">The name contains an invalid symbol</string>\r\n    <string name=\"compulsory_email\">Email is required</string>\r\n    <string name=\"valid_email\">The email format is invalid</string>\r\n    <string name=\"date_no_selected\">A date must be selected</string>\r\n    <string name=\"hour_no_selected\">A time must be selected</string>\r\n    <string name=\"datepicker_ok\">Ok</string>\r\n    <string name=\"datepicker_cancel\">Cancel</string>\r\n    <string name=\"confirm_button\">CONFIRM</string>\r\n    <string name=\"contentimage_confirmation\">Confirmed</string>\r\n    <string name=\"confirmation_appointment\">ALMOST READY!!</string>\r\n    <string name=\"details_appointment\">Your booking request is ready. Please click \\'send\\' in the email application that just opened to finalize your request. We will reply to that email to confirm availability..</string>\r\n    <string name=\"email_subject\">View Reservation Request - %1$s</string>\r\n    <string name=\"email_message\">Hello,\\n\\nI would like to request a reservation for a visit to the monastery with the following details:\\n\\n* Name: %1$s\\n* Email: %2$s\\n* Date of visit: %3$s\\n* Time of visit: %4$s\\n\\nI look forward to your kind confirmation.\\n\\nThank you very much,\\nSincerely,\\n\\n%1$s</string>\r\n    <string name=\"email_error\">No email app was found</string>\r\n    <string name=\"history_content_placeholder\">Mauris vel nisi id metus vestibulum vehicula nec ac orci. Curabitur massa diam, fermentum sit amet augue sit, volutpat efficitur enim. Phasellus a cursus orci, id laoreet dolor. Class aptent taciti sociosqu ad litora torquent per conubia nostra, per inceptos himenaeos.</string>\r\n    <string name=\"language_select\">Select language</string>\r\n    <string name=\"font_size_select\">Select the font size</string>\r\n    <string name=\"font_extrabig\">Extra Big</string>\r\n    <string name=\"font_normal\">Medium</string>\r\n    <string name=\"font_big\">Big</string>\r\n    <string name=\"title_monasterio\">Monastery</string>\r\n    <string name=\"title_entrada\">Monastery Entrance</string>\r\n    <string name=\"spanish_language\">Spanish</string>\r\n    <string name=\"german_language\">German</string>\r\n    <string name=\"english_language\">English</string>\r\n    <string name=\"navegation_button\">Hide navigation buttons</string>\r\n    <string name=\"close\">Close</string>\r\n    <string name=\"go_back\">Go Back</string>\r\n    <string name=\"see_360\">View 360º</string>\r\n    <string name=\"contentdescription_image_pin\">Pin image (click to enlarge)</string>\r\n    <string name=\"readjust\">Readjust</string>\r\n    <string name=\"decrease\">Decrease</string>\r\n    <string name=\"increase\">Increase</string>\r\n    <string name=\"out_interactive_area\">Outside the interactive area</string>\r\n    <string name=\"notdefined_destiny\">Undefined destination</string>\r\n    <string name=\"notdefined_destinyplane\">Destination plane not defined</string>\r\n    <string name=\"plane_loading\">Loading plane...</string>\r\n    <string name=\"error_loading_plane\">Error loading plan data</string>\r\n    <string name=\"child_mode\">KIDS MODE</string>\r\n    <string name=\"child_mode_view\">Kids Mode</string>\r\n    <string name=\"video_view\">Video</string>\r\n    <string name=\"game_view\">Games</string>\r\n    <string name=\"video_child\">VIDEO</string>\r\n    <string name=\"game_child\">GAMES</string>\r\n    <string name=\"edit_mode\">EDIT MODE</string>\r\n    <string name=\"edit_home_background\">Edit home background</string>\r\n    <string name=\"edit_pins\">Edit pins</string>\r\n    <string name=\"location_error\">No app was found to open the location.</string>\r\n    <string name=\"contact_data\">Contact Information</string>\r\n    <string name=\"location_data\">Location</string>\r\n    <string name=\"email_data\">Email</string>\r\n    <string name=\"phone_data\">Phone</string>\r\n    <string name=\"visit_schedule\">Opening Hours</string>\r\n    <string name=\"monday_to_friday\">Monday to Friday:</string>\r\n    <string name=\"four_pieces\">4 pieces</string>\r\n    <string name=\"nine_pieces\">9 pieces</string>\r\n    <string name=\"sixteen_pieces\">16 pieces</string>\r\n    <string name=\"twentyfive_pieces\">25 pieces</string>\r\n    <string name=\"three_pairs\">3 Pairs</string>\r\n    <string name=\"four_pairs\">4 Pairs</string>\r\n    <string name=\"five_pairs\">5 Pairs</string>\r\n    <string name=\"six_pairs\">6 Pairs</string>\r\n    <string name=\"confirm_save_title\">Save changes?</string>\r\n    <string name=\"confirm_save_message\">Are you sure you want to save the changes?</string>\r\n    <string name=\"confirm_save_button\">Save</string>\r\n    <string name=\"confirm_cancel_button\">Cancel</string>\r\n    <string name=\"edit_cancel_changes\">Cancel</string>\r\n    <string name=\"profile_name\">Name</string>\r\n    <string name=\"image_add\">Add image</string>\r\n    <string name=\"image_delete\">Delete</string>\r\n    <string name=\"image_delete_confirm_title\">Delete image?</string>\r\n    <string name=\"image_delete_confirm_message\">Are you sure you want to delete this image?</string>\r\n    <string name=\"image_uploading\">Uploading image...</string>\r\n    <string name=\"image_upload_success\">Image uploaded successfully</string>\r\n    <string name=\"image_upload_error\">Error uploading image</string>\r\n    <string name=\"image_select_error\">Error selecting image</string>\r\n    <string name=\"image_gallery_title\">Images</string>\r\n    <string name=\"congratulations\">Congratulations!</string>\r\n    <string name=\"message_game_completed\">You\\'ve solved the game! Ready for the next challenge?</string>\r\n    <string name=\"original_image\">View image</string>\r\n    <string name=\"ready\">Ready</string>\r\n    <string name=\"lang_de\">Deutsch</string>\r\n    <string name=\"font_small\">Small</string>\r\n    <string name=\"font_medium\">Medium</string>\r\n    <string name=\"font_large\">Large</string>\r\n    <string name=\"dont_show_again\">Don\\'t show again</string>\r\n    <string name=\"understand\">Got it</string>\r\n    <string name=\"map_tutorial_body\">This is the tutorial body</string>\r\n    <string name=\"map_tutorial_title\">This is the tutorial title</string>\r\n    <string name=\"map_tutorial_body2\">This is the map tutorial body 2</string>\r\n    <string name=\"map_tutorial_title2\">This is the map tutorial title 2</string>\r\n    <string name=\"pin_tutorial_body\">This is the pin tutorial body</string>\r\n    <string name=\"pin_tutorial_title\">This is the pin tutorial title</string>\r\n    <string name=\"next\">Next</string>\r\n\r\n    <string name=\"map_tutorial_body1\">The (←) symbol in the top left allows you to return to the start.</string>\r\n    <string name=\"map_tutorial_body1_2\">Tap the colored zones on the map to enter the different viewable areas.</string>\r\n    <string name=\"map_tutorial_body1_3\">Additionally, the buttons on the right allow you to zoom in, zoom out, or reset the map to its original size.</string>\r\n\r\n    <string name=\"submapa_1\">Tap the (←) symbol to return to the main map.</string>\r\n    <string name=\"submapa_2\">Tap the different pins to access the points of interest.</string>\r\n\r\n    <string name=\"pin_1\">Tap the (←) symbol to return to the map.</string>\r\n    <string name=\"pin_2\">Swipe through the images or tap them to enlarge.</string>\r\n    <string name=\"pin_3\">Tap here to listen to the audio narration.</string>\r\n    <string name=\"pin_4\">Tap this button to access the 360° view.</string>\r\n    <string name=\"visible\">Visible</string>\r\n    <string name=\"hidden\">Hidden</string>\r\n    <string name=\"lang_en\">English</string>\r\n    <string name=\"lang_es\">Español</string>\r\n    <string name=\"sample_text\">Ejemplo</string>\r\n    <string name=\"puzzle_screen\">Puzzle</string>\r\n    <string name=\"puzzle_option\">PUZZLE</string>\r\n    <string name=\"memory_screen\">Memory</string>\r\n    <string name=\"memory_option\">MEMORY</string>\r\n    <string name=\"back_piece\">Back of the piece</string>\r\n    <string name=\"left_pairs\">Remaining couples: %1$s</string>\r\n    <string name=\"left_pieces\">Remaining pieces: %1$s</string>\r\n</resources>
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/app/src/main/res/values-en/strings.xml b/app/src/main/res/values-en/strings.xml
--- a/app/src/main/res/values-en/strings.xml	(revision b563b49dc11c723564618e771e0193249d97dff7)
+++ b/app/src/main/res/values-en/strings.xml	(date 1764252090145)
@@ -1,6 +1,6 @@
 <?xml version="1.0" encoding="utf-8"?>
 <resources>
-    <string name="app_name">Museum360</string>
+    <string name="app_name">Santa María la Real de Huelgas</string>
     <string name="title_inicio">Home</string>
     <string name="virtual_visit">VIRTUAL VISIT</string>
     <string name="book_appointment">BOOK APPOINTMENT</string>
@@ -166,6 +166,7 @@
     <string name="hidden">Hidden</string>
     <string name="lang_en">English</string>
     <string name="lang_es">Español</string>
+    <string name="lang_fr">Français</string>
     <string name="sample_text">Ejemplo</string>
     <string name="puzzle_screen">Puzzle</string>
     <string name="puzzle_option">PUZZLE</string>
Index: .idea/deploymentTargetSelector.xml
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+><?xml version=\"1.0\" encoding=\"UTF-8\"?>\r\n<project version=\"4\">\r\n  <component name=\"deploymentTargetSelector\">\r\n    <selectionStates>\r\n      <SelectionState runConfigName=\"app\">\r\n        <option name=\"selectionMode\" value=\"DROPDOWN\" />\r\n        <DropdownSelection timestamp=\"2025-11-27T11:19:10.519801900Z\">\r\n          <Target type=\"DEFAULT_BOOT\">\r\n            <handle>\r\n              <DeviceId pluginId=\"PhysicalDevice\" identifier=\"serial=R52T40GVQQB\" />\r\n            </handle>\r\n          </Target>\r\n        </DropdownSelection>\r\n        <DialogSelection>\r\n          <targets>\r\n            <Target type=\"DEFAULT_BOOT\">\r\n              <handle>\r\n                <DeviceId pluginId=\"PhysicalDevice\" identifier=\"serial=RZCX7216PCM\" />\r\n              </handle>\r\n            </Target>\r\n            <Target type=\"DEFAULT_BOOT\">\r\n              <handle>\r\n                <DeviceId pluginId=\"PhysicalDevice\" identifier=\"serial=R52T40GVQQB\" />\r\n              </handle>\r\n            </Target>\r\n          </targets>\r\n        </DialogSelection>\r\n      </SelectionState>\r\n    </selectionStates>\r\n  </component>\r\n</project>
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/.idea/deploymentTargetSelector.xml b/.idea/deploymentTargetSelector.xml
--- a/.idea/deploymentTargetSelector.xml	(revision b563b49dc11c723564618e771e0193249d97dff7)
+++ b/.idea/deploymentTargetSelector.xml	(date 1764253650332)
@@ -4,27 +4,6 @@
     <selectionStates>
       <SelectionState runConfigName="app">
         <option name="selectionMode" value="DROPDOWN" />
-        <DropdownSelection timestamp="2025-11-27T11:19:10.519801900Z">
-          <Target type="DEFAULT_BOOT">
-            <handle>
-              <DeviceId pluginId="PhysicalDevice" identifier="serial=R52T40GVQQB" />
-            </handle>
-          </Target>
-        </DropdownSelection>
-        <DialogSelection>
-          <targets>
-            <Target type="DEFAULT_BOOT">
-              <handle>
-                <DeviceId pluginId="PhysicalDevice" identifier="serial=RZCX7216PCM" />
-              </handle>
-            </Target>
-            <Target type="DEFAULT_BOOT">
-              <handle>
-                <DeviceId pluginId="PhysicalDevice" identifier="serial=R52T40GVQQB" />
-              </handle>
-            </Target>
-          </targets>
-        </DialogSelection>
       </SelectionState>
     </selectionStates>
   </component>
Index: app/src/main/java/com/nextapp/monasterio/ui/screens/ParejasScreen.kt
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>package com.nextapp.monasterio.ui.screens\r\n\r\nimport android.app.Activity\r\nimport android.content.pm.ActivityInfo\r\nimport androidx.compose.animation.Crossfade\r\nimport androidx.compose.animation.core.tween\r\nimport androidx.compose.foundation.Image\r\nimport androidx.compose.foundation.background\r\nimport androidx.compose.foundation.clickable\r\nimport androidx.compose.foundation.layout.Arrangement\r\nimport androidx.compose.foundation.layout.Box\r\nimport androidx.compose.foundation.layout.Column\r\nimport androidx.compose.foundation.layout.aspectRatio\r\nimport androidx.compose.foundation.layout.fillMaxHeight\r\nimport androidx.compose.foundation.layout.fillMaxSize\r\nimport androidx.compose.foundation.layout.fillMaxWidth\r\nimport androidx.compose.foundation.layout.padding\r\nimport androidx.compose.foundation.layout.width\r\nimport androidx.compose.foundation.layout.wrapContentHeight\r\nimport androidx.compose.foundation.layout.wrapContentWidth\r\nimport androidx.compose.foundation.lazy.grid.GridCells\r\nimport androidx.compose.foundation.lazy.grid.LazyVerticalGrid\r\nimport androidx.compose.foundation.lazy.grid.items\r\nimport androidx.compose.material3.AlertDialog\r\nimport androidx.compose.material3.Button\r\nimport androidx.compose.material3.Card\r\nimport androidx.compose.material3.CardDefaults\r\nimport androidx.compose.material3.MaterialTheme\r\nimport androidx.compose.material3.Text\r\nimport androidx.compose.runtime.Composable\r\nimport androidx.compose.runtime.DisposableEffect\r\nimport androidx.compose.runtime.collectAsState\r\nimport androidx.compose.runtime.getValue\r\nimport androidx.compose.runtime.remember\r\nimport androidx.compose.ui.Alignment\r\nimport androidx.compose.ui.Modifier\r\nimport androidx.compose.ui.graphics.Color\r\nimport androidx.compose.ui.layout.ContentScale\r\nimport androidx.compose.ui.platform.LocalContext\r\nimport androidx.compose.ui.res.painterResource\r\nimport androidx.compose.ui.res.stringResource\r\nimport androidx.compose.ui.unit.dp\r\nimport androidx.lifecycle.viewmodel.compose.viewModel\r\nimport androidx.navigation.NavController\r\nimport com.nextapp.monasterio.R\r\nimport com.nextapp.monasterio.models.ParejasPieza\r\nimport com.nextapp.monasterio.models.ParejasSize\r\nimport com.nextapp.monasterio.viewModels.ParejasViewModel\r\nimport com.nextapp.monasterio.viewModels.ParejasViewModelFactory\r\n\r\n\r\n@Composable\r\nfun ParejasScreen(\r\n    navController: NavController,\r\n    size : ParejasSize,\r\n    imagenes : List<Int>\r\n){\r\n    val factory = remember { ParejasViewModelFactory(size, imagenes) }\r\n    val viewModel: ParejasViewModel = viewModel(factory = factory)\r\n    val state by viewModel.uiState.collectAsState()\r\n\r\n    val context = LocalContext.current\r\n    val activity = context as? Activity\r\n\r\n    DisposableEffect(Unit) {\r\n        activity?.requestedOrientation = ActivityInfo.SCREEN_ORIENTATION_PORTRAIT\r\n        onDispose {\r\n\r\n        }\r\n    }\r\n\r\n    Column(\r\n        modifier = Modifier\r\n            .fillMaxSize()\r\n            .background(MaterialTheme.colorScheme.surfaceVariant)\r\n            .padding(16.dp),\r\n        horizontalAlignment = Alignment.CenterHorizontally,\r\n        verticalArrangement = Arrangement.Center\r\n    ) {\r\n\r\n        Column(\r\n            modifier = Modifier\r\n                .fillMaxWidth()\r\n                .padding(bottom = 16.dp),\r\n            horizontalAlignment = Alignment.CenterHorizontally\r\n        ) {\r\n            Text(\r\n                text = stringResource(R.string.left_pairs,state.parejas),\r\n                style = MaterialTheme.typography.titleMedium,\r\n                modifier = Modifier.padding(start = 4.dp)\r\n            )\r\n        }\r\n\r\n        LazyVerticalGrid(\r\n            columns = GridCells.Fixed(size.columns),\r\n            modifier = Modifier\r\n                .wrapContentHeight(Alignment.CenterVertically)\r\n                .wrapContentWidth(Alignment.CenterHorizontally)\r\n                .padding(vertical = 8.dp)\r\n                .then(\r\n                    if(size.rows == 4 ) {\r\n                        Modifier.width(300.dp)\r\n                    } else if (size.rows == 5){\r\n                        Modifier.width(250.dp)\r\n                    } else{\r\n                        Modifier.fillMaxWidth()\r\n                    }\r\n                ),\r\n            verticalArrangement = Arrangement.spacedBy(8.dp),\r\n            horizontalArrangement = Arrangement.spacedBy(8.dp),\r\n        ) {\r\n            items(\r\n                state.piezas,\r\n            ){pieza ->\r\n                GridCell(pieza = pieza, mostradoInicial = state.mostradoInicial,onClick = { id -> viewModel.onClickPieza(id) })\r\n            }\r\n        }\r\n    }\r\n\r\n    if (state.solucionado) {\r\n        ParejaDialog(onDismiss = {}, onConfirm = { navController.popBackStack() })\r\n    }\r\n}\r\n\r\n\r\n\r\n@Composable\r\nfun ParejaDialog(\r\n    onDismiss: () -> Unit,\r\n    onConfirm : () -> Unit\r\n){\r\n    AlertDialog(\r\n        onDismissRequest=onDismiss,\r\n        title = {\r\n            Text(stringResource(R.string.congratulations))\r\n        },\r\n        text = {\r\n            Text(stringResource(R.string.message_game_completed))\r\n        },confirmButton = {\r\n            Button(\r\n                onClick = onConfirm\r\n            ) {\r\n                Text(stringResource(R.string.ready))\r\n            }\r\n        },\r\n    )\r\n}\r\n\r\n@Composable\r\nfun GridCell(\r\n    pieza: ParejasPieza,\r\n    mostradoInicial : Boolean,\r\n    onClick : (Int) -> Unit,\r\n) {\r\n    val conPareja = pieza.conPareja\r\n    val isClickable = !conPareja\r\n\r\n    Card(\r\n        elevation = CardDefaults.cardElevation(defaultElevation = if (conPareja || pieza.estaVolteada) 4.dp else 2.dp),\r\n        modifier = Modifier\r\n            .aspectRatio(1f)\r\n            .then(\r\n                if (isClickable && !mostradoInicial){\r\n                    Modifier.clickable{ onClick(pieza.id) }\r\n                } else{\r\n                    Modifier\r\n                }\r\n            ),\r\n        shape = MaterialTheme.shapes.medium,\r\n        colors = CardDefaults.cardColors(\r\n            containerColor = Color.White\r\n        )\r\n    ) {\r\n        Box(\r\n            modifier = Modifier.fillMaxSize(),\r\n            contentAlignment = Alignment.Center\r\n        ) {\r\n            Crossfade(\r\n                targetState = if(conPareja || pieza.estaVolteada || mostradoInicial) 1 else 0,\r\n                animationSpec = tween(durationMillis = 300),\r\n                label=\"CardFlipAnimation\"\r\n            ) { state ->\r\n                if (state == 1) {\r\n                    Image(\r\n                        painter = painterResource(id = pieza.imagen),\r\n                        contentDescription = \"Pieza ${pieza.id}\",\r\n                        contentScale = ContentScale.Crop,\r\n                        modifier = Modifier.fillMaxSize()\r\n                    )\r\n                } else {\r\n                    Image(\r\n                        painterResource(R.drawable.escudo),\r\n                        contentDescription = stringResource(R.string.back_piece),\r\n                        contentScale = ContentScale.Fit,\r\n                        modifier = Modifier.fillMaxSize()\r\n                    )\r\n                }\r\n            }\r\n        }\r\n    }\r\n}
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/app/src/main/java/com/nextapp/monasterio/ui/screens/ParejasScreen.kt b/app/src/main/java/com/nextapp/monasterio/ui/screens/ParejasScreen.kt
--- a/app/src/main/java/com/nextapp/monasterio/ui/screens/ParejasScreen.kt	(revision b563b49dc11c723564618e771e0193249d97dff7)
+++ b/app/src/main/java/com/nextapp/monasterio/ui/screens/ParejasScreen.kt	(date 1764252097343)
@@ -108,11 +108,12 @@
                 ),
             verticalArrangement = Arrangement.spacedBy(8.dp),
             horizontalArrangement = Arrangement.spacedBy(8.dp),
+            userScrollEnabled = false
         ) {
             items(
                 state.piezas,
             ){pieza ->
-                GridCell(pieza = pieza, mostradoInicial = state.mostradoInicial,onClick = { id -> viewModel.onClickPieza(id) })
+                GridCell(pieza = pieza, mostradoInicial = state.mostradoInicial, verificandoPareja = state.verificandoPareja, onClick = { id -> viewModel.onClickPieza(id) })
             }
         }
     }
@@ -150,11 +151,11 @@
 fun GridCell(
     pieza: ParejasPieza,
     mostradoInicial : Boolean,
+    verificandoPareja : Boolean,
     onClick : (Int) -> Unit,
 ) {
     val conPareja = pieza.conPareja
-    val isClickable = !conPareja
-
+    val isClickable = !conPareja && !verificandoPareja
     Card(
         elevation = CardDefaults.cardElevation(defaultElevation = if (conPareja || pieza.estaVolteada) 4.dp else 2.dp),
         modifier = Modifier
Index: app/src/main/res/values-de/strings.xml
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+><?xml version=\"1.0\" encoding=\"utf-8\"?>\r\n<resources>\r\n    <string name=\"app_name\">Museum360</string>\r\n    <string name=\"title_inicio\">Startseite</string>\r\n    <string name=\"virtual_visit\">VIRTUELLER BESUCH</string>\r\n    <string name=\"book_appointment\">TERMIN BUCHEN</string>\r\n    <string name=\"monastery_name\">Santa María\\nla Real de Huelgas</string>\r\n    <string name=\"edit_mode_activate_icon\">Bearbeitungsmodus</string>\r\n    <string name=\"edit_mode_deactivate_icon\">Bearbeitungsmodus beenden</string>\r\n    <string name=\"edit_mode_activate_message\">Bearbeitungsmodus aktiviert</string>\r\n    <string name=\"edit_mode_deactivate_message\">Bearbeitungsmodus deaktiviert</string>\r\n    <string name=\"edit_save_changes\">Änderungen speichern</string>\r\n    <string name=\"profile_login\">Anmelden</string>\r\n    <string name=\"profile_logout\">Abmelden</string>\r\n    <string name=\"profile_email\">E-Mail</string>\r\n    <string name=\"profile_password\">Passwort</string>\r\n    <string name=\"navigation_drawer_open\">Menü öffnen</string>\r\n    <string name=\"navigation_drawer_close\">Menü schließen</string>\r\n    <string name=\"menu_info\">Klosterinformationen</string>\r\n    <string name=\"menu_history\">Geschichte</string>\r\n    <string name=\"menu_gallery\">Galerie</string>\r\n    <string name=\"menu_profile\">Profil</string>\r\n    <string name=\"menu_settings\">Einstellungen</string>\r\n    <string name=\"title_info_general\">Allgemeine Informationen</string>\r\n    <string name=\"title_history\">Geschichte</string>\r\n    <string name=\"title_gallery\">Galerie</string>\r\n    <string name=\"title_profile\">Profil</string>\r\n    <string name=\"title_settings\">Einstellungen</string>\r\n\r\n\r\n    <string name=\"info_location\">Straße: …</string>\r\n\r\n    <string name=\"history_1328\">1328 \uD83D\uDD25 Brand und Wiederaufbau</string>\r\n    <string name=\"history_1328_body\">Während eines Brandes in Valladolid, ausgelöst durch die Truppen Alfons’ XI., wurde das Kloster in den Palästen von La Magdalena schwer beschädigt. Die Nonnen begannen mit dem Wiederaufbau dank der finanziellen Unterstützung von Álvaro Nuño Pérez de Monroy.</string>\r\n\r\n    <string name=\"history_1579\">1579 \uD83C\uDFF0 Wiederaufbau der Kirche und des Kreuzgangs</string>\r\n    <string name=\"history_579_body\">Die Nonnen errichteten die Kirche nach dem Entwurf des italienischen Meisters Pietro Palladio. Der Altaraufsatz stammte von Gregorio Fernández, und der neue Kreuzgang wurde von Francisco de Praves gebaut. All dies wurde durch die Spenden der Äbtissinnen Ana und Isabel de Mendoza ermöglicht.</string>\r\n\r\n    <string name=\"history_1869\">1869 \uD83C\uDF93 Gründung der Klosterschule</string>\r\n    <string name=\"history_1869_body\">Die Gemeinschaft der Huelgas Reales eröffnete ihre eigene Schule und nahm adlige Mädchen aus Valladolid als Halbinternats\u00ADschülerinnen auf.</string>\r\n\r\n    <string name=\"history_XX\">20.–21. Jahrhundert ✨ Restaurierung und modernes Leben</string>\r\n    <string name=\"history_XX_body\">Das Kloster wurde vollständig restauriert. Der Rückgang der Berufungen führte zur Gründung der Laien-Zisterzienserbruderschaft, die den Geist der Regula Benedicti lebendig hält.</string>\r\n\r\n    <string name=\"history_2007\">Seit 2007 \uD83D\uDC69\u200D\uD83E\uDDB3 Leitung und weibliche Kongregation</string>\r\n    <string name=\"history_2007_body\">Das Kloster gehört zur Kastilischen Kongregation des Zisterzienserordens, die seit 2007 als weibliche Kongregation aktiv ist. Die erste Präsidentin der Äbtissinnen war María del Mar Martínez; nach ihrem Tod im Jahr 2013 übernahm Schwester Isabel Vallés Gallego das Amt. Derzeit leitet Schwester María das Kloster und die Schule.</string>\r\n    <string name=\"info_hours\">Öffnungszeiten: XX:XX - YY:YY</string>\r\n    <string name=\"general_info\">Allgemeine Informationen:</string>\r\n    <string name=\"title_appointment\">Termin buchen</string>\r\n    <string name=\"option_phone_appointment\">Telefonisch buchen</string>\r\n    <string name=\"option_online_appointment\">Online buchen</string>\r\n    <string name=\"name_appointment\">Name</string>\r\n    <string name=\"email_appointment\">E-Mail</string>\r\n    <string name=\"date_appointment\">Datum</string>\r\n    <string name=\"hour_appointment\">Uhrzeit</string>\r\n    <string name=\"placeholdername_appointment\">Geben Sie Ihren vollständigen Namen ein</string>\r\n    <string name=\"placeholderemail_appointment\">Geben Sie Ihre E-Mail-Adresse ein</string>\r\n    <string name=\"placeholderdate_appointment\">Wählen Sie ein Datum</string>\r\n    <string name=\"placeholderhour_appointment\">Wählen Sie eine Uhrzeit</string>\r\n    <string name=\"compulsory_name\">Name ist erforderlich</string>\r\n    <string name=\"valid_name\">Der Name enthält ein ungültiges Symbol</string>\r\n    <string name=\"compulsory_email\">E-Mail ist erforderlich</string>\r\n    <string name=\"valid_email\">Das E-Mail-Format ist ungültig</string>\r\n    <string name=\"date_no_selected\">Ein Datum muss ausgewählt werden</string>\r\n    <string name=\"hour_no_selected\">Eine Uhrzeit muss ausgewählt werden</string>\r\n    <string name=\"datepicker_ok\">Ok</string>\r\n    <string name=\"datepicker_cancel\">Abbrechen</string>\r\n    <string name=\"confirm_button\">BESTÄTIGEN</string>\r\n    <string name=\"contentimage_confirmation\">Bestätigt</string>\r\n    <string name=\"confirmation_appointment\">FAST FERTIG!!</string>\r\n    <string name=\"details_appointment\">Ihre Buchungsanfrage ist bereit. Bitte klicken Sie auf \\'Senden\\' in der gerade geöffneten E-Mail-Anwendung, um Ihre Anfrage abzuschließen. Wir werden auf diese E-Mail antworten, um die Verfügbarkeit zu bestätigen.</string>\r\n    <string name=\"email_subject\">Anfrage für Besuchsreservierung - %1$s</string>\r\n    <string name=\"email_message\">Hallo,\\n\\nIch möchte eine Reservierung für einen Besuch des Klosters mit den folgenden Details anfordern:\\n\\n* Name: %1$s\\n* E-Mail: %2$s\\n* Besuchsdatum: %3$s\\n* Besuchszeit: %4$s\\n\\nIch freue mich auf Ihre freundliche Bestätigung.\\n\\nVielen Dank,\\nMit freundlichen Grüßen,\\n\\n%1$s</string>\r\n    <string name=\"email_error\">Es wurde keine E-Mail-App gefunden</string>\r\n    <string name=\"history_content_placeholder\">Mauris vel nisi id metus vestibulum vehicula nec ac orci. Curabitur massa diam, fermentum sit amet augue sit, volutpat efficitur enim. Phasellus a cursus orci, id laoreet dolor. Class aptent taciti sociosqu ad litora torquent per conubia nostra, per inceptos himenaeos.</string>\r\n    <string name=\"language_select\">Sprache auswählen</string>\r\n    <string name=\"font_size_select\">Schriftgröße auswählen</string>\r\n    <string name=\"font_extrabig\">Extra Groß</string>\r\n    <string name=\"font_normal\">Mittel</string>\r\n    <string name=\"font_big\">Groß</string>\r\n    <string name=\"title_monasterio\">Kloster</string>\r\n    <string name=\"title_entrada\">Klostereingang</string>\r\n    <string name=\"spanish_language\">Spanisch</string>\r\n    <string name=\"german_language\">Deutsch</string>\r\n    <string name=\"english_language\">Englisch</string>\r\n    <string name=\"navegation_button\">Navigationsschaltflächen ausblenden</string>\r\n    <string name=\"close\">Schließen</string>\r\n    <string name=\"go_back\">Zurück</string>\r\n    <string name=\"see_360\">360º ansehen</string>\r\n    <string name=\"contentdescription_image_pin\">Pin-Bild (zum Vergrößern klicken)</string>\r\n    <string name=\"readjust\">Neu anpassen</string>\r\n    <string name=\"decrease\">Verringern</string>\r\n    <string name=\"increase\">Erhöhen</string>\r\n    <string name=\"out_interactive_area\">Außerhalb des interaktiven Bereichs</string>\r\n    <string name=\"notdefined_destiny\">Ziel nicht definiert</string>\r\n    <string name=\"notdefined_destinyplane\">Zielplan nicht definiert</string>\r\n    <string name=\"plane_loading\">Lade Plan...</string>\r\n    <string name=\"error_loading_plane\">Fehler beim Laden der Plandaten</string>\r\n    <string name=\"child_mode\">KINDERMODUS</string>\r\n    <string name=\"child_mode_view\">Kindermodus</string>\r\n    <string name=\"video_view\">Video</string>\r\n    <string name=\"game_view\">Spiele</string>\r\n    <string name=\"video_child\">VIDEO</string>\r\n    <string name=\"game_child\">SPIELE</string>\r\n    <string name=\"edit_mode\">BEARBEITUNGSMODUS</string>\r\n    <string name=\"edit_home_background\">Startseiten-Hintergrund bearbeiten</string>\r\n    <string name=\"edit_pins\">Pins bearbeiten</string>\r\n    <string name=\"location_error\">Es wurde keine App gefunden, mit der der Standort geöffnet werden kann.</string>\r\n    <string name=\"contact_data\">Kontaktinformationen</string>\r\n    <string name=\"location_data\">Standort</string>\r\n    <string name=\"email_data\">E-Mail</string>\r\n    <string name=\"phone_data\">Telefon</string>\r\n    <string name=\"visit_schedule\">Öffnungszeiten</string>\r\n    <string name=\"monday_to_friday\">Montag bis Freitag:</string>\r\n    <string name=\"confirm_save_title\">Änderungen speichern?</string>\r\n    <string name=\"confirm_save_message\">Sind Sie sicher, dass Sie die Änderungen speichern möchten?</string>\r\n    <string name=\"confirm_save_button\">Speichern</string>\r\n    <string name=\"confirm_cancel_button\">Abbrechen</string>\r\n    <string name=\"edit_cancel_changes\">Abbrechen</string>\r\n    <string name=\"profile_name\">Name</string>\r\n    <string name=\"image_add\">Bild hinzufügen</string>\r\n    <string name=\"image_delete\">Löschen</string>\r\n    <string name=\"image_delete_confirm_title\">Bild löschen?</string>\r\n    <string name=\"image_delete_confirm_message\">Diese Aktion kann nicht rückgängig gemacht werden</string>\r\n    <string name=\"image_uploading\">Bild wird hochgeladen...</string>\r\n    <string name=\"image_upload_success\">Bild erfolgreich hochgeladen</string>\r\n    <string name=\"image_upload_error\">Fehler beim Hochladen des Bildes</string>\r\n    <string name=\"image_select_error\">Fehler beim Auswählen des Bildes</string>\r\n    <string name=\"four_pieces\">4 Stück</string>\r\n    <string name=\"nine_pieces\">9 Stück</string>\r\n    <string name=\"sixteen_pieces\">16 Stück</string>\r\n    <string name=\"twentyfive_pieces\">25 Stück</string>\r\n    <string name=\"three_pairs\">3 Paare</string>\r\n    <string name=\"four_pairs\">4 Paare</string>\r\n    <string name=\"five_pairs\">5 Paare</string>\r\n    <string name=\"six_pairs\">6 Paare</string>\r\n    <string name=\"congratulations\">Glückwunsch!</string>\r\n    <string name=\"message_game_completed\">Du hast das Spiel gelöst! Bereit für die nächste Herausforderung?</string>\r\n    <string name=\"original_image\">Bild ansehen</string>\r\n    <string name=\"ready\">Bereit</string>\r\n    <string name=\"dont_show_again\">Nicht mehr anzeigen</string>\r\n    <string name=\"understand\">Verstanden</string>\r\n    <string name=\"map_tutorial_body\">Dies ist der Inhalt des Tutorials</string>\r\n    <string name=\"map_tutorial_title\">Dies ist der Titel des Tutorials</string>\r\n    <string name=\"map_tutorial_body2\">Dies ist der Inhalt des Kartentutorials 2</string>\r\n    <string name=\"map_tutorial_title2\">Dies ist der Titel des Kartentutorials 2</string>\r\n    <string name=\"pin_tutorial_body\">Dies ist der Inhalt des Pin-Tutorials</string>\r\n    <string name=\"pin_tutorial_title\">Dies ist der Titel des Pin-Tutorials</string>\r\n    <string name=\"next\">Weiter</string>\r\n\r\n    <string name=\"map_tutorial_body1\">Oben links können Sie über das Symbol (←) zum Start zurückkehren.</string>\r\n    <string name=\"map_tutorial_body1_2\">Tippen Sie auf die farbigen Bereiche der Karte, um die verschiedenen Bereiche zu erkunden.</string>\r\n    <string name=\"map_tutorial_body1_3\">Mit den Tasten auf der rechten Seite können Sie die Karte vergrößern, verkleinern oder zurücksetzen.</string>\r\n\r\n    <string name=\"submapa_1\">Tippen Sie auf das Symbol (←), um zur Übersichtskarte zurückzukehren.</string>\r\n    <string name=\"submapa_2\">Tippen Sie auf die verschiedenen Pins, um die Details aufzurufen.</string>\r\n\r\n    <string name=\"pin_1\">Drücken Sie das Symbol (←), um zur Karte zurückzukehren.</string>\r\n    <string name=\"pin_2\">Wischen Sie durch die Bilder oder tippen Sie darauf, um sie zu vergrößern.</string>\r\n    <string name=\"pin_3\">Tippen Sie hier, um den Audioguide anzuhören.</string>\r\n    <string name=\"pin_4\">Drücken Sie diesen Button, um die 360°-Ansicht zu öffnen.</string>\r\n    <string name=\"image_gallery_title\">Bilder</string>\r\n    <string name=\"visible\">sichtbar</string>\r\n    <string name=\"hidden\">versteckt</string>\r\n    <string name=\"lang_en\">English</string>\r\n    <string name=\"lang_es\">Español</string>\r\n    <string name=\"sample_text\">Beispiel</string>\r\n    <string name=\"lang_de\">Deutsch</string>\r\n    <string name=\"font_small\">Klein</string>\r\n    <string name=\"font_medium\">Mittel</string>\r\n    <string name=\"font_large\">Groß</string>\r\n    <string name=\"puzzle_screen\">Puzzle</string>\r\n    <string name=\"puzzle_option\">PUZZLE</string>\r\n    <string name=\"memory_screen\">Memory</string>\r\n    <string name=\"memory_option\">MEMORY</string>\r\n    <string name=\"back_piece\">Rückseite des Stückes</string>\r\n    <string name=\"left_pairs\">Verbleibende Paare: %1$s</string>\r\n    <string name=\"left_pieces\">Restliche Stücke: %1$s</string>\r\n</resources>
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/app/src/main/res/values-de/strings.xml b/app/src/main/res/values-de/strings.xml
--- a/app/src/main/res/values-de/strings.xml	(revision b563b49dc11c723564618e771e0193249d97dff7)
+++ b/app/src/main/res/values-de/strings.xml	(date 1764252090099)
@@ -1,6 +1,6 @@
 <?xml version="1.0" encoding="utf-8"?>
 <resources>
-    <string name="app_name">Museum360</string>
+    <string name="app_name">Santa María la Real de Huelgas</string>
     <string name="title_inicio">Startseite</string>
     <string name="virtual_visit">VIRTUELLER BESUCH</string>
     <string name="book_appointment">TERMIN BUCHEN</string>
@@ -166,6 +166,7 @@
     <string name="lang_es">Español</string>
     <string name="sample_text">Beispiel</string>
     <string name="lang_de">Deutsch</string>
+    <string name="lang_fr">Français</string>
     <string name="font_small">Klein</string>
     <string name="font_medium">Mittel</string>
     <string name="font_large">Groß</string>
Index: app/src/main/java/com/nextapp/monasterio/ui/virtualvisit/screens/PinDetalleScreen.kt
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>package com.nextapp.monasterio.ui.virtualvisit.screens\r\n\r\nimport android.app.Activity\r\nimport android.content.pm.ActivityInfo\r\nimport android.util.Log\r\nimport androidx.compose.foundation.*\r\nimport androidx.compose.foundation.layout.*\r\nimport androidx.compose.foundation.pager.HorizontalPager\r\nimport androidx.compose.foundation.pager.rememberPagerState\r\nimport androidx.compose.foundation.shape.CircleShape\r\nimport androidx.compose.foundation.shape.RoundedCornerShape\r\nimport androidx.compose.material3.*\r\nimport androidx.compose.runtime.*\r\nimport androidx.compose.ui.Alignment\r\nimport androidx.compose.ui.Modifier\r\nimport androidx.compose.ui.draw.clip\r\nimport androidx.compose.ui.geometry.Offset\r\nimport androidx.compose.ui.geometry.Size\r\nimport androidx.compose.ui.graphics.Color\r\nimport androidx.compose.ui.layout.ContentScale\r\nimport androidx.compose.ui.layout.onGloballyPositioned\r\nimport androidx.compose.ui.layout.positionInRoot\r\nimport androidx.compose.ui.platform.LocalConfiguration\r\nimport androidx.compose.ui.platform.LocalContext\r\nimport androidx.compose.ui.platform.LocalView\r\nimport androidx.compose.ui.res.painterResource\r\nimport androidx.compose.ui.res.stringResource\r\nimport androidx.compose.ui.text.font.FontWeight\r\nimport androidx.compose.ui.text.style.TextAlign\r\nimport androidx.compose.ui.unit.dp\r\nimport androidx.compose.ui.unit.sp\r\nimport androidx.compose.ui.viewinterop.AndroidView\r\nimport androidx.compose.ui.window.Dialog\r\nimport androidx.compose.ui.window.DialogProperties\r\nimport androidx.core.view.WindowCompat\r\nimport androidx.media3.common.MediaItem\r\nimport androidx.media3.common.Player\r\nimport androidx.media3.exoplayer.ExoPlayer\r\nimport coil.compose.AsyncImage\r\nimport coil.load\r\nimport com.github.chrisbanes.photoview.PhotoView\r\nimport com.nextapp.monasterio.R\r\nimport com.nextapp.monasterio.models.PinData\r\nimport com.nextapp.monasterio.models.Ubicacion\r\nimport com.nextapp.monasterio.ui.virtualvisit.components.GenericTutorialOverlay\r\nimport com.nextapp.monasterio.viewModels.AjustesViewModel\r\nimport java.util.Locale\r\n\r\n// Clase privada para definir los pasos del tutorial del Pin de forma dinámica\r\nprivate data class PinTutorialStep(\r\n    val description: String,\r\n    val focusCenter: Offset,\r\n    val focusRadius: Float = 0f,      // Para círculos\r\n    val rectSize: Size? = null,       // Para cuadrados/rectángulos\r\n    val alignment: Alignment = Alignment.BottomCenter // Dónde poner el cuadro de texto\r\n)\r\n\r\n@OptIn(ExperimentalFoundationApi::class)\r\n@Composable\r\nfun PinDetalleScreen(\r\n    viewModel: AjustesViewModel,\r\n    pin: PinData,\r\n    onBack: () -> Unit,\r\n    onVer360: (() -> Unit)? = null\r\n) {\r\n    // --- Configuración de Ventana y Orientación ---\r\n    val view = LocalView.current\r\n    LaunchedEffect(Unit) {\r\n        val window = (view.context as? Activity)?.window\r\n        window?.let { WindowCompat.setDecorFitsSystemWindows(it, false) }\r\n    }\r\n\r\n    val activity = view.context as? Activity\r\n\r\n    DisposableEffect(Unit) {\r\n        activity?.requestedOrientation = ActivityInfo.SCREEN_ORIENTATION_PORTRAIT\r\n        onDispose {\r\n            activity?.requestedOrientation = ActivityInfo.SCREEN_ORIENTATION_UNSPECIFIED\r\n        }\r\n    }\r\n\r\n    // --- LÓGICA DE ESTADO DEL TUTORIAL ---\r\n    val isPinDismissed by viewModel.isPinDismissed.collectAsState()\r\n    var showTutorialSession by remember { mutableStateOf(true) }\r\n    var currentStepIndex by remember { mutableIntStateOf(0) }\r\n\r\n    // --- VARIABLES PARA CAPTURAR POSICIONES REALES (LAYOUT) ---\r\n    // Estas variables se llenarán cuando Android dibuje la pantalla\r\n    var backButtonLayout by remember { mutableStateOf<Pair<Offset, Size>?>(null) }\r\n    var imageLayout by remember { mutableStateOf<Pair<Offset, Size>?>(null) }\r\n    var audioButtonLayout by remember { mutableStateOf<Pair<Offset, Size>?>(null) }\r\n    var button360Layout by remember { mutableStateOf<Pair<Offset, Size>?>(null) }\r\n\r\n    // --- Datos del Pin ---\r\n    val imagenes = if (pin.imagenesDetalladas.isNotEmpty()) pin.imagenesDetalladas else emptyList()\r\n    val pagerState = rememberPagerState(pageCount = { imagenes.size })\r\n    var selectedImageUrl by remember { mutableStateOf<String?>(null) }\r\n    var selectedImageTitle by remember { mutableStateOf<String?>(null) }\r\n\r\n    val configuration = LocalConfiguration.current\r\n    val locale: Locale = configuration.locales[0]\r\n    val language = locale.language\r\n\r\n    // --- Textos Multilingües ---\r\n    val titulo_pin: String\r\n    val descripcion_pin: String?\r\n    val ubicacion_pin: Ubicacion?\r\n\r\n    when (language) {\r\n        \"es\" -> {\r\n            titulo_pin = pin.titulo\r\n            descripcion_pin = pin.descripcion\r\n            ubicacion_pin = pin.ubicacion\r\n        }\r\n        \"de\" -> {\r\n            titulo_pin = pin.tituloAleman\r\n            descripcion_pin = pin.descripcionAleman\r\n            ubicacion_pin = pin.ubicacionAleman\r\n        }\r\n        else -> {\r\n            titulo_pin = pin.tituloIngles\r\n            descripcion_pin = pin.descripcionIngles\r\n            ubicacion_pin = pin.ubicacionIngles\r\n        }\r\n    }\r\n\r\n    // --- LÓGICA DE AUDIO ---\r\n    val context = LocalContext.current\r\n    val audioUrl = when (language) {\r\n        \"es\" -> pin.audioUrl_es\r\n        \"en\" -> pin.audioUrl_en\r\n        \"de\" -> pin.audioUrl_ge\r\n        else -> pin.audioUrl_es\r\n    }\r\n\r\n    Log.d(\"AudioDebug\", \"Pin: '${pin.titulo}', Idioma: $language, URL Audio: [$audioUrl]\")\r\n\r\n    val exoPlayer = remember { ExoPlayer.Builder(context).build() }\r\n    var isPlaying by remember { mutableStateOf(false) }\r\n    var hasUserInteracted by remember { mutableStateOf(false) }\r\n\r\n    DisposableEffect(audioUrl) {\r\n        if (!audioUrl.isNullOrBlank()) {\r\n            val mediaItem = MediaItem.fromUri(audioUrl)\r\n            exoPlayer.setMediaItem(mediaItem)\r\n            exoPlayer.prepare()\r\n        }\r\n        onDispose { }\r\n    }\r\n\r\n    LaunchedEffect(exoPlayer) {\r\n        exoPlayer.addListener(object : Player.Listener {\r\n            override fun onIsPlayingChanged(isPlayingValue: Boolean) {\r\n                isPlaying = isPlayingValue\r\n            }\r\n            override fun onPlaybackStateChanged(state: Int) {\r\n                if (state == Player.STATE_ENDED) {\r\n                    isPlaying = false\r\n                    exoPlayer.seekTo(0)\r\n                }\r\n            }\r\n        })\r\n    }\r\n\r\n    DisposableEffect(Unit) {\r\n        onDispose { exoPlayer.release() }\r\n    }\r\n\r\n    // --- UI PRINCIPAL ---\r\n    Box(\r\n        modifier = Modifier\r\n            .fillMaxSize()\r\n            .background(Color.White)\r\n            .statusBarsPadding()\r\n    ) {\r\n        Column(\r\n            modifier = Modifier\r\n                .fillMaxSize()\r\n                .padding(horizontal = 16.dp)\r\n                .padding(bottom = 40.dp),\r\n            horizontalAlignment = Alignment.CenterHorizontally\r\n        ) {\r\n            // 1. BOTÓN ATRÁS\r\n            Box(\r\n                modifier = Modifier\r\n                    .fillMaxWidth()\r\n                    .padding(top = 16.dp)\r\n                    // \uD83D\uDC47 CAPTURAMOS POSICIÓN REAL\r\n                    .onGloballyPositioned { coordinates ->\r\n                        val position = coordinates.positionInRoot()\r\n                        val size = coordinates.size\r\n                        backButtonLayout = position to Size(size.width.toFloat(), size.height.toFloat())\r\n                    },\r\n                contentAlignment = Alignment.CenterStart\r\n            ) {\r\n                Image(\r\n                    painter = painterResource(id = R.drawable.arrow_back),\r\n                    contentDescription = stringResource(R.string.go_back),\r\n                    modifier = Modifier\r\n                        .size(28.dp)\r\n                        .clickable { onBack() }\r\n                )\r\n            }\r\n\r\n            Spacer(modifier = Modifier.height(8.dp))\r\n\r\n            // Título\r\n            Text(\r\n                text = buildString {\r\n                    append(titulo_pin)\r\n                    ubicacion_pin?.let { append(\" (${it.displayName})\") }\r\n                },\r\n                fontSize = 26.sp,\r\n                fontWeight = FontWeight.Bold,\r\n                color = Color.Black,\r\n                textAlign = TextAlign.Center,\r\n                modifier = Modifier.fillMaxWidth()\r\n            )\r\n\r\n            Spacer(modifier = Modifier.height(16.dp))\r\n\r\n            // 2. CARRUSEL DE IMÁGENES\r\n            if (imagenes.isNotEmpty()) {\r\n                Box(\r\n                    modifier = Modifier\r\n                        .fillMaxWidth()\r\n                        .height(250.dp)\r\n                        .clip(RoundedCornerShape(16.dp))\r\n                        .border(3.dp, Color.Black, RoundedCornerShape(16.dp))\r\n                        // \uD83D\uDC47 CAPTURAMOS POSICIÓN REAL\r\n                        .onGloballyPositioned { coordinates ->\r\n                            val position = coordinates.positionInRoot()\r\n                            val size = coordinates.size\r\n                            imageLayout = position to Size(size.width.toFloat(), size.height.toFloat())\r\n                        }\r\n                ) {\r\n                    HorizontalPager(state = pagerState) { page ->\r\n                        val imagen = imagenes[page]\r\n                        Box(modifier = Modifier.fillMaxSize()) {\r\n                            AsyncImage(\r\n                                model = imagen.url,\r\n                                contentDescription = imagen.etiqueta,\r\n                                contentScale = ContentScale.Crop,\r\n                                modifier = Modifier\r\n                                    .fillMaxSize()\r\n                                    .clickable {\r\n                                        selectedImageUrl = imagen.url\r\n                                        selectedImageTitle = when (language) {\r\n                                            \"es\" -> imagen.titulo\r\n                                            \"de\" -> imagen.tituloAleman\r\n                                            else -> imagen.tituloIngles\r\n                                        }\r\n                                    }\r\n                            )\r\n                            Text(\r\n                                text = imagen.etiqueta,\r\n                                color = Color.White,\r\n                                fontSize = 14.sp,\r\n                                modifier = Modifier\r\n                                    .align(Alignment.BottomStart)\r\n                                    .background(Color.Black.copy(alpha = 0.6f))\r\n                                    .padding(horizontal = 10.dp, vertical = 6.dp)\r\n                            )\r\n                        }\r\n                    }\r\n                    Row(\r\n                        Modifier\r\n                            .align(Alignment.BottomCenter)\r\n                            .padding(bottom = 6.dp)\r\n                    ) {\r\n                        repeat(imagenes.size) { index ->\r\n                            val selected = pagerState.currentPage == index\r\n                            Box(\r\n                                Modifier\r\n                                    .padding(3.dp)\r\n                                    .size(if (selected) 8.dp else 6.dp)\r\n                                    .background(\r\n                                        Color.White.copy(alpha = if (selected) 1f else 0.6f),\r\n                                        CircleShape\r\n                                    )\r\n                            )\r\n                        }\r\n                    }\r\n                }\r\n                Spacer(modifier = Modifier.height(12.dp))\r\n            }\r\n\r\n            // 3. BOTÓN DE AUDIO\r\n            Row(\r\n                modifier = Modifier.fillMaxWidth(),\r\n                verticalAlignment = Alignment.CenterVertically\r\n            ) {\r\n                if (!audioUrl.isNullOrBlank()) {\r\n                    val iconRes = when {\r\n                        isPlaying -> R.drawable.pause\r\n                        !hasUserInteracted -> R.drawable.microphone\r\n                        else -> R.drawable.play_arrow\r\n                    }\r\n                    Row(\r\n                        modifier = Modifier\r\n                            .fillMaxWidth()\r\n                            .padding(top = 8.dp),\r\n                        horizontalArrangement = Arrangement.Start\r\n                    ) {\r\n                        IconButton(\r\n                            onClick = {\r\n                                hasUserInteracted = true\r\n                                if (isPlaying) exoPlayer.pause() else exoPlayer.play()\r\n                            },\r\n                            modifier = Modifier\r\n                                // \uD83D\uDC47 CAPTURAMOS POSICIÓN REAL\r\n                                .onGloballyPositioned { coordinates ->\r\n                                    val position = coordinates.positionInRoot()\r\n                                    val size = coordinates.size\r\n                                    audioButtonLayout = position to Size(size.width.toFloat(), size.height.toFloat())\r\n                                }\r\n                        ) {\r\n                            Box(\r\n                                modifier = Modifier\r\n                                    .size(48.dp)\r\n                                    .clip(CircleShape)\r\n                                    .background(Color.Gray.copy(alpha = 0.3f)),\r\n                                contentAlignment = Alignment.Center\r\n                            ) {\r\n                                Icon(\r\n                                    painter = painterResource(id = iconRes),\r\n                                    contentDescription = stringResource(R.string.play_audio),\r\n                                    tint = Color.Black,\r\n                                    modifier = Modifier.size(28.dp)\r\n                                )\r\n                            }\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n\r\n            // Descripción Deslizable\r\n            val descripcion = descripcion_pin ?: \"\"\r\n            if (descripcion.isNotBlank()) {\r\n                val textScrollState = rememberScrollState()\r\n                Box(\r\n                    modifier = Modifier\r\n                        .fillMaxWidth()\r\n                        .weight(1f)\r\n                        .border(1.dp, Color.LightGray.copy(alpha = 0.5f), RoundedCornerShape(8.dp))\r\n                        .clip(RoundedCornerShape(8.dp))\r\n                ) {\r\n                    Text(\r\n                        text = descripcion,\r\n                        fontSize = 16.sp,\r\n                        color = Color.DarkGray,\r\n                        lineHeight = 22.sp,\r\n                        modifier = Modifier\r\n                            .fillMaxSize()\r\n                            .padding(horizontal = 12.dp, vertical = 8.dp)\r\n                            .verticalScroll(textScrollState)\r\n                    )\r\n                }\r\n            }\r\n\r\n            Spacer(modifier = Modifier.height(24.dp))\r\n\r\n            // 4. BOTÓN 360\r\n            onVer360?.let {\r\n                Box(\r\n                    modifier = Modifier\r\n                        .background(Color.White)\r\n                        .navigationBarsPadding()\r\n                        .padding(horizontal = 16.dp, vertical = 2.dp)\r\n                        .onGloballyPositioned { coordinates ->\r\n                            val position = coordinates.positionInRoot()\r\n                            val size = coordinates.size\r\n                            button360Layout = position to Size(size.width.toFloat(), size.height.toFloat())\r\n                        }\r\n                ) {\r\n                    Button(\r\n                        onClick = it,\r\n                        modifier = Modifier\r\n                            .fillMaxWidth()\r\n                            .height(56.dp),\r\n                        colors = ButtonDefaults.buttonColors(containerColor = Color.Black),\r\n                        shape = RoundedCornerShape(12.dp)\r\n                    ) {\r\n                        Text(\r\n                            text = stringResource(R.string.see_360),\r\n                            color = Color.White,\r\n                            fontSize = 18.sp,\r\n                            fontWeight = FontWeight.Bold,\r\n                        )\r\n                    }\r\n                }\r\n            }\r\n        }\r\n\r\n        // ====================================================================\r\n        // LOGICA VISUAL DEL TUTORIAL (CON COORDENADAS REALES)\r\n        // ====================================================================\r\n\r\n        // Verificar que tenemos al menos las coordenadas básicas (Botón atrás es lo mínimo)\r\n        val isLayoutReady = backButtonLayout != null\r\n\r\n        if (!isPinDismissed && showTutorialSession && isLayoutReady) {\r\n\r\n            // Construimos la lista de pasos usando las coordenadas CAPTURADAS\r\n            val steps = remember(backButtonLayout, imageLayout, audioButtonLayout, button360Layout, audioUrl, onVer360) {\r\n                val list = mutableListOf<PinTutorialStep>()\r\n\r\n                // PASO 1: Volver (Usamos las coordenadas reales del botón atrás)\r\n                backButtonLayout?.let { (pos, size) ->\r\n                    list.add(\r\n                        PinTutorialStep(\r\n                            description = activity?.getString(R.string.pin_1) ?: \"Volver\",\r\n                            // Calculamos el centro geométrico\r\n                            focusCenter = Offset(pos.x + size.width / 20, pos.y + size.height / 2),\r\n                            // Radio un poco más grande que el botón\r\n                            focusRadius = (size.width / 15),\r\n                            alignment = Alignment.BottomCenter\r\n                        )\r\n                    )\r\n                }\r\n\r\n                // PASO 2: Imágenes (Usamos coordenadas reales del carrusel)\r\n                imageLayout?.let { (pos, size) ->\r\n                    list.add(\r\n                        PinTutorialStep(\r\n                            description = activity?.getString(R.string.pin_2) ?: \"Imágenes\",\r\n                            focusCenter = Offset(pos.x + size.width / 2, pos.y + size.height / 2),\r\n                            rectSize = size, // Usamos el tamaño exacto\r\n                            alignment = Alignment.BottomCenter\r\n                        )\r\n                    )\r\n                }\r\n\r\n                // PASO 3: Audio (Solo si existe y se ha medido)\r\n                if (!audioUrl.isNullOrBlank() && audioButtonLayout != null) {\r\n                    audioButtonLayout?.let { (pos, size) ->\r\n                        list.add(\r\n                            PinTutorialStep(\r\n                                description = activity?.getString(R.string.pin_3) ?: \"Audio\",\r\n                                focusCenter = Offset(pos.x + size.width / 2, pos.y + size.height / 2),\r\n                                focusRadius = (size.width / 2) + 20f,\r\n                                alignment = Alignment.TopCenter\r\n                            )\r\n                        )\r\n                    }\r\n                }\r\n\r\n                // PASO 4: Botón 360 (Solo si existe y se ha medido)\r\n                if (onVer360 != null && button360Layout != null) {\r\n                    button360Layout?.let { (pos, size) ->\r\n                        list.add(\r\n                            PinTutorialStep(\r\n                                description = activity?.getString(R.string.pin_4) ?: \"360\",\r\n                                focusCenter = Offset(pos.x + size.width / 2, pos.y + size.height / 2),\r\n                                rectSize = size,\r\n                                alignment = Alignment.TopCenter // Dialogo ARRIBA\r\n                            )\r\n                        )\r\n                    }\r\n                }\r\n                list\r\n            }\r\n\r\n            if (steps.isNotEmpty() && currentStepIndex < steps.size) {\r\n                val step = steps[currentStepIndex]\r\n                val isLastStep = currentStepIndex == steps.size - 1\r\n                val btnText = if (isLastStep) stringResource(R.string.understand) else stringResource(R.string.next)\r\n\r\n                GenericTutorialOverlay(\r\n                    description = step.description,\r\n                    highlightCenter = step.focusCenter,\r\n                    highlightRadius = step.focusRadius,\r\n                    highlightRectSize = step.rectSize,\r\n                    buttonText = btnText,\r\n                    dialogAlignment = step.alignment,\r\n\r\n                    onCloseClicked = { permanent ->\r\n                        if (isLastStep) {\r\n                            showTutorialSession = false\r\n                            if (permanent) viewModel.dismissPin()\r\n                        } else {\r\n                            currentStepIndex++\r\n                            if (permanent) viewModel.dismissPin()\r\n                        }\r\n                    }\r\n                )\r\n            }\r\n        }\r\n\r\n        // \uD83D\uDD0D Zoom Dialog\r\n        if (selectedImageUrl != null) {\r\n            ZoomableImageDialog(\r\n                imageUrl = selectedImageUrl!!,\r\n                label = selectedImageTitle ?: \"\",\r\n                onDismiss = {\r\n                    selectedImageUrl = null\r\n                    selectedImageTitle = null\r\n                }\r\n            )\r\n        }\r\n    }\r\n}\r\n\r\n@Composable\r\nprivate fun ZoomableImageDialog(imageUrl: String, label: String, onDismiss: () -> Unit) {\r\n    val view = LocalView.current\r\n    val activity = view.context as? Activity\r\n\r\n    DisposableEffect(Unit) {\r\n        activity?.requestedOrientation = ActivityInfo.SCREEN_ORIENTATION_SENSOR\r\n        onDispose {\r\n            activity?.requestedOrientation = ActivityInfo.SCREEN_ORIENTATION_PORTRAIT\r\n        }\r\n    }\r\n\r\n    Dialog(\r\n        onDismissRequest = onDismiss,\r\n        properties = DialogProperties(usePlatformDefaultWidth = false, dismissOnClickOutside = true)\r\n    ) {\r\n        Box(\r\n            modifier = Modifier.fillMaxSize().background(Color.Black.copy(alpha = 0.95f))\r\n        ) {\r\n            AndroidView(\r\n                factory = { context ->\r\n                    PhotoView(context).apply {\r\n                        load(imageUrl) { crossfade(true) }\r\n                    }\r\n                },\r\n                modifier = Modifier.fillMaxSize()\r\n            )\r\n\r\n            Text(\r\n                text = label,\r\n                color = Color.White,\r\n                fontSize = 16.sp,\r\n                fontWeight = FontWeight.Medium,\r\n                modifier = Modifier\r\n                    .align(Alignment.BottomStart)\r\n                    .background(Color.Black.copy(alpha = 0.7f))\r\n                    .padding(horizontal = 12.dp, vertical = 8.dp)\r\n            )\r\n\r\n            IconButton(\r\n                onClick = onDismiss,\r\n                modifier = Modifier\r\n                    .align(Alignment.TopEnd)\r\n                    .statusBarsPadding()\r\n                    .padding(16.dp)\r\n                    .background(Color.Black.copy(alpha = 0.5f), CircleShape)\r\n            ) {\r\n                Icon(\r\n                    painter = painterResource(id = R.drawable.arrow_back),\r\n                    contentDescription = stringResource(R.string.close),\r\n                    tint = Color.White\r\n                )\r\n            }\r\n        }\r\n    }\r\n}
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/app/src/main/java/com/nextapp/monasterio/ui/virtualvisit/screens/PinDetalleScreen.kt b/app/src/main/java/com/nextapp/monasterio/ui/virtualvisit/screens/PinDetalleScreen.kt
--- a/app/src/main/java/com/nextapp/monasterio/ui/virtualvisit/screens/PinDetalleScreen.kt	(revision b563b49dc11c723564618e771e0193249d97dff7)
+++ b/app/src/main/java/com/nextapp/monasterio/ui/virtualvisit/screens/PinDetalleScreen.kt	(date 1764252097350)
@@ -237,10 +237,19 @@
                     HorizontalPager(state = pagerState) { page ->
                         val imagen = imagenes[page]
                         Box(modifier = Modifier.fillMaxSize()) {
+
+                            val alignment = when(imagen.foco){
+                                "centro"-> Alignment.Center
+                                "arriba" -> Alignment.TopCenter
+                                else -> Alignment.BottomCenter
+                            }
+
+
                             AsyncImage(
                                 model = imagen.url,
                                 contentDescription = imagen.etiqueta,
                                 contentScale = ContentScale.Crop,
+                                alignment = alignment,
                                 modifier = Modifier
                                     .fillMaxSize()
                                     .clickable {
Index: app/src/main/java/com/nextapp/monasterio/viewModels/ParejasViewModel.kt
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>package com.nextapp.monasterio.viewModels\r\n\r\nimport android.util.Log\r\nimport android.widget.ImageView\r\nimport androidx.lifecycle.ViewModel\r\nimport androidx.lifecycle.ViewModelProvider\r\nimport androidx.lifecycle.viewModelScope\r\nimport com.nextapp.monasterio.models.ParejasManager\r\nimport com.nextapp.monasterio.models.ParejasPieza\r\nimport com.nextapp.monasterio.models.ParejasSize\r\nimport com.nextapp.monasterio.models.PuzzleSize\r\nimport kotlinx.coroutines.delay\r\nimport kotlinx.coroutines.flow.MutableStateFlow\r\nimport kotlinx.coroutines.flow.StateFlow\r\nimport kotlinx.coroutines.flow.update\r\nimport kotlinx.coroutines.launch\r\n\r\ndata class parejasUiState(\r\n    val piezas : List<ParejasPieza> = emptyList(),\r\n    val size : ParejasSize,\r\n    val solucionado : Boolean = false,\r\n    val mostradoInicial : Boolean = true,\r\n    val parejas : Int = (size.columns* size.rows)/2\r\n)\r\n\r\nclass ParejasViewModel (\r\n    val size: ParejasSize,\r\n    val imagenesIds: List<Int>\r\n): ViewModel(){\r\n\r\n    private val _uiState = MutableStateFlow(parejasUiState(size=size))\r\n\r\n    val uiState: StateFlow<parejasUiState> = _uiState\r\n\r\n    val piezasManager = ParejasManager(size)\r\n\r\n    init{\r\n        resetGame()\r\n    }\r\n    fun resetGame(){\r\n        val piezasIniciales = piezasManager.inicializarParejaPiezas(imagenesIds)\r\n        _uiState.value = parejasUiState(\r\n            piezas = piezasIniciales,\r\n            size = size,\r\n            solucionado = false,\r\n            mostradoInicial =  true\r\n        )\r\n        viewModelScope.launch {\r\n            delay(3000)\r\n            _uiState.update{\r\n                it.copy(mostradoInicial = false)\r\n            }\r\n        }\r\n    }\r\n\r\n    private val piezasVolteadas = mutableListOf<ParejasPieza>()\r\n\r\n    fun onClickPieza(id:Int){\r\n        if(piezasVolteadas.size == 2) return\r\n\r\n        val piezaClickeada = _uiState.value.piezas.find { it.id == id } ?: return\r\n\r\n        if(piezaClickeada.estaVolteada || piezaClickeada.conPareja) return\r\n\r\n        val nuevasPiezas = _uiState.value.piezas.toMutableList().apply {\r\n            val index = indexOfFirst { it.id == id }\r\n            this[index] = piezaClickeada.copy(estaVolteada = true)\r\n        }\r\n        _uiState.update { it.copy(piezas = nuevasPiezas) }\r\n\r\n        val nuevaPiezaVolteada = nuevasPiezas.find { it.id == id }!!\r\n        piezasVolteadas.add(nuevaPiezaVolteada)\r\n\r\n        // 2. Si ya hay dos piezas volteadas, chequeamos la pareja\r\n        if (piezasVolteadas.size == 2) {\r\n            chequearPareja(piezasVolteadas)\r\n        }\r\n\r\n    }\r\n\r\n    private fun chequearPareja(piezas : List<ParejasPieza>){\r\n        val pieza1 = piezas[0]\r\n        val pieza2 = piezas[1]\r\n\r\n        viewModelScope.launch {\r\n\r\n            delay(1000)\r\n\r\n            var piezasCompletas = _uiState.value.piezas\r\n            var parejasRestantes = _uiState.value.parejas\r\n\r\n            if(pieza1.imagen == pieza2.imagen){\r\n                piezasCompletas = piezasCompletas.map { pieza ->\r\n                    if (pieza.id == pieza1.id || pieza.id == pieza2.id) {\r\n                        // Crea una nueva pieza, resuelta y no volteada\r\n                        pieza.copy(conPareja = true, estaVolteada = false).also{\r\n                        }\r\n                    } else {\r\n                        pieza\r\n                    }\r\n                }\r\n                parejasRestantes -= 1\r\n            }\r\n            else{\r\n                piezasCompletas = piezasCompletas.map { pieza ->\r\n                    if (pieza.id == pieza1.id || pieza.id == pieza2.id) {\r\n                        // Crea una nueva pieza, des-volteada\r\n                        pieza.copy(estaVolteada = false).also{\r\n                        }\r\n                    } else {\r\n                        pieza\r\n                    }\r\n                }\r\n            }\r\n            this@ParejasViewModel.piezasVolteadas.clear()\r\n            _uiState.update { it.copy(piezas = piezasCompletas, parejas=parejasRestantes) }\r\n            val todasPiezasConPareja = estaTerminado()\r\n            _uiState.update { it.copy(solucionado = estaTerminado()) }\r\n\r\n        }\r\n    }\r\n\r\n    private fun estaTerminado(): Boolean{\r\n        val piezasActuales = _uiState.value.piezas\r\n        val todasPiezasConPareja = piezasActuales.all{pieza ->\r\n            pieza.conPareja\r\n        }\r\n        return todasPiezasConPareja\r\n    }\r\n\r\n\r\n}\r\n\r\nclass ParejasViewModelFactory(\r\n    private val size: ParejasSize,\r\n    private val imagenesIds: List<Int>\r\n) : ViewModelProvider.Factory{\r\n    @Suppress(\"UNCHECKED_CAST\")\r\n    override fun <T : ViewModel> create(modelClass: Class<T>): T {\r\n        if (modelClass.isAssignableFrom(ParejasViewModel::class.java)) {\r\n            return ParejasViewModel(size, imagenesIds) as T\r\n        }\r\n        throw IllegalArgumentException(\"Unknown ViewModel class\")\r\n    }\r\n}
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/app/src/main/java/com/nextapp/monasterio/viewModels/ParejasViewModel.kt b/app/src/main/java/com/nextapp/monasterio/viewModels/ParejasViewModel.kt
--- a/app/src/main/java/com/nextapp/monasterio/viewModels/ParejasViewModel.kt	(revision b563b49dc11c723564618e771e0193249d97dff7)
+++ b/app/src/main/java/com/nextapp/monasterio/viewModels/ParejasViewModel.kt	(date 1764252097357)
@@ -20,6 +20,7 @@
     val size : ParejasSize,
     val solucionado : Boolean = false,
     val mostradoInicial : Boolean = true,
+    val verificandoPareja: Boolean = false,
     val parejas : Int = (size.columns* size.rows)/2
 )
 
@@ -56,8 +57,8 @@
     private val piezasVolteadas = mutableListOf<ParejasPieza>()
 
     fun onClickPieza(id:Int){
+        if(_uiState.value.verificandoPareja) return
         if(piezasVolteadas.size == 2) return
-
         val piezaClickeada = _uiState.value.piezas.find { it.id == id } ?: return
 
         if(piezaClickeada.estaVolteada || piezaClickeada.conPareja) return
@@ -78,14 +79,13 @@
 
     }
 
-    private fun chequearPareja(piezas : List<ParejasPieza>){
+    private fun chequearPareja(piezas : List<ParejasPieza>,){
         val pieza1 = piezas[0]
         val pieza2 = piezas[1]
 
         viewModelScope.launch {
-
+            _uiState.update { it.copy(verificandoPareja = true) }
             delay(1000)
-
             var piezasCompletas = _uiState.value.piezas
             var parejasRestantes = _uiState.value.parejas
 
@@ -113,10 +113,9 @@
                 }
             }
             this@ParejasViewModel.piezasVolteadas.clear()
-            _uiState.update { it.copy(piezas = piezasCompletas, parejas=parejasRestantes) }
+            _uiState.update { it.copy(piezas = piezasCompletas, verificandoPareja = false, parejas=parejasRestantes) }
             val todasPiezasConPareja = estaTerminado()
             _uiState.update { it.copy(solucionado = estaTerminado()) }
-
         }
     }
 
Index: app/src/main/java/com/nextapp/monasterio/ui/screens/AjustesScreen.kt
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>package com.nextapp.monasterio.ui.screens\r\n\r\nimport android.content.pm.ActivityInfo\r\nimport androidx.activity.compose.LocalActivity\r\nimport androidx.appcompat.app.AppCompatActivity\r\nimport androidx.compose.foundation.Image\r\nimport androidx.compose.foundation.background\r\nimport androidx.compose.foundation.border\r\nimport androidx.compose.foundation.clickable\r\nimport androidx.compose.foundation.layout.*\r\nimport androidx.compose.foundation.rememberScrollState\r\nimport androidx.compose.foundation.shape.CircleShape\r\nimport androidx.compose.foundation.shape.RoundedCornerShape\r\nimport androidx.compose.foundation.verticalScroll\r\nimport androidx.compose.material3.*\r\nimport androidx.compose.runtime.*\r\nimport androidx.compose.ui.Alignment\r\nimport androidx.compose.ui.Modifier\r\nimport androidx.compose.ui.draw.clip\r\nimport androidx.compose.ui.draw.rotate\r\nimport androidx.compose.ui.graphics.Color\r\nimport androidx.compose.ui.platform.LocalConfiguration\r\nimport androidx.compose.ui.res.painterResource\r\nimport androidx.compose.ui.res.stringResource\r\nimport androidx.compose.ui.text.font.FontWeight\r\nimport androidx.compose.ui.unit.dp\r\nimport com.nextapp.monasterio.LanguageHelper\r\nimport com.nextapp.monasterio.R\r\nimport com.nextapp.monasterio.utils.FontSize\r\nimport com.nextapp.monasterio.viewModels.AjustesViewModel\r\nimport java.util.Locale\r\n\r\n@OptIn(ExperimentalMaterial3Api::class)\r\n@Composable\r\nfun AjustesScreen(viewModel: AjustesViewModel) {\r\n    val activity = LocalActivity.current as? AppCompatActivity ?: return\r\n    val botonesVisibles by viewModel.botonesVisibles.collectAsState()\r\n\r\n    // Configuración actual para detectar idioma y fuente inicial\r\n    val configuration = LocalConfiguration.current\r\n    val currentLocale = configuration.locales[0]\r\n    val currentFontScale = configuration.fontScale\r\n\r\n    DisposableEffect(Unit) {\r\n        activity.requestedOrientation = ActivityInfo.SCREEN_ORIENTATION_UNSPECIFIED\r\n        onDispose {}\r\n    }\r\n\r\n    Column(\r\n        modifier = Modifier\r\n            .fillMaxSize()\r\n            .background(MaterialTheme.colorScheme.background)\r\n            .verticalScroll(rememberScrollState())\r\n            .padding(16.dp),\r\n        horizontalAlignment = Alignment.CenterHorizontally\r\n    ) {\r\n\r\n        // ==========================================\r\n        // 1. SELECTOR DE IDIOMA\r\n        // ==========================================\r\n        SettingsSectionCard(title = stringResource(R.string.language_select)) {\r\n            LanguageSelector(activity, currentLocale)\r\n        }\r\n\r\n        Spacer(modifier = Modifier.height(24.dp))\r\n\r\n        // ==========================================\r\n        // 2. TAMAÑO DE FUENTE (RADIO BUTTONS)\r\n        // ==========================================\r\n        SettingsSectionCard(title = stringResource(R.string.font_size_select)) {\r\n            // \uD83D\uDC47 Usamos el nuevo componente de Radio Buttons\r\n            FontSizeSelector(activity, currentFontScale)\r\n        }\r\n\r\n        Spacer(modifier = Modifier.height(24.dp))\r\n\r\n        // ==========================================\r\n        // 3. BOTONES DE NAVEGACIÓN (SWITCH)\r\n        // ==========================================\r\n        SettingsSectionCard(title = stringResource(R.string.navegation_button)) {\r\n            Row(\r\n                modifier = Modifier\r\n                    .fillMaxWidth()\r\n                    .padding(vertical = 8.dp),\r\n                verticalAlignment = Alignment.CenterVertically,\r\n                horizontalArrangement = Arrangement.SpaceBetween\r\n            ) {\r\n                Text(\r\n                    text = if (botonesVisibles) stringResource(R.string.visible) else stringResource(R.string.hidden),\r\n                    style = MaterialTheme.typography.bodyLarge\r\n                )\r\n                Switch(\r\n                    checked = botonesVisibles,\r\n                    onCheckedChange = { viewModel.setBotonesVisibles(it) },\r\n                    colors = SwitchDefaults.colors(\r\n                        checkedThumbColor = MaterialTheme.colorScheme.primary,\r\n                        checkedTrackColor = MaterialTheme.colorScheme.primaryContainer\r\n                    )\r\n                )\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\n// --- COMPONENTE TARJETA ---\r\n@Composable\r\nfun SettingsSectionCard(title: String, content: @Composable () -> Unit) {\r\n    Card(\r\n        modifier = Modifier.fillMaxWidth(),\r\n        shape = RoundedCornerShape(16.dp),\r\n        elevation = CardDefaults.cardElevation(defaultElevation = 4.dp),\r\n        colors = CardDefaults.cardColors(containerColor = MaterialTheme.colorScheme.surface)\r\n    ) {\r\n        Column(modifier = Modifier.padding(20.dp)) {\r\n            Text(\r\n                text = title,\r\n                style = MaterialTheme.typography.titleMedium,\r\n                fontWeight = FontWeight.Bold,\r\n                color = MaterialTheme.colorScheme.onSurface\r\n            )\r\n            Spacer(modifier = Modifier.height(16.dp))\r\n            content()\r\n        }\r\n    }\r\n}\r\n\r\n// --- COMPONENTE SELECTOR DE IDIOMA ---\r\n@Composable\r\nfun LanguageSelector(activity: AppCompatActivity, currentLocale: Locale) {\r\n    var expanded by remember { mutableStateOf(false) }\r\n    val languageCode = currentLocale.language\r\n\r\n    val currentFlag = when (languageCode) {\r\n        \"de\" -> R.drawable.alemania\r\n        \"en\" -> R.drawable.reinounido\r\n        else -> R.drawable.espanya\r\n    }\r\n\r\n    val currentName = when (languageCode) {\r\n        \"de\" -> stringResource(R.string.lang_de)\r\n        \"en\" -> stringResource(R.string.lang_en)\r\n        else -> stringResource(R.string.lang_es)\r\n    }\r\n\r\n    Box(modifier = Modifier.fillMaxWidth()) {\r\n        OutlinedButton(\r\n            onClick = { expanded = true },\r\n            modifier = Modifier.fillMaxWidth(),\r\n            shape = RoundedCornerShape(12.dp),\r\n            colors = ButtonDefaults.outlinedButtonColors(containerColor = Color.Transparent)\r\n        ) {\r\n            Row(\r\n                verticalAlignment = Alignment.CenterVertically,\r\n                horizontalArrangement = Arrangement.SpaceBetween,\r\n                modifier = Modifier.fillMaxWidth()\r\n            ) {\r\n                Row(verticalAlignment = Alignment.CenterVertically) {\r\n                    Image(\r\n                        painter = painterResource(id = currentFlag),\r\n                        contentDescription = null,\r\n                        modifier = Modifier.size(32.dp).clip(RoundedCornerShape(4.dp))\r\n                    )\r\n                    Spacer(modifier = Modifier.width(16.dp))\r\n                    Text(text = currentName, style = MaterialTheme.typography.bodyLarge, color = MaterialTheme.colorScheme.onSurface)\r\n                }\r\n                Icon(\r\n                    painter = painterResource(id = R.drawable.arrow_down),\r\n                    contentDescription = null,\r\n                    tint = MaterialTheme.colorScheme.onSurface,\r\n                    modifier = Modifier.rotate(if (expanded) 180f else 0f)\r\n                )\r\n            }\r\n        }\r\n\r\n        DropdownMenu(\r\n            expanded = expanded,\r\n            onDismissRequest = { expanded = false },\r\n            modifier = Modifier.fillMaxWidth(0.85f)\r\n        ) {\r\n            LanguageItem(activity, \"es\", stringResource(R.string.lang_es), R.drawable.espanya) { expanded = false }\r\n            LanguageItem(activity, \"en\", stringResource(R.string.lang_en), R.drawable.reinounido) { expanded = false }\r\n            LanguageItem(activity, \"de\", stringResource(R.string.lang_de), R.drawable.alemania) { expanded = false }\r\n        }\r\n    }\r\n}\r\n\r\n@Composable\r\nfun LanguageItem(\r\n    activity: AppCompatActivity,\r\n    code: String,\r\n    name: String,\r\n    flagRes: Int,\r\n    onDismiss: () -> Unit\r\n) {\r\n    DropdownMenuItem(\r\n        text = {\r\n            Row(verticalAlignment = Alignment.CenterVertically) {\r\n                Image(\r\n                    painter = painterResource(id = flagRes),\r\n                    contentDescription = null,\r\n                    modifier = Modifier.size(28.dp).clip(RoundedCornerShape(4.dp))\r\n                )\r\n                Spacer(modifier = Modifier.width(16.dp))\r\n                Text(text = name)\r\n            }\r\n        },\r\n        onClick = {\r\n            onDismiss()\r\n            val currentLanguage = activity.resources.configuration.locales[0].language\r\n            if (currentLanguage != code) {\r\n                LanguageHelper.saveLocale(activity, code)\r\n                activity.recreate()\r\n            }\r\n        }\r\n    )\r\n}\r\n\r\n// --- NUEVO SELECTOR VERTICAL (ROBUSTO Y CON DRAWABLES) ---\r\n@Composable\r\nfun FontSizeSelector(activity: AppCompatActivity, currentScale: Float) {\r\n\r\n    // 1. Definimos los tamaños exactos\r\n    val sizeSmall = 1.2f\r\n    val sizeMedium = 1.5f\r\n    val sizeLarge = 1.7f\r\n\r\n    // 2. Estado de la opción seleccionada.\r\n    // Usamos 'rememberSaveable' para intentar mantener el estado si la recreación es parcial,\r\n    // pero inicializamos basándonos en 'currentScale'.\r\n    var selectedOption by remember(currentScale) {\r\n        mutableIntStateOf(\r\n            when {\r\n                currentScale >= 1.65f -> 2 // Grande\r\n                currentScale >= 1.45f -> 1 // Mediana\r\n                else -> 0                  // Pequeña\r\n            }\r\n        )\r\n    }\r\n\r\n    fun updateFontSize(newScale: Float, newOptionIndex: Int) {\r\n        // 1. Actualizamos la UI INMEDIATAMENTE para que el check cambie\r\n        selectedOption = newOptionIndex\r\n\r\n        // 2. Guardamos y recreamos\r\n        // (Añadimos un pequeño delay o comprobación para no bloquear la UI visual)\r\n        if (kotlin.math.abs(newScale - currentScale) > 0.05f) {\r\n            FontSize.guardarFontScale(activity, newScale)\r\n\r\n            // Usamos un Handler para dar tiempo a que se pinte el check antes de reiniciar\r\n            android.os.Handler(android.os.Looper.getMainLooper()).postDelayed({\r\n                activity.recreate()\r\n            }, 150) // 150ms de espera visual\r\n        }\r\n    }\r\n\r\n    // 3. Diseño Vertical\r\n    Column(\r\n        modifier = Modifier.fillMaxWidth(),\r\n        verticalArrangement = Arrangement.spacedBy(12.dp)\r\n    ) {\r\n        // Opción 1: PEQUEÑA\r\n        FontSizeOptionCard(\r\n            text = stringResource(R.string.font_small),\r\n            isSelected = (selectedOption == 0),\r\n            onClick = { updateFontSize(sizeSmall, 0) }\r\n        )\r\n\r\n        // Opción 2: MEDIANA\r\n        FontSizeOptionCard(\r\n            text = stringResource(R.string.font_medium),\r\n            isSelected = (selectedOption == 1),\r\n            onClick = { updateFontSize(sizeMedium, 1) }\r\n        )\r\n\r\n        // Opción 3: GRANDE\r\n        FontSizeOptionCard(\r\n            text = stringResource(R.string.font_large),\r\n            isSelected = (selectedOption == 2),\r\n            onClick = { updateFontSize(sizeLarge, 2) }\r\n        )\r\n    }\r\n}\r\n\r\n@Composable\r\nfun FontSizeOptionCard(\r\n    text: String,\r\n    isSelected: Boolean,\r\n    onClick: () -> Unit\r\n) {\r\n    // Colores dinámicos: Si está seleccionado, fondo coloreado y borde primario\r\n    val containerColor = if (isSelected) MaterialTheme.colorScheme.primaryContainer else MaterialTheme.colorScheme.surface\r\n    val borderColor = if (isSelected) MaterialTheme.colorScheme.primary else MaterialTheme.colorScheme.outlineVariant\r\n    val contentColor = if (isSelected) MaterialTheme.colorScheme.onPrimaryContainer else MaterialTheme.colorScheme.onSurface\r\n\r\n    // Grosor del borde: Más grueso si está seleccionado\r\n    val borderWidth = if (isSelected) 2.dp else 1.dp\r\n\r\n    Card(\r\n        modifier = Modifier\r\n            .fillMaxWidth()\r\n            .clickable { onClick() },\r\n        shape = RoundedCornerShape(12.dp),\r\n        colors = CardDefaults.cardColors(containerColor = containerColor),\r\n        border = androidx.compose.foundation.BorderStroke(borderWidth, borderColor)\r\n    ) {\r\n        Row(\r\n            modifier = Modifier\r\n                .fillMaxWidth()\r\n                .padding(16.dp),\r\n            verticalAlignment = Alignment.CenterVertically,\r\n            horizontalArrangement = Arrangement.SpaceBetween\r\n        ) {\r\n            // Texto de la opción\r\n            Text(\r\n                text = text,\r\n                style = MaterialTheme.typography.titleMedium,\r\n                fontWeight = if (isSelected) FontWeight.Bold else FontWeight.Normal,\r\n                color = contentColor\r\n            )\r\n\r\n            // Icono o Indicador\r\n            if (isSelected) {\r\n                // \uD83D\uDC47 AQUÍ DEBES ASEGURARTE DE TENER EL DRAWABLE 'check'\r\n                Icon(\r\n                    painter = painterResource(id = R.drawable.check),\r\n                    contentDescription = \"Selected\",\r\n                    tint = MaterialTheme.colorScheme.primary,\r\n                    modifier = Modifier.size(24.dp)\r\n                )\r\n            } else {\r\n                // Círculo vacío para simular radio button desmarcado\r\n                Box(\r\n                    modifier = Modifier\r\n                        .size(24.dp)\r\n                        .background(Color.Transparent, CircleShape)\r\n                        .border(2.dp, MaterialTheme.colorScheme.outline, CircleShape)\r\n                )\r\n            }\r\n        }\r\n    }\r\n}
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/app/src/main/java/com/nextapp/monasterio/ui/screens/AjustesScreen.kt b/app/src/main/java/com/nextapp/monasterio/ui/screens/AjustesScreen.kt
--- a/app/src/main/java/com/nextapp/monasterio/ui/screens/AjustesScreen.kt	(revision b563b49dc11c723564618e771e0193249d97dff7)
+++ b/app/src/main/java/com/nextapp/monasterio/ui/screens/AjustesScreen.kt	(date 1764252090129)
@@ -133,12 +133,14 @@
     val currentFlag = when (languageCode) {
         "de" -> R.drawable.alemania
         "en" -> R.drawable.reinounido
+        "fr" -> R.drawable.francia
         else -> R.drawable.espanya
     }
 
     val currentName = when (languageCode) {
         "de" -> stringResource(R.string.lang_de)
         "en" -> stringResource(R.string.lang_en)
+        "fr" -> stringResource(R.string.lang_fr)
         else -> stringResource(R.string.lang_es)
     }
 
@@ -180,6 +182,7 @@
             LanguageItem(activity, "es", stringResource(R.string.lang_es), R.drawable.espanya) { expanded = false }
             LanguageItem(activity, "en", stringResource(R.string.lang_en), R.drawable.reinounido) { expanded = false }
             LanguageItem(activity, "de", stringResource(R.string.lang_de), R.drawable.alemania) { expanded = false }
+            LanguageItem(activity, "fr", stringResource(R.string.lang_fr), R.drawable.francia) { expanded = false }
         }
     }
 }
Index: app/src/main/java/com/nextapp/monasterio/models/ImagenData.kt
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>package com.nextapp.monasterio.models\r\n\r\ndata class ImagenData(\r\n    val id: String = \"\",\r\n    val url: String = \"\",\r\n    val etiqueta: String = \"\",\r\n    val titulo: String = \"\",\r\n    val tituloIngles: String = \"\",\r\n    val tituloAleman: String = \"\"\r\n)\r\n
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/app/src/main/java/com/nextapp/monasterio/models/ImagenData.kt b/app/src/main/java/com/nextapp/monasterio/models/ImagenData.kt
--- a/app/src/main/java/com/nextapp/monasterio/models/ImagenData.kt	(revision b563b49dc11c723564618e771e0193249d97dff7)
+++ b/app/src/main/java/com/nextapp/monasterio/models/ImagenData.kt	(date 1764252097364)
@@ -6,5 +6,6 @@
     val etiqueta: String = "",
     val titulo: String = "",
     val tituloIngles: String = "",
-    val tituloAleman: String = ""
+    val tituloAleman: String = "",
+    val foco: String =""
 )
